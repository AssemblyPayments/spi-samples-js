!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){(function(e){var n,i,s,r;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window,r=function(){return function(e){var t=window.webpackHotUpdatespi_client_js;window.webpackHotUpdatespi_client_js=function(e,n){!function(e,t){if(!C[e]||!S[e])return;for(var n in S[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(g[n]=t[n]);0==--v&&0===w&&P()}(e,n),t&&t(e,n)};var n,i=!0,s="d9614ef4564638a8be97",r=1e4,a={},u=[],l=[];function h(e){var t=I[e];if(!t)return A;var i=function(i){return t.hot.active?(I[i]?-1===I[i].parents.indexOf(e)&&I[i].parents.push(e):(u=[e],n=i),-1===t.children.indexOf(i)&&t.children.push(i)):(console.warn("[HMR] unexpected require("+i+") from disposed module "+e),u=[]),A(i)},s=function(e){return{configurable:!0,enumerable:!0,get:function(){return A[e]},set:function(t){A[e]=t}}};for(var r in A)Object.prototype.hasOwnProperty.call(A,r)&&"e"!==r&&"t"!==r&&Object.defineProperty(i,r,s(r));return i.e=function(e){return"ready"===f&&p("prepare"),w++,A.e(e).then(t,function(e){throw t(),e});function t(){w--,"prepare"===f&&(y[e]||R(e),0===w&&0===v&&P())}},i.t=function(e,t){return 1&t&&(e=i(e)),A.t(e,-2&t)},i}function c(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"===o(e))for(var i=0;i<e.length;i++)t._acceptedDependencies[e[i]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"===o(e))for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:T,apply:E,status:function(e){if(!e)return f;d.push(e)},addStatusHandler:function(e){d.push(e)},removeStatusHandler:function(e){var t=d.indexOf(e);t>=0&&d.splice(t,1)},data:a[e]};return n=void 0,t}var d=[],f="idle";function p(e){f=e;for(var t=0;t<d.length;t++)d[t].call(null,e)}var m,g,_,v=0,w=0,y={},S={},C={};function b(e){return+e+""===e?+e:e}function T(e){if("idle"!==f)throw new Error("check() is only allowed in idle status");return i=e,p("check"),(t=r,t=t||1e4,new Promise(function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var i=new XMLHttpRequest,r=A.p+""+s+".hot-update.json";i.open("GET",r,!0),i.timeout=t,i.send(null)}catch(e){return n(e)}i.onreadystatechange=function(){if(4===i.readyState)if(0===i.status)n(new Error("Manifest request to "+r+" timed out."));else if(404===i.status)e();else if(200!==i.status&&304!==i.status)n(new Error("Manifest request to "+r+" failed."));else{try{var t=JSON.parse(i.responseText)}catch(e){return void n(e)}e(t)}}})).then(function(e){if(!e)return p("idle"),null;S={},y={},C=e.c,_=e.h,p("prepare");var t=new Promise(function(e,t){m={resolve:e,reject:t}});g={};return R("main"),"prepare"===f&&0===w&&0===v&&P(),t});var t}function R(e){C[e]?(S[e]=!0,v++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=A.p+""+e+"."+s+".hot-update.js",document.head.appendChild(t)}(e)):y[e]=!0}function P(){p("ready");var e=m;if(m=null,e)if(i)Promise.resolve().then(function(){return E(i)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var n in g)Object.prototype.hasOwnProperty.call(g,n)&&t.push(b(n));e.resolve(t)}}function E(t){if("ready"!==f)throw new Error("apply() is only allowed in ready status");var n,i,r,o,l;function h(e){for(var t=[e],n={},i=t.map(function(e){return{chain:[e],id:e}});i.length>0;){var s=i.pop(),r=s.id,a=s.chain;if((o=I[r])&&!o.hot._selfAccepted){if(o.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:r};if(o.hot._main)return{type:"unaccepted",chain:a,moduleId:r};for(var u=0;u<o.parents.length;u++){var l=o.parents[u],h=I[l];if(h){if(h.hot._declinedDependencies[r])return{type:"declined",chain:a.concat([l]),moduleId:r,parentId:l};-1===t.indexOf(l)&&(h.hot._acceptedDependencies[r]?(n[l]||(n[l]=[]),c(n[l],[r])):(delete n[l],t.push(l),i.push({chain:a.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];-1===e.indexOf(i)&&e.push(i)}}t=t||{};var d={},m=[],v={},w=function(){console.warn("[HMR] unexpected require("+S.moduleId+") to disposed module")};for(var y in g)if(Object.prototype.hasOwnProperty.call(g,y)){var S;l=b(y);var T=!1,R=!1,P=!1,E="";switch((S=g[y]?h(l):{type:"disposed",moduleId:y}).chain&&(E="\nUpdate propagation: "+S.chain.join(" -> ")),S.type){case"self-declined":t.onDeclined&&t.onDeclined(S),t.ignoreDeclined||(T=new Error("Aborted because of self decline: "+S.moduleId+E));break;case"declined":t.onDeclined&&t.onDeclined(S),t.ignoreDeclined||(T=new Error("Aborted because of declined dependency: "+S.moduleId+" in "+S.parentId+E));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(S),t.ignoreUnaccepted||(T=new Error("Aborted because "+l+" is not accepted"+E));break;case"accepted":t.onAccepted&&t.onAccepted(S),R=!0;break;case"disposed":t.onDisposed&&t.onDisposed(S),P=!0;break;default:throw new Error("Unexception type "+S.type)}if(T)return p("abort"),Promise.reject(T);if(R)for(l in v[l]=g[l],c(m,S.outdatedModules),S.outdatedDependencies)Object.prototype.hasOwnProperty.call(S.outdatedDependencies,l)&&(d[l]||(d[l]=[]),c(d[l],S.outdatedDependencies[l]));P&&(c(m,[S.moduleId]),v[l]=w)}var M,k=[];for(i=0;i<m.length;i++)l=m[i],I[l]&&I[l].hot._selfAccepted&&v[l]!==w&&k.push({module:l,errorHandler:I[l].hot._selfAccepted});p("dispose"),Object.keys(C).forEach(function(e){!1===C[e]&&function(e){delete installedChunks[e]}(e)});for(var F,O,D=m.slice();D.length>0;)if(l=D.pop(),o=I[l]){var x={},B=o.hot._disposeHandlers;for(r=0;r<B.length;r++)(n=B[r])(x);for(a[l]=x,o.hot.active=!1,delete I[l],delete d[l],r=0;r<o.children.length;r++){var q=I[o.children[r]];q&&((M=q.parents.indexOf(l))>=0&&q.parents.splice(M,1))}}for(l in d)if(Object.prototype.hasOwnProperty.call(d,l)&&(o=I[l]))for(O=d[l],r=0;r<O.length;r++)F=O[r],(M=o.children.indexOf(F))>=0&&o.children.splice(M,1);for(l in p("apply"),s=_,v)Object.prototype.hasOwnProperty.call(v,l)&&(e[l]=v[l]);var G=null;for(l in d)if(Object.prototype.hasOwnProperty.call(d,l)&&(o=I[l])){O=d[l];var L=[];for(i=0;i<O.length;i++)if(F=O[i],n=o.hot._acceptedDependencies[F]){if(-1!==L.indexOf(n))continue;L.push(n)}for(i=0;i<L.length;i++){n=L[i];try{n(O)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:l,dependencyId:O[i],error:e}),t.ignoreErrored||G||(G=e)}}}for(i=0;i<k.length;i++){var j=k[i];l=j.module,u=[l];try{A(l)}catch(e){if("function"==typeof j.errorHandler)try{j.errorHandler(e)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:n,originalError:e}),t.ignoreErrored||G||(G=n),G||(G=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:l,error:e}),t.ignoreErrored||G||(G=e)}}return G?(p("fail"),Promise.reject(G)):(p("idle"),new Promise(function(e){e(m)}))}var I={};function A(t){if(I[t])return I[t].exports;var n=I[t]={i:t,l:!1,exports:{},hot:c(t),parents:(l=u,u=[],l),children:[]};return e[t].call(n.exports,n,n.exports,h(t)),n.l=!0,n.exports}return A.m=e,A.c=I,A.d=function(e,t,n){A.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},A.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},A.t=function(e,t){if(1&t&&(e=A(e)),8&t)return e;if(4&t&&"object"===o(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(A.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)A.d(n,i,function(t){return e[t]}.bind(null,i));return n},A.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return A.d(t,"a",t),t},A.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},A.p="",A.h=function(){return s},h("./index.js")(A.s="./index.js")}({"./index.js":
/*!******************!*\
  !*** ./index.js ***!
  \******************/
/*! exports provided: Spi, Logger, Secrets, SuccessState, TransactionOptions, TransactionType, SpiFlow, SpiStatus, PrintingResponse, RefundResponse, PurchaseResponse, GetLastTransactionResponse, MotoPurchaseResponse, TerminalStatusResponse, TerminalBattery, CashoutOnlyResponse, Settlement, RequestIdHelper, DeviceAddressResponseCode, BillStatusResponse, BillRetrievalResult, GetOpenTablesResponse, OpenTablesEntry, BillPaymentFlowEndedResponse, PreauthResponse */function(e,t,n){"use strict";n.r(t);var i=n(/*! ./src/Spi */"./src/Spi.js");n.d(t,"Spi",function(){return i.Spi});var s=n(/*! ./src/Logger */"./src/Logger.js");n.d(t,"Logger",function(){return s.Logger});var r=n(/*! ./src/Secrets */"./src/Secrets.js");n.d(t,"Secrets",function(){return r.Secrets});var o=n(/*! ./src/Messages */"./src/Messages.js");n.d(t,"SuccessState",function(){return o.SuccessState});var a=n(/*! ./src/SpiModels */"./src/SpiModels.js");n.d(t,"TransactionOptions",function(){return a.TransactionOptions}),n.d(t,"TransactionType",function(){return a.TransactionType}),n.d(t,"SpiFlow",function(){return a.SpiFlow}),n.d(t,"SpiStatus",function(){return a.SpiStatus});var u=n(/*! ./src/Printing */"./src/Printing.js");n.d(t,"PrintingResponse",function(){return u.PrintingResponse});var l=n(/*! ./src/Purchase */"./src/Purchase.js");n.d(t,"RefundResponse",function(){return l.RefundResponse}),n.d(t,"PurchaseResponse",function(){return l.PurchaseResponse}),n.d(t,"GetLastTransactionResponse",function(){return l.GetLastTransactionResponse}),n.d(t,"MotoPurchaseResponse",function(){return l.MotoPurchaseResponse});var h=n(/*! ./src/TerminalStatus */"./src/TerminalStatus.js");n.d(t,"TerminalStatusResponse",function(){return h.TerminalStatusResponse}),n.d(t,"TerminalBattery",function(){return h.TerminalBattery});var c=n(/*! ./src/Cashout */"./src/Cashout.js");n.d(t,"CashoutOnlyResponse",function(){return c.CashoutOnlyResponse});var d=n(/*! ./src/Settlement */"./src/Settlement.js");n.d(t,"Settlement",function(){return d.Settlement});var f=n(/*! ./src/RequestIdHelper */"./src/RequestIdHelper.js");n.d(t,"RequestIdHelper",function(){return f.RequestIdHelper});var p=n(/*! ./src/Service/DeviceService */"./src/Service/DeviceService.js");n.d(t,"DeviceAddressResponseCode",function(){return p.DeviceAddressResponseCode});var m=n(/*! ./src/PayAtTable */"./src/PayAtTable.js");n.d(t,"BillStatusResponse",function(){return m.BillStatusResponse}),n.d(t,"BillRetrievalResult",function(){return m.BillRetrievalResult}),n.d(t,"GetOpenTablesResponse",function(){return m.GetOpenTablesResponse}),n.d(t,"OpenTablesEntry",function(){return m.OpenTablesEntry}),n.d(t,"BillPaymentFlowEndedResponse",function(){return m.BillPaymentFlowEndedResponse});var g=n(/*! ./src/Preauth */"./src/Preauth.js");n.d(t,"PreauthResponse",function(){return g.PreauthResponse})},"./node_modules/@babel/runtime/helpers/asyncToGenerator.js":
/*!*****************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/asyncToGenerator.js ***!
  \*****************************************************************/
/*! no static exports found */function(e,t){function n(e,t,n,i,s,r,o){try{var a=e[r](o),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(i,s)}e.exports=function(e){return function(){var t=this,i=arguments;return new Promise(function(s,r){var o=e.apply(t,i);function a(e){n(o,s,r,a,u,"next",e)}function u(e){n(o,s,r,a,u,"throw",e)}a(void 0)})}}},"./node_modules/@babel/runtime/helpers/classCallCheck.js":
/*!***************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/classCallCheck.js ***!
  \***************************************************************/
/*! no static exports found */function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},"./node_modules/@babel/runtime/helpers/createClass.js":
/*!************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/createClass.js ***!
  \************************************************************/
/*! no static exports found */function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}},"./node_modules/@babel/runtime/node_modules/regenerator-runtime/runtime.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/@babel/runtime/node_modules/regenerator-runtime/runtime.js ***!
  \*********************************************************************************/
/*! no static exports found */function(e,t,n){var i=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(e,t,n,i){var s=t&&t.prototype instanceof g?t:g,r=Object.create(s.prototype),o=new I(i||[]);return r._invoke=function(e,t,n){var i=c;return function(s,r){if(i===f)throw new Error("Generator is already running");if(i===p){if("throw"===s)throw r;return M()}for(n.method=s,n.arg=r;;){var o=n.delegate;if(o){var a=R(o,n);if(a){if(a===m)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===c)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var u=h(e,t,n);if("normal"===u.type){if(i=n.done?p:d,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=p,n.method="throw",n.arg=u.arg)}}}(e,n,o),r}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var c="suspendedStart",d="suspendedYield",f="executing",p="completed",m={};function g(){}function _(){}function v(){}var w={};w[r]=function(){return this};var y=Object.getPrototypeOf,S=y&&y(y(A([])));S&&S!==n&&i.call(S,r)&&(w=S);var C=v.prototype=g.prototype=Object.create(w);function b(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(e){var t;this._invoke=function(n,s){function r(){return new Promise(function(t,r){!function t(n,s,r,a){var u=h(e[n],e,s);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"===o(c)&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,r,a)},function(e){t("throw",e,r,a)}):Promise.resolve(c).then(function(e){l.value=e,r(l)},function(e){return t("throw",e,r,a)})}a(u.arg)}(n,s,t,r)})}return t=t?t.then(r,r):r()}}function R(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,R(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var s=h(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,m;var r=s.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function A(e){if(e){var n=e[r];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,o=function n(){for(;++s<e.length;)if(i.call(e,s))return n.value=e[s],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:M}}function M(){return{value:t,done:!0}}return _.prototype=C.constructor=v,v.constructor=_,v[u]=_.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(C),e},e.awrap=function(e){return{__await:e}},b(T.prototype),T.prototype[a]=function(){return this},e.AsyncIterator=T,e.async=function(t,n,i,s){var r=new T(l(t,n,i,s));return e.isGeneratorFunction(n)?r:r.next().then(function(e){return e.done?e.value:r.next()})},b(C),C[u]="Generator",C[r]=function(){return this},C.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=A,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function s(i,s){return a.type="throw",a.arg=e,n.next=i,s&&(n.method="next",n.arg=t),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var s=i.arg;E(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:A(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=i}catch(e){Function("r","regeneratorRuntime = r")(i)}},"./node_modules/@babel/runtime/regenerator/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/@babel/runtime/regenerator/index.js ***!
  \**********************************************************/
/*! no static exports found */function(e,t,n){e.exports=n(/*! regenerator-runtime */"./node_modules/@babel/runtime/node_modules/regenerator-runtime/runtime.js")},"./node_modules/aes-js/index.js":
/*!**************************************!*\
  !*** ./node_modules/aes-js/index.js ***!
  \**************************************/
/*! no static exports found */function(e,t,n){/*! MIT License. Copyright 2015-2018 Richard Moore <me@ricmoo.com>. See LICENSE.txt. */!function(t){"use strict";function n(e){return parseInt(e)===e}function i(e){if(!n(e.length))return!1;for(var t=0;t<e.length;t++)if(!n(e[t])||e[t]<0||e[t]>255)return!1;return!0}function s(e,t){if(e.buffer&&"Uint8Array"===e.name)return t&&(e=e.slice?e.slice():Array.prototype.slice.call(e)),e;if(Array.isArray(e)){if(!i(e))throw new Error("Array contains invalid value: "+e);return new Uint8Array(e)}if(n(e.length)&&i(e))return new Uint8Array(e);throw new Error("unsupported array-like object")}function r(e){return new Uint8Array(e)}function o(e,t,n,i,s){null==i&&null==s||(e=e.slice?e.slice(i,s):Array.prototype.slice.call(e,i,s)),t.set(e,n)}var a=function(){return{toBytes:function(e){var t=[],n=0;for(e=encodeURI(e);n<e.length;){var i=e.charCodeAt(n++);37===i?(t.push(parseInt(e.substr(n,2),16)),n+=2):t.push(i)}return s(t)},fromBytes:function(e){for(var t=[],n=0;n<e.length;){var i=e[n];i<128?(t.push(String.fromCharCode(i)),n++):i>191&&i<224?(t.push(String.fromCharCode((31&i)<<6|63&e[n+1])),n+=2):(t.push(String.fromCharCode((15&i)<<12|(63&e[n+1])<<6|63&e[n+2])),n+=3)}return t.join("")}}}(),u=function(){var e="0123456789abcdef";return{toBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},fromBytes:function(t){for(var n=[],i=0;i<t.length;i++){var s=t[i];n.push(e[(240&s)>>4]+e[15&s])}return n.join("")}}}(),l={16:10,24:12,32:14},h=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],c=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],d=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],f=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],p=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],m=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],g=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],_=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],v=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],w=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],y=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],S=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],C=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],b=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],T=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function R(e){for(var t=[],n=0;n<e.length;n+=4)t.push(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]);return t}var P=function e(t){if(!(this instanceof e))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:s(t,!0)}),this._prepare()};P.prototype._prepare=function(){var e=l[this.key.length];if(null==e)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var t=0;t<=e;t++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);var n,i=4*(e+1),s=this.key.length/4,r=R(this.key);for(t=0;t<s;t++)n=t>>2,this._Ke[n][t%4]=r[t],this._Kd[e-n][t%4]=r[t];for(var o,a=0,u=s;u<i;){if(o=r[s-1],r[0]^=c[o>>16&255]<<24^c[o>>8&255]<<16^c[255&o]<<8^c[o>>24&255]^h[a]<<24,a+=1,8!=s)for(t=1;t<s;t++)r[t]^=r[t-1];else{for(t=1;t<s/2;t++)r[t]^=r[t-1];o=r[s/2-1],r[s/2]^=c[255&o]^c[o>>8&255]<<8^c[o>>16&255]<<16^c[o>>24&255]<<24;for(t=s/2+1;t<s;t++)r[t]^=r[t-1]}for(t=0;t<s&&u<i;)d=u>>2,f=u%4,this._Ke[d][f]=r[t],this._Kd[e-d][f]=r[t++],u++}for(var d=1;d<e;d++)for(var f=0;f<4;f++)o=this._Kd[d][f],this._Kd[d][f]=S[o>>24&255]^C[o>>16&255]^b[o>>8&255]^T[255&o]},P.prototype.encrypt=function(e){if(16!=e.length)throw new Error("invalid plaintext size (must be 16 bytes)");for(var t=this._Ke.length-1,n=[0,0,0,0],i=R(e),s=0;s<4;s++)i[s]^=this._Ke[0][s];for(var o=1;o<t;o++){for(s=0;s<4;s++)n[s]=f[i[s]>>24&255]^p[i[(s+1)%4]>>16&255]^m[i[(s+2)%4]>>8&255]^g[255&i[(s+3)%4]]^this._Ke[o][s];i=n.slice()}var a,u=r(16);for(s=0;s<4;s++)a=this._Ke[t][s],u[4*s]=255&(c[i[s]>>24&255]^a>>24),u[4*s+1]=255&(c[i[(s+1)%4]>>16&255]^a>>16),u[4*s+2]=255&(c[i[(s+2)%4]>>8&255]^a>>8),u[4*s+3]=255&(c[255&i[(s+3)%4]]^a);return u},P.prototype.decrypt=function(e){if(16!=e.length)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var t=this._Kd.length-1,n=[0,0,0,0],i=R(e),s=0;s<4;s++)i[s]^=this._Kd[0][s];for(var o=1;o<t;o++){for(s=0;s<4;s++)n[s]=_[i[s]>>24&255]^v[i[(s+3)%4]>>16&255]^w[i[(s+2)%4]>>8&255]^y[255&i[(s+1)%4]]^this._Kd[o][s];i=n.slice()}var a,u=r(16);for(s=0;s<4;s++)a=this._Kd[t][s],u[4*s]=255&(d[i[s]>>24&255]^a>>24),u[4*s+1]=255&(d[i[(s+3)%4]>>16&255]^a>>16),u[4*s+2]=255&(d[i[(s+2)%4]>>8&255]^a>>8),u[4*s+3]=255&(d[255&i[(s+1)%4]]^a);return u};var E=function e(t){if(!(this instanceof e))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new P(t)};E.prototype.encrypt=function(e){if((e=s(e)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var t=r(e.length),n=r(16),i=0;i<e.length;i+=16)o(e,n,0,i,i+16),o(n=this._aes.encrypt(n),t,i);return t},E.prototype.decrypt=function(e){if((e=s(e)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var t=r(e.length),n=r(16),i=0;i<e.length;i+=16)o(e,n,0,i,i+16),o(n=this._aes.decrypt(n),t,i);return t};var I=function e(t,n){if(!(this instanceof e))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",n){if(16!=n.length)throw new Error("invalid initialation vector size (must be 16 bytes)")}else n=r(16);this._lastCipherblock=s(n,!0),this._aes=new P(t)};I.prototype.encrypt=function(e){if((e=s(e)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var t=r(e.length),n=r(16),i=0;i<e.length;i+=16){o(e,n,0,i,i+16);for(var a=0;a<16;a++)n[a]^=this._lastCipherblock[a];this._lastCipherblock=this._aes.encrypt(n),o(this._lastCipherblock,t,i)}return t},I.prototype.decrypt=function(e){if((e=s(e)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var t=r(e.length),n=r(16),i=0;i<e.length;i+=16){o(e,n,0,i,i+16),n=this._aes.decrypt(n);for(var a=0;a<16;a++)t[i+a]=n[a]^this._lastCipherblock[a];o(e,this._lastCipherblock,0,i,i+16)}return t};var A=function e(t,n,i){if(!(this instanceof e))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",n){if(16!=n.length)throw new Error("invalid initialation vector size (must be 16 size)")}else n=r(16);i||(i=1),this.segmentSize=i,this._shiftRegister=s(n,!0),this._aes=new P(t)};A.prototype.encrypt=function(e){if(e.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var t,n=s(e,!0),i=0;i<n.length;i+=this.segmentSize){t=this._aes.encrypt(this._shiftRegister);for(var r=0;r<this.segmentSize;r++)n[i+r]^=t[r];o(this._shiftRegister,this._shiftRegister,0,this.segmentSize),o(n,this._shiftRegister,16-this.segmentSize,i,i+this.segmentSize)}return n},A.prototype.decrypt=function(e){if(e.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var t,n=s(e,!0),i=0;i<n.length;i+=this.segmentSize){t=this._aes.encrypt(this._shiftRegister);for(var r=0;r<this.segmentSize;r++)n[i+r]^=t[r];o(this._shiftRegister,this._shiftRegister,0,this.segmentSize),o(e,this._shiftRegister,16-this.segmentSize,i,i+this.segmentSize)}return n};var M=function e(t,n){if(!(this instanceof e))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",n){if(16!=n.length)throw new Error("invalid initialation vector size (must be 16 bytes)")}else n=r(16);this._lastPrecipher=s(n,!0),this._lastPrecipherIndex=16,this._aes=new P(t)};M.prototype.encrypt=function(e){for(var t=s(e,!0),n=0;n<t.length;n++)16===this._lastPrecipherIndex&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),t[n]^=this._lastPrecipher[this._lastPrecipherIndex++];return t},M.prototype.decrypt=M.prototype.encrypt;var k=function e(t){if(!(this instanceof e))throw Error("Counter must be instanitated with `new`");0===t||t||(t=1),"number"==typeof t?(this._counter=r(16),this.setValue(t)):this.setBytes(t)};k.prototype.setValue=function(e){if("number"!=typeof e||parseInt(e)!=e)throw new Error("invalid counter value (must be an integer)");if(e>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var t=15;t>=0;--t)this._counter[t]=e%256,e=parseInt(e/256)},k.prototype.setBytes=function(e){if(16!=(e=s(e,!0)).length)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=e},k.prototype.increment=function(){for(var e=15;e>=0;e--){if(255!==this._counter[e]){this._counter[e]++;break}this._counter[e]=0}};var F=function e(t,n){if(!(this instanceof e))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",n instanceof k||(n=new k(n)),this._counter=n,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new P(t)};F.prototype.encrypt=function(e){for(var t=s(e,!0),n=0;n<t.length;n++)16===this._remainingCounterIndex&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),t[n]^=this._remainingCounter[this._remainingCounterIndex++];return t},F.prototype.decrypt=F.prototype.encrypt;var O={AES:P,Counter:k,ModeOfOperation:{ecb:E,cbc:I,cfb:A,ofb:M,ctr:F},utils:{hex:u,utf8:a},padding:{pkcs7:{pad:function(e){var t=16-(e=s(e,!0)).length%16,n=r(e.length+t);o(e,n);for(var i=e.length;i<n.length;i++)n[i]=t;return n},strip:function(e){if((e=s(e,!0)).length<16)throw new Error("PKCS#7 invalid length");var t=e[e.length-1];if(t>16)throw new Error("PKCS#7 padding byte out of range");for(var n=e.length-t,i=0;i<t;i++)if(e[n+i]!==t)throw new Error("PKCS#7 invalid padding byte");var a=r(n);return o(e,a,0,0,n),a}}},_arrayTest:{coerceArray:s,createArray:r,copyArray:o}};e.exports=O}()},"./node_modules/bn.js/lib/bn.js":
/*!**************************************!*\
  !*** ./node_modules/bn.js/lib/bn.js ***!
  \**************************************/
/*! no static exports found */function(e,t,n){(function(e){!function(e,t){"use strict";function i(e,t){if(!e)throw new Error(t||"Assertion failed")}function s(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}function r(e,t,n){if(r.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(n=t,t=10),this._init(e||0,t||10,n||"be"))}var a;"object"===o(e)?e.exports=r:t.BN=r,r.BN=r,r.wordSize=26;try{a=n(/*! buffer */0).Buffer}catch(e){}function u(e,t,n){for(var i=0,s=Math.min(e.length,n),r=t;r<s;r++){var o=e.charCodeAt(r)-48;i<<=4,i|=o>=49&&o<=54?o-49+10:o>=17&&o<=22?o-17+10:15&o}return i}function l(e,t,n,i){for(var s=0,r=Math.min(e.length,n),o=t;o<r;o++){var a=e.charCodeAt(o)-48;s*=i,s+=a>=49?a-49+10:a>=17?a-17+10:a}return s}r.isBN=function(e){return e instanceof r||null!==e&&"object"===o(e)&&e.constructor.wordSize===r.wordSize&&Array.isArray(e.words)},r.max=function(e,t){return e.cmp(t)>0?e:t},r.min=function(e,t){return e.cmp(t)<0?e:t},r.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"===o(e))return this._initArray(e,t,n);"hex"===t&&(t=16),i(t===(0|t)&&t>=2&&t<=36);var s=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&s++,16===t?this._parseHex(e,s):this._parseBase(e,t,s),"-"===e[0]&&(this.negative=1),this.strip(),"le"===n&&this._initArray(this.toArray(),t,n)},r.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(i(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},r.prototype._initArray=function(e,t,n){if(i("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,o,a=0;if("be"===n)for(s=e.length-1,r=0;s>=0;s-=3)o=e[s]|e[s-1]<<8|e[s-2]<<16,this.words[r]|=o<<a&67108863,this.words[r+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,r++);else if("le"===n)for(s=0,r=0;s<e.length;s+=3)o=e[s]|e[s+1]<<8|e[s+2]<<16,this.words[r]|=o<<a&67108863,this.words[r+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,r++);return this.strip()},r.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,s,r=0;for(n=e.length-6,i=0;n>=t;n-=6)s=u(e,n,n+6),this.words[i]|=s<<r&67108863,this.words[i+1]|=s>>>26-r&4194303,(r+=24)>=26&&(r-=26,i++);n+6!==t&&(s=u(e,t,n+6),this.words[i]|=s<<r&67108863,this.words[i+1]|=s>>>26-r&4194303),this.strip()},r.prototype._parseBase=function(e,t,n){this.words=[0],this.length=1;for(var i=0,s=1;s<=67108863;s*=t)i++;i--,s=s/t|0;for(var r=e.length-n,o=r%i,a=Math.min(r,r-o)+n,u=0,h=n;h<a;h+=i)u=l(e,h,h+i,t),this.imuln(s),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==o){var c=1;for(u=l(e,h,e.length,t),h=0;h<o;h++)c*=t;this.imuln(c),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}},r.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},r.prototype.clone=function(){var e=new r(null);return this.copy(e),e},r.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},r.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},r.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},r.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var h=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],c=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,n){n.negative=t.negative^e.negative;var i=e.length+t.length|0;n.length=i,i=i-1|0;var s=0|e.words[0],r=0|t.words[0],o=s*r,a=67108863&o,u=o/67108864|0;n.words[0]=a;for(var l=1;l<i;l++){for(var h=u>>>26,c=67108863&u,d=Math.min(l,t.length-1),f=Math.max(0,l-e.length+1);f<=d;f++){var p=l-f|0;h+=(o=(s=0|e.words[p])*(r=0|t.words[f])+c)/67108864|0,c=67108863&o}n.words[l]=0|c,u=0|h}return 0!==u?n.words[l]=0|u:n.length--,n.strip()}r.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var s=0,r=0,o=0;o<this.length;o++){var a=this.words[o],u=(16777215&(a<<s|r)).toString(16);n=0!==(r=a>>>24-s&16777215)||o!==this.length-1?h[6-u.length]+u+n:u+n,(s+=2)>=26&&(s-=26,o--)}for(0!==r&&(n=r.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=c[e],f=d[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);n=(p=p.idivn(f)).isZero()?m+n:h[l-m.length]+m+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}i(!1,"Base should be between 2 and 36")},r.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},r.prototype.toJSON=function(){return this.toString(16)},r.prototype.toBuffer=function(e,t){return i(void 0!==a),this.toArrayLike(a,e,t)},r.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},r.prototype.toArrayLike=function(e,t,n){var s=this.byteLength(),r=n||Math.max(1,s);i(s<=r,"byte array longer than desired length"),i(r>0,"Requested array length <= 0"),this.strip();var o,a,u="le"===t,l=new e(r),h=this.clone();if(u){for(a=0;!h.isZero();a++)o=h.andln(255),h.iushrn(8),l[a]=o;for(;a<r;a++)l[a]=0}else{for(a=0;a<r-s;a++)l[a]=0;for(a=0;!h.isZero();a++)o=h.andln(255),h.iushrn(8),l[r-a-1]=o}return l},Math.clz32?r.prototype._countBits=function(e){return 32-Math.clz32(e)}:r.prototype._countBits=function(e){var t=e,n=0;return t>=4096&&(n+=13,t>>>=13),t>=64&&(n+=7,t>>>=7),t>=8&&(n+=4,t>>>=4),t>=2&&(n+=2,t>>>=2),n+t},r.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,n=0;return 0==(8191&t)&&(n+=13,t>>>=13),0==(127&t)&&(n+=7,t>>>=7),0==(15&t)&&(n+=4,t>>>=4),0==(3&t)&&(n+=2,t>>>=2),0==(1&t)&&n++,n},r.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},r.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var n=this._zeroBits(this.words[t]);if(e+=n,26!==n)break}return e},r.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},r.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},r.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},r.prototype.isNeg=function(){return 0!==this.negative},r.prototype.neg=function(){return this.clone().ineg()},r.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},r.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},r.prototype.ior=function(e){return i(0==(this.negative|e.negative)),this.iuor(e)},r.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},r.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},r.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var n=0;n<t.length;n++)this.words[n]=this.words[n]&e.words[n];return this.length=t.length,this.strip()},r.prototype.iand=function(e){return i(0==(this.negative|e.negative)),this.iuand(e)},r.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},r.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},r.prototype.iuxor=function(e){var t,n;this.length>e.length?(t=this,n=e):(t=e,n=this);for(var i=0;i<n.length;i++)this.words[i]=t.words[i]^n.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this.strip()},r.prototype.ixor=function(e){return i(0==(this.negative|e.negative)),this.iuxor(e)},r.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},r.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},r.prototype.inotn=function(e){i("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var s=0;s<t;s++)this.words[s]=67108863&~this.words[s];return n>0&&(this.words[s]=~this.words[s]&67108863>>26-n),this.strip()},r.prototype.notn=function(e){return this.clone().inotn(e)},r.prototype.setn=function(e,t){i("number"==typeof e&&e>=0);var n=e/26|0,s=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<s:this.words[n]&~(1<<s),this.strip()},r.prototype.iadd=function(e){var t,n,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(n=this,i=e):(n=e,i=this);for(var s=0,r=0;r<i.length;r++)t=(0|n.words[r])+(0|i.words[r])+s,this.words[r]=67108863&t,s=t>>>26;for(;0!==s&&r<n.length;r++)t=(0|n.words[r])+s,this.words[r]=67108863&t,s=t>>>26;if(this.length=n.length,0!==s)this.words[this.length]=s,this.length++;else if(n!==this)for(;r<n.length;r++)this.words[r]=n.words[r];return this},r.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},r.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var n,i,s=this.cmp(e);if(0===s)return this.negative=0,this.length=1,this.words[0]=0,this;s>0?(n=this,i=e):(n=e,i=this);for(var r=0,o=0;o<i.length;o++)r=(t=(0|n.words[o])-(0|i.words[o])+r)>>26,this.words[o]=67108863&t;for(;0!==r&&o<n.length;o++)r=(t=(0|n.words[o])+r)>>26,this.words[o]=67108863&t;if(0===r&&o<n.length&&n!==this)for(;o<n.length;o++)this.words[o]=n.words[o];return this.length=Math.max(this.length,o),n!==this&&(this.negative=1),this.strip()},r.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,n){var i,s,r,o=e.words,a=t.words,u=n.words,l=0,h=0|o[0],c=8191&h,d=h>>>13,f=0|o[1],p=8191&f,m=f>>>13,g=0|o[2],_=8191&g,v=g>>>13,w=0|o[3],y=8191&w,S=w>>>13,C=0|o[4],b=8191&C,T=C>>>13,R=0|o[5],P=8191&R,E=R>>>13,I=0|o[6],A=8191&I,M=I>>>13,k=0|o[7],F=8191&k,O=k>>>13,D=0|o[8],x=8191&D,B=D>>>13,q=0|o[9],G=8191&q,L=q>>>13,j=0|a[0],H=8191&j,N=j>>>13,U=0|a[1],K=8191&U,W=U>>>13,V=0|a[2],J=8191&V,z=V>>>13,Y=0|a[3],Z=8191&Y,X=Y>>>13,$=0|a[4],Q=8191&$,ee=$>>>13,te=0|a[5],ne=8191&te,ie=te>>>13,se=0|a[6],re=8191&se,oe=se>>>13,ae=0|a[7],ue=8191&ae,le=ae>>>13,he=0|a[8],ce=8191&he,de=he>>>13,fe=0|a[9],pe=8191&fe,me=fe>>>13;n.negative=e.negative^t.negative,n.length=19;var ge=(l+(i=Math.imul(c,H))|0)+((8191&(s=(s=Math.imul(c,N))+Math.imul(d,H)|0))<<13)|0;l=((r=Math.imul(d,N))+(s>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(p,H),s=(s=Math.imul(p,N))+Math.imul(m,H)|0,r=Math.imul(m,N);var _e=(l+(i=i+Math.imul(c,K)|0)|0)+((8191&(s=(s=s+Math.imul(c,W)|0)+Math.imul(d,K)|0))<<13)|0;l=((r=r+Math.imul(d,W)|0)+(s>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(_,H),s=(s=Math.imul(_,N))+Math.imul(v,H)|0,r=Math.imul(v,N),i=i+Math.imul(p,K)|0,s=(s=s+Math.imul(p,W)|0)+Math.imul(m,K)|0,r=r+Math.imul(m,W)|0;var ve=(l+(i=i+Math.imul(c,J)|0)|0)+((8191&(s=(s=s+Math.imul(c,z)|0)+Math.imul(d,J)|0))<<13)|0;l=((r=r+Math.imul(d,z)|0)+(s>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(y,H),s=(s=Math.imul(y,N))+Math.imul(S,H)|0,r=Math.imul(S,N),i=i+Math.imul(_,K)|0,s=(s=s+Math.imul(_,W)|0)+Math.imul(v,K)|0,r=r+Math.imul(v,W)|0,i=i+Math.imul(p,J)|0,s=(s=s+Math.imul(p,z)|0)+Math.imul(m,J)|0,r=r+Math.imul(m,z)|0;var we=(l+(i=i+Math.imul(c,Z)|0)|0)+((8191&(s=(s=s+Math.imul(c,X)|0)+Math.imul(d,Z)|0))<<13)|0;l=((r=r+Math.imul(d,X)|0)+(s>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(b,H),s=(s=Math.imul(b,N))+Math.imul(T,H)|0,r=Math.imul(T,N),i=i+Math.imul(y,K)|0,s=(s=s+Math.imul(y,W)|0)+Math.imul(S,K)|0,r=r+Math.imul(S,W)|0,i=i+Math.imul(_,J)|0,s=(s=s+Math.imul(_,z)|0)+Math.imul(v,J)|0,r=r+Math.imul(v,z)|0,i=i+Math.imul(p,Z)|0,s=(s=s+Math.imul(p,X)|0)+Math.imul(m,Z)|0,r=r+Math.imul(m,X)|0;var ye=(l+(i=i+Math.imul(c,Q)|0)|0)+((8191&(s=(s=s+Math.imul(c,ee)|0)+Math.imul(d,Q)|0))<<13)|0;l=((r=r+Math.imul(d,ee)|0)+(s>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(P,H),s=(s=Math.imul(P,N))+Math.imul(E,H)|0,r=Math.imul(E,N),i=i+Math.imul(b,K)|0,s=(s=s+Math.imul(b,W)|0)+Math.imul(T,K)|0,r=r+Math.imul(T,W)|0,i=i+Math.imul(y,J)|0,s=(s=s+Math.imul(y,z)|0)+Math.imul(S,J)|0,r=r+Math.imul(S,z)|0,i=i+Math.imul(_,Z)|0,s=(s=s+Math.imul(_,X)|0)+Math.imul(v,Z)|0,r=r+Math.imul(v,X)|0,i=i+Math.imul(p,Q)|0,s=(s=s+Math.imul(p,ee)|0)+Math.imul(m,Q)|0,r=r+Math.imul(m,ee)|0;var Se=(l+(i=i+Math.imul(c,ne)|0)|0)+((8191&(s=(s=s+Math.imul(c,ie)|0)+Math.imul(d,ne)|0))<<13)|0;l=((r=r+Math.imul(d,ie)|0)+(s>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,H),s=(s=Math.imul(A,N))+Math.imul(M,H)|0,r=Math.imul(M,N),i=i+Math.imul(P,K)|0,s=(s=s+Math.imul(P,W)|0)+Math.imul(E,K)|0,r=r+Math.imul(E,W)|0,i=i+Math.imul(b,J)|0,s=(s=s+Math.imul(b,z)|0)+Math.imul(T,J)|0,r=r+Math.imul(T,z)|0,i=i+Math.imul(y,Z)|0,s=(s=s+Math.imul(y,X)|0)+Math.imul(S,Z)|0,r=r+Math.imul(S,X)|0,i=i+Math.imul(_,Q)|0,s=(s=s+Math.imul(_,ee)|0)+Math.imul(v,Q)|0,r=r+Math.imul(v,ee)|0,i=i+Math.imul(p,ne)|0,s=(s=s+Math.imul(p,ie)|0)+Math.imul(m,ne)|0,r=r+Math.imul(m,ie)|0;var Ce=(l+(i=i+Math.imul(c,re)|0)|0)+((8191&(s=(s=s+Math.imul(c,oe)|0)+Math.imul(d,re)|0))<<13)|0;l=((r=r+Math.imul(d,oe)|0)+(s>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(F,H),s=(s=Math.imul(F,N))+Math.imul(O,H)|0,r=Math.imul(O,N),i=i+Math.imul(A,K)|0,s=(s=s+Math.imul(A,W)|0)+Math.imul(M,K)|0,r=r+Math.imul(M,W)|0,i=i+Math.imul(P,J)|0,s=(s=s+Math.imul(P,z)|0)+Math.imul(E,J)|0,r=r+Math.imul(E,z)|0,i=i+Math.imul(b,Z)|0,s=(s=s+Math.imul(b,X)|0)+Math.imul(T,Z)|0,r=r+Math.imul(T,X)|0,i=i+Math.imul(y,Q)|0,s=(s=s+Math.imul(y,ee)|0)+Math.imul(S,Q)|0,r=r+Math.imul(S,ee)|0,i=i+Math.imul(_,ne)|0,s=(s=s+Math.imul(_,ie)|0)+Math.imul(v,ne)|0,r=r+Math.imul(v,ie)|0,i=i+Math.imul(p,re)|0,s=(s=s+Math.imul(p,oe)|0)+Math.imul(m,re)|0,r=r+Math.imul(m,oe)|0;var be=(l+(i=i+Math.imul(c,ue)|0)|0)+((8191&(s=(s=s+Math.imul(c,le)|0)+Math.imul(d,ue)|0))<<13)|0;l=((r=r+Math.imul(d,le)|0)+(s>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(x,H),s=(s=Math.imul(x,N))+Math.imul(B,H)|0,r=Math.imul(B,N),i=i+Math.imul(F,K)|0,s=(s=s+Math.imul(F,W)|0)+Math.imul(O,K)|0,r=r+Math.imul(O,W)|0,i=i+Math.imul(A,J)|0,s=(s=s+Math.imul(A,z)|0)+Math.imul(M,J)|0,r=r+Math.imul(M,z)|0,i=i+Math.imul(P,Z)|0,s=(s=s+Math.imul(P,X)|0)+Math.imul(E,Z)|0,r=r+Math.imul(E,X)|0,i=i+Math.imul(b,Q)|0,s=(s=s+Math.imul(b,ee)|0)+Math.imul(T,Q)|0,r=r+Math.imul(T,ee)|0,i=i+Math.imul(y,ne)|0,s=(s=s+Math.imul(y,ie)|0)+Math.imul(S,ne)|0,r=r+Math.imul(S,ie)|0,i=i+Math.imul(_,re)|0,s=(s=s+Math.imul(_,oe)|0)+Math.imul(v,re)|0,r=r+Math.imul(v,oe)|0,i=i+Math.imul(p,ue)|0,s=(s=s+Math.imul(p,le)|0)+Math.imul(m,ue)|0,r=r+Math.imul(m,le)|0;var Te=(l+(i=i+Math.imul(c,ce)|0)|0)+((8191&(s=(s=s+Math.imul(c,de)|0)+Math.imul(d,ce)|0))<<13)|0;l=((r=r+Math.imul(d,de)|0)+(s>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(G,H),s=(s=Math.imul(G,N))+Math.imul(L,H)|0,r=Math.imul(L,N),i=i+Math.imul(x,K)|0,s=(s=s+Math.imul(x,W)|0)+Math.imul(B,K)|0,r=r+Math.imul(B,W)|0,i=i+Math.imul(F,J)|0,s=(s=s+Math.imul(F,z)|0)+Math.imul(O,J)|0,r=r+Math.imul(O,z)|0,i=i+Math.imul(A,Z)|0,s=(s=s+Math.imul(A,X)|0)+Math.imul(M,Z)|0,r=r+Math.imul(M,X)|0,i=i+Math.imul(P,Q)|0,s=(s=s+Math.imul(P,ee)|0)+Math.imul(E,Q)|0,r=r+Math.imul(E,ee)|0,i=i+Math.imul(b,ne)|0,s=(s=s+Math.imul(b,ie)|0)+Math.imul(T,ne)|0,r=r+Math.imul(T,ie)|0,i=i+Math.imul(y,re)|0,s=(s=s+Math.imul(y,oe)|0)+Math.imul(S,re)|0,r=r+Math.imul(S,oe)|0,i=i+Math.imul(_,ue)|0,s=(s=s+Math.imul(_,le)|0)+Math.imul(v,ue)|0,r=r+Math.imul(v,le)|0,i=i+Math.imul(p,ce)|0,s=(s=s+Math.imul(p,de)|0)+Math.imul(m,ce)|0,r=r+Math.imul(m,de)|0;var Re=(l+(i=i+Math.imul(c,pe)|0)|0)+((8191&(s=(s=s+Math.imul(c,me)|0)+Math.imul(d,pe)|0))<<13)|0;l=((r=r+Math.imul(d,me)|0)+(s>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(G,K),s=(s=Math.imul(G,W))+Math.imul(L,K)|0,r=Math.imul(L,W),i=i+Math.imul(x,J)|0,s=(s=s+Math.imul(x,z)|0)+Math.imul(B,J)|0,r=r+Math.imul(B,z)|0,i=i+Math.imul(F,Z)|0,s=(s=s+Math.imul(F,X)|0)+Math.imul(O,Z)|0,r=r+Math.imul(O,X)|0,i=i+Math.imul(A,Q)|0,s=(s=s+Math.imul(A,ee)|0)+Math.imul(M,Q)|0,r=r+Math.imul(M,ee)|0,i=i+Math.imul(P,ne)|0,s=(s=s+Math.imul(P,ie)|0)+Math.imul(E,ne)|0,r=r+Math.imul(E,ie)|0,i=i+Math.imul(b,re)|0,s=(s=s+Math.imul(b,oe)|0)+Math.imul(T,re)|0,r=r+Math.imul(T,oe)|0,i=i+Math.imul(y,ue)|0,s=(s=s+Math.imul(y,le)|0)+Math.imul(S,ue)|0,r=r+Math.imul(S,le)|0,i=i+Math.imul(_,ce)|0,s=(s=s+Math.imul(_,de)|0)+Math.imul(v,ce)|0,r=r+Math.imul(v,de)|0;var Pe=(l+(i=i+Math.imul(p,pe)|0)|0)+((8191&(s=(s=s+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;l=((r=r+Math.imul(m,me)|0)+(s>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,i=Math.imul(G,J),s=(s=Math.imul(G,z))+Math.imul(L,J)|0,r=Math.imul(L,z),i=i+Math.imul(x,Z)|0,s=(s=s+Math.imul(x,X)|0)+Math.imul(B,Z)|0,r=r+Math.imul(B,X)|0,i=i+Math.imul(F,Q)|0,s=(s=s+Math.imul(F,ee)|0)+Math.imul(O,Q)|0,r=r+Math.imul(O,ee)|0,i=i+Math.imul(A,ne)|0,s=(s=s+Math.imul(A,ie)|0)+Math.imul(M,ne)|0,r=r+Math.imul(M,ie)|0,i=i+Math.imul(P,re)|0,s=(s=s+Math.imul(P,oe)|0)+Math.imul(E,re)|0,r=r+Math.imul(E,oe)|0,i=i+Math.imul(b,ue)|0,s=(s=s+Math.imul(b,le)|0)+Math.imul(T,ue)|0,r=r+Math.imul(T,le)|0,i=i+Math.imul(y,ce)|0,s=(s=s+Math.imul(y,de)|0)+Math.imul(S,ce)|0,r=r+Math.imul(S,de)|0;var Ee=(l+(i=i+Math.imul(_,pe)|0)|0)+((8191&(s=(s=s+Math.imul(_,me)|0)+Math.imul(v,pe)|0))<<13)|0;l=((r=r+Math.imul(v,me)|0)+(s>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(G,Z),s=(s=Math.imul(G,X))+Math.imul(L,Z)|0,r=Math.imul(L,X),i=i+Math.imul(x,Q)|0,s=(s=s+Math.imul(x,ee)|0)+Math.imul(B,Q)|0,r=r+Math.imul(B,ee)|0,i=i+Math.imul(F,ne)|0,s=(s=s+Math.imul(F,ie)|0)+Math.imul(O,ne)|0,r=r+Math.imul(O,ie)|0,i=i+Math.imul(A,re)|0,s=(s=s+Math.imul(A,oe)|0)+Math.imul(M,re)|0,r=r+Math.imul(M,oe)|0,i=i+Math.imul(P,ue)|0,s=(s=s+Math.imul(P,le)|0)+Math.imul(E,ue)|0,r=r+Math.imul(E,le)|0,i=i+Math.imul(b,ce)|0,s=(s=s+Math.imul(b,de)|0)+Math.imul(T,ce)|0,r=r+Math.imul(T,de)|0;var Ie=(l+(i=i+Math.imul(y,pe)|0)|0)+((8191&(s=(s=s+Math.imul(y,me)|0)+Math.imul(S,pe)|0))<<13)|0;l=((r=r+Math.imul(S,me)|0)+(s>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(G,Q),s=(s=Math.imul(G,ee))+Math.imul(L,Q)|0,r=Math.imul(L,ee),i=i+Math.imul(x,ne)|0,s=(s=s+Math.imul(x,ie)|0)+Math.imul(B,ne)|0,r=r+Math.imul(B,ie)|0,i=i+Math.imul(F,re)|0,s=(s=s+Math.imul(F,oe)|0)+Math.imul(O,re)|0,r=r+Math.imul(O,oe)|0,i=i+Math.imul(A,ue)|0,s=(s=s+Math.imul(A,le)|0)+Math.imul(M,ue)|0,r=r+Math.imul(M,le)|0,i=i+Math.imul(P,ce)|0,s=(s=s+Math.imul(P,de)|0)+Math.imul(E,ce)|0,r=r+Math.imul(E,de)|0;var Ae=(l+(i=i+Math.imul(b,pe)|0)|0)+((8191&(s=(s=s+Math.imul(b,me)|0)+Math.imul(T,pe)|0))<<13)|0;l=((r=r+Math.imul(T,me)|0)+(s>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(G,ne),s=(s=Math.imul(G,ie))+Math.imul(L,ne)|0,r=Math.imul(L,ie),i=i+Math.imul(x,re)|0,s=(s=s+Math.imul(x,oe)|0)+Math.imul(B,re)|0,r=r+Math.imul(B,oe)|0,i=i+Math.imul(F,ue)|0,s=(s=s+Math.imul(F,le)|0)+Math.imul(O,ue)|0,r=r+Math.imul(O,le)|0,i=i+Math.imul(A,ce)|0,s=(s=s+Math.imul(A,de)|0)+Math.imul(M,ce)|0,r=r+Math.imul(M,de)|0;var Me=(l+(i=i+Math.imul(P,pe)|0)|0)+((8191&(s=(s=s+Math.imul(P,me)|0)+Math.imul(E,pe)|0))<<13)|0;l=((r=r+Math.imul(E,me)|0)+(s>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(G,re),s=(s=Math.imul(G,oe))+Math.imul(L,re)|0,r=Math.imul(L,oe),i=i+Math.imul(x,ue)|0,s=(s=s+Math.imul(x,le)|0)+Math.imul(B,ue)|0,r=r+Math.imul(B,le)|0,i=i+Math.imul(F,ce)|0,s=(s=s+Math.imul(F,de)|0)+Math.imul(O,ce)|0,r=r+Math.imul(O,de)|0;var ke=(l+(i=i+Math.imul(A,pe)|0)|0)+((8191&(s=(s=s+Math.imul(A,me)|0)+Math.imul(M,pe)|0))<<13)|0;l=((r=r+Math.imul(M,me)|0)+(s>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(G,ue),s=(s=Math.imul(G,le))+Math.imul(L,ue)|0,r=Math.imul(L,le),i=i+Math.imul(x,ce)|0,s=(s=s+Math.imul(x,de)|0)+Math.imul(B,ce)|0,r=r+Math.imul(B,de)|0;var Fe=(l+(i=i+Math.imul(F,pe)|0)|0)+((8191&(s=(s=s+Math.imul(F,me)|0)+Math.imul(O,pe)|0))<<13)|0;l=((r=r+Math.imul(O,me)|0)+(s>>>13)|0)+(Fe>>>26)|0,Fe&=67108863,i=Math.imul(G,ce),s=(s=Math.imul(G,de))+Math.imul(L,ce)|0,r=Math.imul(L,de);var Oe=(l+(i=i+Math.imul(x,pe)|0)|0)+((8191&(s=(s=s+Math.imul(x,me)|0)+Math.imul(B,pe)|0))<<13)|0;l=((r=r+Math.imul(B,me)|0)+(s>>>13)|0)+(Oe>>>26)|0,Oe&=67108863;var De=(l+(i=Math.imul(G,pe))|0)+((8191&(s=(s=Math.imul(G,me))+Math.imul(L,pe)|0))<<13)|0;return l=((r=Math.imul(L,me))+(s>>>13)|0)+(De>>>26)|0,De&=67108863,u[0]=ge,u[1]=_e,u[2]=ve,u[3]=we,u[4]=ye,u[5]=Se,u[6]=Ce,u[7]=be,u[8]=Te,u[9]=Re,u[10]=Pe,u[11]=Ee,u[12]=Ie,u[13]=Ae,u[14]=Me,u[15]=ke,u[16]=Fe,u[17]=Oe,u[18]=De,0!==l&&(u[19]=l,n.length++),n};function m(e,t,n){return(new g).mulp(e,t,n)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),r.prototype.mulTo=function(e,t){var n=this.length+e.length;return 10===this.length&&10===e.length?p(this,e,t):n<63?f(this,e,t):n<1024?function(e,t,n){n.negative=t.negative^e.negative,n.length=e.length+t.length;for(var i=0,s=0,r=0;r<n.length-1;r++){var o=s;s=0;for(var a=67108863&i,u=Math.min(r,t.length-1),l=Math.max(0,r-e.length+1);l<=u;l++){var h=r-l,c=(0|e.words[h])*(0|t.words[l]),d=67108863&c;a=67108863&(d=d+a|0),s+=(o=(o=o+(c/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}n.words[r]=a,i=o,o=s}return 0!==i?n.words[r]=i:n.length--,n.strip()}(this,e,t):m(this,e,t)},g.prototype.makeRBT=function(e){for(var t=new Array(e),n=r.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,n,e);return t},g.prototype.revBin=function(e,t,n){if(0===e||e===n-1)return e;for(var i=0,s=0;s<t;s++)i|=(1&e)<<t-s-1,e>>=1;return i},g.prototype.permute=function(e,t,n,i,s,r){for(var o=0;o<r;o++)i[o]=t[e[o]],s[o]=n[e[o]]},g.prototype.transform=function(e,t,n,i,s,r){this.permute(r,e,t,n,i,s);for(var o=1;o<s;o<<=1)for(var a=o<<1,u=Math.cos(2*Math.PI/a),l=Math.sin(2*Math.PI/a),h=0;h<s;h+=a)for(var c=u,d=l,f=0;f<o;f++){var p=n[h+f],m=i[h+f],g=n[h+f+o],_=i[h+f+o],v=c*g-d*_;_=c*_+d*g,g=v,n[h+f]=p+g,i[h+f]=m+_,n[h+f+o]=p-g,i[h+f+o]=m-_,f!==a&&(v=u*c-l*d,d=u*d+l*c,c=v)}},g.prototype.guessLen13b=function(e,t){var n=1|Math.max(t,e),i=1&n,s=0;for(n=n/2|0;n;n>>>=1)s++;return 1<<s+1+i},g.prototype.conjugate=function(e,t,n){if(!(n<=1))for(var i=0;i<n/2;i++){var s=e[i];e[i]=e[n-i-1],e[n-i-1]=s,s=t[i],t[i]=-t[n-i-1],t[n-i-1]=-s}},g.prototype.normalize13b=function(e,t){for(var n=0,i=0;i<t/2;i++){var s=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+n;e[i]=67108863&s,n=s<67108864?0:s/67108864|0}return e},g.prototype.convert13b=function(e,t,n,s){for(var r=0,o=0;o<t;o++)r+=0|e[o],n[2*o]=8191&r,r>>>=13,n[2*o+1]=8191&r,r>>>=13;for(o=2*t;o<s;++o)n[o]=0;i(0===r),i(0==(-8192&r))},g.prototype.stub=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=0;return t},g.prototype.mulp=function(e,t,n){var i=2*this.guessLen13b(e.length,t.length),s=this.makeRBT(i),r=this.stub(i),o=new Array(i),a=new Array(i),u=new Array(i),l=new Array(i),h=new Array(i),c=new Array(i),d=n.words;d.length=i,this.convert13b(e.words,e.length,o,i),this.convert13b(t.words,t.length,l,i),this.transform(o,r,a,u,i,s),this.transform(l,r,h,c,i,s);for(var f=0;f<i;f++){var p=a[f]*h[f]-u[f]*c[f];u[f]=a[f]*c[f]+u[f]*h[f],a[f]=p}return this.conjugate(a,u,i),this.transform(a,u,d,r,i,s),this.conjugate(d,r,i),this.normalize13b(d,i),n.negative=e.negative^t.negative,n.length=e.length+t.length,n.strip()},r.prototype.mul=function(e){var t=new r(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},r.prototype.mulf=function(e){var t=new r(null);return t.words=new Array(this.length+e.length),m(this,e,t)},r.prototype.imul=function(e){return this.clone().mulTo(e,this)},r.prototype.imuln=function(e){i("number"==typeof e),i(e<67108864);for(var t=0,n=0;n<this.length;n++){var s=(0|this.words[n])*e,r=(67108863&s)+(67108863&t);t>>=26,t+=s/67108864|0,t+=r>>>26,this.words[n]=67108863&r}return 0!==t&&(this.words[n]=t,this.length++),this},r.prototype.muln=function(e){return this.clone().imuln(e)},r.prototype.sqr=function(){return this.mul(this)},r.prototype.isqr=function(){return this.imul(this.clone())},r.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),n=0;n<t.length;n++){var i=n/26|0,s=n%26;t[n]=(e.words[i]&1<<s)>>>s}return t}(e);if(0===t.length)return new r(1);for(var n=this,i=0;i<t.length&&0===t[i];i++,n=n.sqr());if(++i<t.length)for(var s=n.sqr();i<t.length;i++,s=s.sqr())0!==t[i]&&(n=n.mul(s));return n},r.prototype.iushln=function(e){i("number"==typeof e&&e>=0);var t,n=e%26,s=(e-n)/26,r=67108863>>>26-n<<26-n;if(0!==n){var o=0;for(t=0;t<this.length;t++){var a=this.words[t]&r,u=(0|this.words[t])-a<<n;this.words[t]=u|o,o=a>>>26-n}o&&(this.words[t]=o,this.length++)}if(0!==s){for(t=this.length-1;t>=0;t--)this.words[t+s]=this.words[t];for(t=0;t<s;t++)this.words[t]=0;this.length+=s}return this.strip()},r.prototype.ishln=function(e){return i(0===this.negative),this.iushln(e)},r.prototype.iushrn=function(e,t,n){var s;i("number"==typeof e&&e>=0),s=t?(t-t%26)/26:0;var r=e%26,o=Math.min((e-r)/26,this.length),a=67108863^67108863>>>r<<r,u=n;if(s-=o,s=Math.max(0,s),u){for(var l=0;l<o;l++)u.words[l]=this.words[l];u.length=o}if(0===o);else if(this.length>o)for(this.length-=o,l=0;l<this.length;l++)this.words[l]=this.words[l+o];else this.words[0]=0,this.length=1;var h=0;for(l=this.length-1;l>=0&&(0!==h||l>=s);l--){var c=0|this.words[l];this.words[l]=h<<26-r|c>>>r,h=c&a}return u&&0!==h&&(u.words[u.length++]=h),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},r.prototype.ishrn=function(e,t,n){return i(0===this.negative),this.iushrn(e,t,n)},r.prototype.shln=function(e){return this.clone().ishln(e)},r.prototype.ushln=function(e){return this.clone().iushln(e)},r.prototype.shrn=function(e){return this.clone().ishrn(e)},r.prototype.ushrn=function(e){return this.clone().iushrn(e)},r.prototype.testn=function(e){i("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,s=1<<t;return!(this.length<=n)&&!!(this.words[n]&s)},r.prototype.imaskn=function(e){i("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var s=67108863^67108863>>>t<<t;this.words[this.length-1]&=s}return this.strip()},r.prototype.maskn=function(e){return this.clone().imaskn(e)},r.prototype.iaddn=function(e){return i("number"==typeof e),i(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},r.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},r.prototype.isubn=function(e){if(i("number"==typeof e),i(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},r.prototype.addn=function(e){return this.clone().iaddn(e)},r.prototype.subn=function(e){return this.clone().isubn(e)},r.prototype.iabs=function(){return this.negative=0,this},r.prototype.abs=function(){return this.clone().iabs()},r.prototype._ishlnsubmul=function(e,t,n){var s,r,o=e.length+n;this._expand(o);var a=0;for(s=0;s<e.length;s++){r=(0|this.words[s+n])+a;var u=(0|e.words[s])*t;a=((r-=67108863&u)>>26)-(u/67108864|0),this.words[s+n]=67108863&r}for(;s<this.length-n;s++)a=(r=(0|this.words[s+n])+a)>>26,this.words[s+n]=67108863&r;if(0===a)return this.strip();for(i(-1===a),a=0,s=0;s<this.length;s++)a=(r=-(0|this.words[s])+a)>>26,this.words[s]=67108863&r;return this.negative=1,this.strip()},r.prototype._wordDiv=function(e,t){var n=(this.length,e.length),i=this.clone(),s=e,o=0|s.words[s.length-1];0!==(n=26-this._countBits(o))&&(s=s.ushln(n),i.iushln(n),o=0|s.words[s.length-1]);var a,u=i.length-s.length;if("mod"!==t){(a=new r(null)).length=u+1,a.words=new Array(a.length);for(var l=0;l<a.length;l++)a.words[l]=0}var h=i.clone()._ishlnsubmul(s,1,u);0===h.negative&&(i=h,a&&(a.words[u]=1));for(var c=u-1;c>=0;c--){var d=67108864*(0|i.words[s.length+c])+(0|i.words[s.length+c-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(s,d,c);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(s,1,c),i.isZero()||(i.negative^=1);a&&(a.words[c]=d)}return a&&a.strip(),i.strip(),"div"!==t&&0!==n&&i.iushrn(n),{div:a||null,mod:i}},r.prototype.divmod=function(e,t,n){return i(!e.isZero()),this.isZero()?{div:new r(0),mod:new r(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(s=a.div.neg()),"div"!==t&&(o=a.mod.neg(),n&&0!==o.negative&&o.iadd(e)),{div:s,mod:o}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(s=a.div.neg()),{div:s,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(o=a.mod.neg(),n&&0!==o.negative&&o.isub(e)),{div:a.div,mod:o}):e.length>this.length||this.cmp(e)<0?{div:new r(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new r(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new r(this.modn(e.words[0]))}:this._wordDiv(e,t);var s,o,a},r.prototype.div=function(e){return this.divmod(e,"div",!1).div},r.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},r.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},r.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var n=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),s=e.andln(1),r=n.cmp(i);return r<0||1===s&&0===r?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},r.prototype.modn=function(e){i(e<=67108863);for(var t=(1<<26)%e,n=0,s=this.length-1;s>=0;s--)n=(t*n+(0|this.words[s]))%e;return n},r.prototype.idivn=function(e){i(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var s=(0|this.words[n])+67108864*t;this.words[n]=s/e|0,t=s%e}return this.strip()},r.prototype.divn=function(e){return this.clone().idivn(e)},r.prototype.egcd=function(e){i(0===e.negative),i(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s=new r(1),o=new r(0),a=new r(0),u=new r(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var h=n.clone(),c=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(s.isOdd()||o.isOdd())&&(s.iadd(h),o.isub(c)),s.iushrn(1),o.iushrn(1);for(var p=0,m=1;0==(n.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(a.isOdd()||u.isOdd())&&(a.iadd(h),u.isub(c)),a.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),s.isub(a),o.isub(u)):(n.isub(t),a.isub(s),u.isub(o))}return{a:a,b:u,gcd:n.iushln(l)}},r.prototype._invmp=function(e){i(0===e.negative),i(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s,o=new r(1),a=new r(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,h=1;0==(t.words[0]&h)&&l<26;++l,h<<=1);if(l>0)for(t.iushrn(l);l-- >0;)o.isOdd()&&o.iadd(u),o.iushrn(1);for(var c=0,d=1;0==(n.words[0]&d)&&c<26;++c,d<<=1);if(c>0)for(n.iushrn(c);c-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);t.cmp(n)>=0?(t.isub(n),o.isub(a)):(n.isub(t),a.isub(o))}return(s=0===t.cmpn(1)?o:a).cmpn(0)<0&&s.iadd(e),s},r.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),n=e.clone();t.negative=0,n.negative=0;for(var i=0;t.isEven()&&n.isEven();i++)t.iushrn(1),n.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;n.isEven();)n.iushrn(1);var s=t.cmp(n);if(s<0){var r=t;t=n,n=r}else if(0===s||0===n.cmpn(1))break;t.isub(n)}return n.iushln(i)},r.prototype.invm=function(e){return this.egcd(e).a.umod(e)},r.prototype.isEven=function(){return 0==(1&this.words[0])},r.prototype.isOdd=function(){return 1==(1&this.words[0])},r.prototype.andln=function(e){return this.words[0]&e},r.prototype.bincn=function(e){i("number"==typeof e);var t=e%26,n=(e-t)/26,s=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=s,this;for(var r=s,o=n;0!==r&&o<this.length;o++){var a=0|this.words[o];r=(a+=r)>>>26,a&=67108863,this.words[o]=a}return 0!==r&&(this.words[o]=r,this.length++),this},r.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},r.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),i(e<=67108863,"Number is too big");var s=0|this.words[0];t=s===e?0:s<e?-1:1}return 0!==this.negative?0|-t:t},r.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},r.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,n=this.length-1;n>=0;n--){var i=0|this.words[n],s=0|e.words[n];if(i!==s){i<s?t=-1:i>s&&(t=1);break}}return t},r.prototype.gtn=function(e){return 1===this.cmpn(e)},r.prototype.gt=function(e){return 1===this.cmp(e)},r.prototype.gten=function(e){return this.cmpn(e)>=0},r.prototype.gte=function(e){return this.cmp(e)>=0},r.prototype.ltn=function(e){return-1===this.cmpn(e)},r.prototype.lt=function(e){return-1===this.cmp(e)},r.prototype.lten=function(e){return this.cmpn(e)<=0},r.prototype.lte=function(e){return this.cmp(e)<=0},r.prototype.eqn=function(e){return 0===this.cmpn(e)},r.prototype.eq=function(e){return 0===this.cmp(e)},r.red=function(e){return new b(e)},r.prototype.toRed=function(e){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},r.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},r.prototype._forceRed=function(e){return this.red=e,this},r.prototype.forceRed=function(e){return i(!this.red,"Already a number in reduction context"),this._forceRed(e)},r.prototype.redAdd=function(e){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},r.prototype.redIAdd=function(e){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},r.prototype.redSub=function(e){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},r.prototype.redISub=function(e){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},r.prototype.redShl=function(e){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},r.prototype.redMul=function(e){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},r.prototype.redIMul=function(e){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},r.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},r.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},r.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},r.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},r.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},r.prototype.redPow=function(e){return i(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var _={k256:null,p224:null,p192:null,p25519:null};function v(e,t){this.name=e,this.p=new r(t,16),this.n=this.p.bitLength(),this.k=new r(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function w(){v.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function y(){v.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){v.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function C(){v.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function b(e){if("string"==typeof e){var t=r._prime(e);this.m=t.p,this.prime=t}else i(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function T(e){b.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new r(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v.prototype._tmp=function(){var e=new r(null);return e.words=new Array(Math.ceil(this.n/13)),e},v.prototype.ireduce=function(e){var t,n=e;do{this.split(n,this.tmp),t=(n=(n=this.imulK(n)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:n.ucmp(this.p);return 0===i?(n.words[0]=0,n.length=1):i>0?n.isub(this.p):n.strip(),n},v.prototype.split=function(e,t){e.iushrn(this.n,0,t)},v.prototype.imulK=function(e){return e.imul(this.k)},s(w,v),w.prototype.split=function(e,t){for(var n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var s=e.words[9];for(t.words[t.length++]=4194303&s,i=10;i<e.length;i++){var r=0|e.words[i];e.words[i-10]=(4194303&r)<<4|s>>>22,s=r}s>>>=22,e.words[i-10]=s,0===s&&e.length>10?e.length-=10:e.length-=9},w.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,n=0;n<e.length;n++){var i=0|e.words[n];t+=977*i,e.words[n]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},s(y,v),s(S,v),s(C,v),C.prototype.imulK=function(e){for(var t=0,n=0;n<e.length;n++){var i=19*(0|e.words[n])+t,s=67108863&i;i>>>=26,e.words[n]=s,t=i}return 0!==t&&(e.words[e.length++]=t),e},r._prime=function(e){if(_[e])return _[e];var t;if("k256"===e)t=new w;else if("p224"===e)t=new y;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new C}return _[e]=t,t},b.prototype._verify1=function(e){i(0===e.negative,"red works only with positives"),i(e.red,"red works only with red numbers")},b.prototype._verify2=function(e,t){i(0==(e.negative|t.negative),"red works only with positives"),i(e.red&&e.red===t.red,"red works only with red numbers")},b.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},b.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},b.prototype.add=function(e,t){this._verify2(e,t);var n=e.add(t);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},b.prototype.iadd=function(e,t){this._verify2(e,t);var n=e.iadd(t);return n.cmp(this.m)>=0&&n.isub(this.m),n},b.prototype.sub=function(e,t){this._verify2(e,t);var n=e.sub(t);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},b.prototype.isub=function(e,t){this._verify2(e,t);var n=e.isub(t);return n.cmpn(0)<0&&n.iadd(this.m),n},b.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},b.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},b.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},b.prototype.isqr=function(e){return this.imul(e,e.clone())},b.prototype.sqr=function(e){return this.mul(e,e)},b.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(i(t%2==1),3===t){var n=this.m.add(new r(1)).iushrn(2);return this.pow(e,n)}for(var s=this.m.subn(1),o=0;!s.isZero()&&0===s.andln(1);)o++,s.iushrn(1);i(!s.isZero());var a=new r(1).toRed(this),u=a.redNeg(),l=this.m.subn(1).iushrn(1),h=this.m.bitLength();for(h=new r(2*h*h).toRed(this);0!==this.pow(h,l).cmp(u);)h.redIAdd(u);for(var c=this.pow(h,s),d=this.pow(e,s.addn(1).iushrn(1)),f=this.pow(e,s),p=o;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();i(g<p);var _=this.pow(c,new r(1).iushln(p-g-1));d=d.redMul(_),c=_.redSqr(),f=f.redMul(c),p=g}return d},b.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},b.prototype.pow=function(e,t){if(t.isZero())return new r(1).toRed(this);if(0===t.cmpn(1))return e.clone();var n=new Array(16);n[0]=new r(1).toRed(this),n[1]=e;for(var i=2;i<n.length;i++)n[i]=this.mul(n[i-1],e);var s=n[0],o=0,a=0,u=t.bitLength()%26;for(0===u&&(u=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],h=u-1;h>=0;h--){var c=l>>h&1;s!==n[0]&&(s=this.sqr(s)),0!==c||0!==o?(o<<=1,o|=c,(4===++a||0===i&&0===h)&&(s=this.mul(s,n[o]),a=0,o=0)):a=0}u=26}return s},b.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},b.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},r.mont=function(e){return new T(e)},s(T,b),T.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},T.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},T.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var n=e.imul(t),i=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=n.isub(i).iushrn(this.shift),r=s;return s.cmp(this.m)>=0?r=s.isub(this.m):s.cmpn(0)<0&&(r=s.iadd(this.m)),r._forceRed(this)},T.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new r(0)._forceRed(this);var n=e.mul(t),i=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=n.isub(i).iushrn(this.shift),o=s;return s.cmp(this.m)>=0?o=s.isub(this.m):s.cmpn(0)<0&&(o=s.iadd(this.m)),o._forceRed(this)},T.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)}).call(this,n(/*! ./../../webpack/buildin/module.js */"./node_modules/webpack/buildin/module.js")(e))},"./node_modules/jssha/src/sha.js":
/*!***************************************!*\
  !*** ./node_modules/jssha/src/sha.js ***!
  \***************************************/
/*! no static exports found */function(e,t,n){"use strict";var i;!function(s){function r(e,t,n){var i,s,r,o,f,p,m,g,_,v=0,w=[],y=0,S=!1,C=[],b=[],T=!1,R=!1,P=-1;if(i=(n=n||{}).encoding||"UTF8",(_=n.numRounds||1)!==parseInt(_,10)||1>_)throw Error("numRounds must a integer >= 1");if("SHA-1"===e)f=512,p=G,m=L,o=160,g=function(e){return e.slice()};else if(0===e.lastIndexOf("SHA-",0))if(p=function(t,n){return j(t,n,e)},m=function(t,n,i,s){var r,o;if("SHA-224"===e||"SHA-256"===e)r=15+(n+65>>>9<<4),o=16;else{if("SHA-384"!==e&&"SHA-512"!==e)throw Error("Unexpected error in SHA-2 implementation");r=31+(n+129>>>10<<5),o=32}for(;t.length<=r;)t.push(0);for(t[n>>>5]|=128<<24-n%32,n+=i,t[r]=4294967295&n,t[r-1]=n/4294967296|0,i=t.length,n=0;n<i;n+=o)s=j(t.slice(n,n+o),s,e);if("SHA-224"===e)t=[s[0],s[1],s[2],s[3],s[4],s[5],s[6]];else if("SHA-256"===e)t=s;else if("SHA-384"===e)t=[s[0].a,s[0].b,s[1].a,s[1].b,s[2].a,s[2].b,s[3].a,s[3].b,s[4].a,s[4].b,s[5].a,s[5].b];else{if("SHA-512"!==e)throw Error("Unexpected error in SHA-2 implementation");t=[s[0].a,s[0].b,s[1].a,s[1].b,s[2].a,s[2].b,s[3].a,s[3].b,s[4].a,s[4].b,s[5].a,s[5].b,s[6].a,s[6].b,s[7].a,s[7].b]}return t},g=function(e){return e.slice()},"SHA-224"===e)f=512,o=224;else if("SHA-256"===e)f=512,o=256;else if("SHA-384"===e)f=1024,o=384;else{if("SHA-512"!==e)throw Error("Chosen SHA variant is not supported");f=1024,o=512}else{if(0!==e.lastIndexOf("SHA3-",0)&&0!==e.lastIndexOf("SHAKE",0))throw Error("Chosen SHA variant is not supported");var E=6;if(p=H,g=function(e){var t,n=[];for(t=0;5>t;t+=1)n[t]=e[t].slice();return n},P=1,"SHA3-224"===e)f=1152,o=224;else if("SHA3-256"===e)f=1088,o=256;else if("SHA3-384"===e)f=832,o=384;else if("SHA3-512"===e)f=576,o=512;else if("SHAKE128"===e)f=1344,o=-1,E=31,R=!0;else{if("SHAKE256"!==e)throw Error("Chosen SHA variant is not supported");f=1088,o=-1,E=31,R=!0}m=function(e,t,n,i,s){var r,o=E,a=[],u=(n=f)>>>5,l=0,h=t>>>5;for(r=0;r<h&&t>=n;r+=u)i=H(e.slice(r,r+u),i),t-=n;for(e=e.slice(r),t%=n;e.length<u;)e.push(0);for(e[(r=t>>>3)>>2]^=o<<r%4*8,e[u-1]^=2147483648,i=H(e,i);32*a.length<s&&(e=i[l%5][l/5|0],a.push(e.b),!(32*a.length>=s));)a.push(e.a),0==64*(l+=1)%n&&H(null,i);return a}}r=d(t,i,P),s=q(e),this.setHMACKey=function(t,n,r){var a;if(!0===S)throw Error("HMAC key already set");if(!0===T)throw Error("Cannot set HMAC key after calling update");if(!0===R)throw Error("SHAKE is not supported for HMAC");if(t=(n=d(n,i=(r||{}).encoding||"UTF8",P)(t)).binLen,n=n.value,r=(a=f>>>3)/4-1,a<t/8){for(n=m(n,t,0,q(e),o);n.length<=r;)n.push(0);n[r]&=4294967040}else if(a>t/8){for(;n.length<=r;)n.push(0);n[r]&=4294967040}for(t=0;t<=r;t+=1)C[t]=909522486^n[t],b[t]=1549556828^n[t];s=p(C,s),v=f,S=!0},this.update=function(e){var t,n,i,o=0,a=f>>>5;for(e=(t=r(e,w,y)).binLen,n=t.value,t=e>>>5,i=0;i<t;i+=a)o+f<=e&&(s=p(n.slice(i,i+a),s),o+=f);v+=o,w=n.slice(o>>>5),y=e%f,T=!0},this.getHash=function(t,n){var i,r,d,f;if(!0===S)throw Error("Cannot call getHash after setting HMAC key");if(d=c(n),!0===R){if(-1===d.shakeLen)throw Error("shakeLen must be specified in options");o=d.shakeLen}switch(t){case"HEX":i=function(e){return a(e,o,P,d)};break;case"B64":i=function(e){return u(e,o,P,d)};break;case"BYTES":i=function(e){return l(e,o,P)};break;case"ARRAYBUFFER":try{r=new ArrayBuffer(0)}catch(e){throw Error("ARRAYBUFFER not supported by this environment")}i=function(e){return h(e,o,P)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER")}for(f=m(w.slice(),y,v,g(s),o),r=1;r<_;r+=1)!0===R&&0!=o%32&&(f[f.length-1]&=16777215>>>24-o%32),f=m(f,o,0,q(e),o);return i(f)},this.getHMAC=function(t,n){var i,r,d,_;if(!1===S)throw Error("Cannot call getHMAC without first setting HMAC key");switch(d=c(n),t){case"HEX":i=function(e){return a(e,o,P,d)};break;case"B64":i=function(e){return u(e,o,P,d)};break;case"BYTES":i=function(e){return l(e,o,P)};break;case"ARRAYBUFFER":try{i=new ArrayBuffer(0)}catch(e){throw Error("ARRAYBUFFER not supported by this environment")}i=function(e){return h(e,o,P)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER")}return r=m(w.slice(),y,v,g(s),o),_=p(b,q(e)),i(_=m(r,o,f,_,o))}}function o(e,t){this.a=e,this.b=t}function a(e,t,n,i){var s,r,o,a="";for(t/=8,o=-1===n?3:0,s=0;s<t;s+=1)r=e[s>>>2]>>>8*(o+s%4*n),a+="0123456789abcdef".charAt(r>>>4&15)+"0123456789abcdef".charAt(15&r);return i.outputUpper?a.toUpperCase():a}function u(e,t,n,i){var s,r,o,a,u="",l=t/8;for(a=-1===n?3:0,s=0;s<l;s+=3)for(r=s+1<l?e[s+1>>>2]:0,o=s+2<l?e[s+2>>>2]:0,o=(e[s>>>2]>>>8*(a+s%4*n)&255)<<16|(r>>>8*(a+(s+1)%4*n)&255)<<8|o>>>8*(a+(s+2)%4*n)&255,r=0;4>r;r+=1)u+=8*s+6*r<=t?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>>6*(3-r)&63):i.b64Pad;return u}function l(e,t,n){var i,s,r,o="";for(t/=8,r=-1===n?3:0,i=0;i<t;i+=1)s=e[i>>>2]>>>8*(r+i%4*n)&255,o+=String.fromCharCode(s);return o}function h(e,t,n){t/=8;var i,s,r,o=new ArrayBuffer(t);for(r=new Uint8Array(o),s=-1===n?3:0,i=0;i<t;i+=1)r[i]=e[i>>>2]>>>8*(s+i%4*n)&255;return o}function c(e){var t={outputUpper:!1,b64Pad:"=",shakeLen:-1};if(e=e||{},t.outputUpper=e.outputUpper||!1,!0===e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad),!0===e.hasOwnProperty("shakeLen")){if(0!=e.shakeLen%8)throw Error("shakeLen must be a multiple of 8");t.shakeLen=e.shakeLen}if("boolean"!=typeof t.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!=typeof t.b64Pad)throw Error("Invalid b64Pad formatting option");return t}function d(e,t,n){switch(t){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(e){case"HEX":e=function(e,t,i){var s,r,o,a,u,l,h=e.length;if(0!=h%2)throw Error("String of HEX type must be in byte increments");for(t=t||[0],u=(i=i||0)>>>3,l=-1===n?3:0,s=0;s<h;s+=2){if(r=parseInt(e.substr(s,2),16),isNaN(r))throw Error("String of HEX type contains invalid characters");for(o=(a=(s>>>1)+u)>>>2;t.length<=o;)t.push(0);t[o]|=r<<8*(l+a%4*n)}return{value:t,binLen:4*h+i}};break;case"TEXT":e=function(e,i,s){var r,o,a,u,l,h,c,d,f=0;if(i=i||[0],l=(s=s||0)>>>3,"UTF8"===t)for(d=-1===n?3:0,a=0;a<e.length;a+=1)for(o=[],128>(r=e.charCodeAt(a))?o.push(r):2048>r?(o.push(192|r>>>6),o.push(128|63&r)):55296>r||57344<=r?o.push(224|r>>>12,128|r>>>6&63,128|63&r):(a+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(a)),o.push(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)),u=0;u<o.length;u+=1){for(h=(c=f+l)>>>2;i.length<=h;)i.push(0);i[h]|=o[u]<<8*(d+c%4*n),f+=1}else if("UTF16BE"===t||"UTF16LE"===t)for(d=-1===n?2:0,o="UTF16LE"===t&&1!==n||"UTF16LE"!==t&&1===n,a=0;a<e.length;a+=1){for(r=e.charCodeAt(a),!0===o&&(r=(u=255&r)<<8|r>>>8),h=(c=f+l)>>>2;i.length<=h;)i.push(0);i[h]|=r<<8*(d+c%4*n),f+=2}return{value:i,binLen:8*f+s}};break;case"B64":e=function(e,t,i){var s,r,o,a,u,l,h,c,d=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");if(r=e.indexOf("="),e=e.replace(/\=/g,""),-1!==r&&r<e.length)throw Error("Invalid '=' found in base-64 string");for(t=t||[0],l=(i=i||0)>>>3,c=-1===n?3:0,r=0;r<e.length;r+=4){for(u=e.substr(r,4),o=a=0;o<u.length;o+=1)a|=(s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(u[o]))<<18-6*o;for(o=0;o<u.length-1;o+=1){for(s=(h=d+l)>>>2;t.length<=s;)t.push(0);t[s]|=(a>>>16-8*o&255)<<8*(c+h%4*n),d+=1}}return{value:t,binLen:8*d+i}};break;case"BYTES":e=function(e,t,i){var s,r,o,a,u,l;for(t=t||[0],o=(i=i||0)>>>3,l=-1===n?3:0,r=0;r<e.length;r+=1)s=e.charCodeAt(r),a=(u=r+o)>>>2,t.length<=a&&t.push(0),t[a]|=s<<8*(l+u%4*n);return{value:t,binLen:8*e.length+i}};break;case"ARRAYBUFFER":try{e=new ArrayBuffer(0)}catch(e){throw Error("ARRAYBUFFER not supported by this environment")}e=function(e,t,i){var s,r,o,a,u,l;for(t=t||[0],r=(i=i||0)>>>3,u=-1===n?3:0,l=new Uint8Array(e),s=0;s<e.byteLength;s+=1)o=(a=s+r)>>>2,t.length<=o&&t.push(0),t[o]|=l[s]<<8*(u+a%4*n);return{value:t,binLen:8*e.byteLength+i}};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER")}return e}function f(e,t){return e<<t|e>>>32-t}function p(e,t){return 32<t?(t-=32,new o(e.b<<t|e.a>>>32-t,e.a<<t|e.b>>>32-t)):0!==t?new o(e.a<<t|e.b>>>32-t,e.b<<t|e.a>>>32-t):e}function m(e,t){return e>>>t|e<<32-t}function g(e,t){var n=null;n=new o(e.a,e.b);return 32>=t?new o(n.a>>>t|n.b<<32-t&4294967295,n.b>>>t|n.a<<32-t&4294967295):new o(n.b>>>t-32|n.a<<64-t&4294967295,n.a>>>t-32|n.b<<64-t&4294967295)}function _(e,t){return 32>=t?new o(e.a>>>t,e.b>>>t|e.a<<32-t&4294967295):new o(0,e.a>>>t-32)}function v(e,t,n){return e&t^~e&n}function w(e,t,n){return new o(e.a&t.a^~e.a&n.a,e.b&t.b^~e.b&n.b)}function y(e,t,n){return e&t^e&n^t&n}function S(e,t,n){return new o(e.a&t.a^e.a&n.a^t.a&n.a,e.b&t.b^e.b&n.b^t.b&n.b)}function C(e){return m(e,2)^m(e,13)^m(e,22)}function b(e){var t=g(e,28),n=g(e,34);return e=g(e,39),new o(t.a^n.a^e.a,t.b^n.b^e.b)}function T(e){return m(e,6)^m(e,11)^m(e,25)}function R(e){var t=g(e,14),n=g(e,18);return e=g(e,41),new o(t.a^n.a^e.a,t.b^n.b^e.b)}function P(e){return m(e,7)^m(e,18)^e>>>3}function E(e){var t=g(e,1),n=g(e,8);return e=_(e,7),new o(t.a^n.a^e.a,t.b^n.b^e.b)}function I(e){return m(e,17)^m(e,19)^e>>>10}function A(e){var t=g(e,19),n=g(e,61);return e=_(e,6),new o(t.a^n.a^e.a,t.b^n.b^e.b)}function M(e,t){var n=(65535&e)+(65535&t);return((e>>>16)+(t>>>16)+(n>>>16)&65535)<<16|65535&n}function k(e,t,n,i){var s=(65535&e)+(65535&t)+(65535&n)+(65535&i);return((e>>>16)+(t>>>16)+(n>>>16)+(i>>>16)+(s>>>16)&65535)<<16|65535&s}function F(e,t,n,i,s){var r=(65535&e)+(65535&t)+(65535&n)+(65535&i)+(65535&s);return((e>>>16)+(t>>>16)+(n>>>16)+(i>>>16)+(s>>>16)+(r>>>16)&65535)<<16|65535&r}function O(e,t){var n,i,s;return n=(65535&e.b)+(65535&t.b),s=(65535&(i=(e.b>>>16)+(t.b>>>16)+(n>>>16)))<<16|65535&n,n=(65535&e.a)+(65535&t.a)+(i>>>16),new o((65535&(i=(e.a>>>16)+(t.a>>>16)+(n>>>16)))<<16|65535&n,s)}function D(e,t,n,i){var s,r,a;return s=(65535&e.b)+(65535&t.b)+(65535&n.b)+(65535&i.b),a=(65535&(r=(e.b>>>16)+(t.b>>>16)+(n.b>>>16)+(i.b>>>16)+(s>>>16)))<<16|65535&s,s=(65535&e.a)+(65535&t.a)+(65535&n.a)+(65535&i.a)+(r>>>16),new o((65535&(r=(e.a>>>16)+(t.a>>>16)+(n.a>>>16)+(i.a>>>16)+(s>>>16)))<<16|65535&s,a)}function x(e,t,n,i,s){var r,a,u;return r=(65535&e.b)+(65535&t.b)+(65535&n.b)+(65535&i.b)+(65535&s.b),u=(65535&(a=(e.b>>>16)+(t.b>>>16)+(n.b>>>16)+(i.b>>>16)+(s.b>>>16)+(r>>>16)))<<16|65535&r,r=(65535&e.a)+(65535&t.a)+(65535&n.a)+(65535&i.a)+(65535&s.a)+(a>>>16),new o((65535&(a=(e.a>>>16)+(t.a>>>16)+(n.a>>>16)+(i.a>>>16)+(s.a>>>16)+(r>>>16)))<<16|65535&r,u)}function B(e,t){return new o(e.a^t.a,e.b^t.b)}function q(e){var t,n=[];if("SHA-1"===e)n=[1732584193,4023233417,2562383102,271733878,3285377520];else if(0===e.lastIndexOf("SHA-",0))switch(n=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],t=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],e){case"SHA-224":break;case"SHA-256":n=t;break;case"SHA-384":n=[new o(3418070365,n[0]),new o(1654270250,n[1]),new o(2438529370,n[2]),new o(355462360,n[3]),new o(1731405415,n[4]),new o(41048885895,n[5]),new o(3675008525,n[6]),new o(1203062813,n[7])];break;case"SHA-512":n=[new o(t[0],4089235720),new o(t[1],2227873595),new o(t[2],4271175723),new o(t[3],1595750129),new o(t[4],2917565137),new o(t[5],725511199),new o(t[6],4215389547),new o(t[7],327033209)];break;default:throw Error("Unknown SHA variant")}else{if(0!==e.lastIndexOf("SHA3-",0)&&0!==e.lastIndexOf("SHAKE",0))throw Error("No SHA variants supported");for(e=0;5>e;e+=1)n[e]=[new o(0,0),new o(0,0),new o(0,0),new o(0,0),new o(0,0)]}return n}function G(e,t){var n,i,s,r,o,a,u,l=[];for(n=t[0],i=t[1],s=t[2],r=t[3],o=t[4],u=0;80>u;u+=1)l[u]=16>u?e[u]:f(l[u-3]^l[u-8]^l[u-14]^l[u-16],1),a=20>u?F(f(n,5),i&s^~i&r,o,1518500249,l[u]):40>u?F(f(n,5),i^s^r,o,1859775393,l[u]):60>u?F(f(n,5),y(i,s,r),o,2400959708,l[u]):F(f(n,5),i^s^r,o,3395469782,l[u]),o=r,r=s,s=f(i,30),i=n,n=a;return t[0]=M(n,t[0]),t[1]=M(i,t[1]),t[2]=M(s,t[2]),t[3]=M(r,t[3]),t[4]=M(o,t[4]),t}function L(e,t,n,i){var s;for(s=15+(t+65>>>9<<4);e.length<=s;)e.push(0);for(e[t>>>5]|=128<<24-t%32,t+=n,e[s]=4294967295&t,e[s-1]=t/4294967296|0,t=e.length,s=0;s<t;s+=16)i=G(e.slice(s,s+16),i);return i}function j(e,t,n){var i,s,r,a,u,l,h,c,d,f,p,m,g,_,B,q,G,L,j,H,K,W,V,J=[];if("SHA-224"===n||"SHA-256"===n)f=64,m=1,W=Number,g=M,_=k,B=F,q=P,G=I,L=C,j=T,K=y,H=v,V=N;else{if("SHA-384"!==n&&"SHA-512"!==n)throw Error("Unexpected error in SHA-2 implementation");f=80,m=2,W=o,g=O,_=D,B=x,q=E,G=A,L=b,j=R,K=S,H=w,V=U}for(n=t[0],i=t[1],s=t[2],r=t[3],a=t[4],u=t[5],l=t[6],h=t[7],p=0;p<f;p+=1)16>p?(d=p*m,c=e.length<=d?0:e[d],d=e.length<=d+1?0:e[d+1],J[p]=new W(c,d)):J[p]=_(G(J[p-2]),J[p-7],q(J[p-15]),J[p-16]),c=B(h,j(a),H(a,u,l),V[p],J[p]),d=g(L(n),K(n,i,s)),h=l,l=u,u=a,a=g(r,c),r=s,s=i,i=n,n=g(c,d);return t[0]=g(n,t[0]),t[1]=g(i,t[1]),t[2]=g(s,t[2]),t[3]=g(r,t[3]),t[4]=g(a,t[4]),t[5]=g(u,t[5]),t[6]=g(l,t[6]),t[7]=g(h,t[7]),t}function H(e,t){var n,i,s,r,a=[],u=[];if(null!==e)for(i=0;i<e.length;i+=2)t[(i>>>1)%5][(i>>>1)/5|0]=B(t[(i>>>1)%5][(i>>>1)/5|0],new o(e[i+1],e[i]));for(n=0;24>n;n+=1){for(r=q("SHA3-"),i=0;5>i;i+=1){s=t[i][0];var l=t[i][1],h=t[i][2],c=t[i][3],d=t[i][4];a[i]=new o(s.a^l.a^h.a^c.a^d.a,s.b^l.b^h.b^c.b^d.b)}for(i=0;5>i;i+=1)u[i]=B(a[(i+4)%5],p(a[(i+1)%5],1));for(i=0;5>i;i+=1)for(s=0;5>s;s+=1)t[i][s]=B(t[i][s],u[i]);for(i=0;5>i;i+=1)for(s=0;5>s;s+=1)r[s][(2*i+3*s)%5]=p(t[i][s],K[i][s]);for(i=0;5>i;i+=1)for(s=0;5>s;s+=1)t[i][s]=B(r[i][s],new o(~r[(i+1)%5][s].a&r[(i+2)%5][s].a,~r[(i+1)%5][s].b&r[(i+2)%5][s].b));t[0][0]=B(t[0][0],W[n])}return t}var N,U,K,W;U=[new o((N=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298])[0],3609767458),new o(N[1],602891725),new o(N[2],3964484399),new o(N[3],2173295548),new o(N[4],4081628472),new o(N[5],3053834265),new o(N[6],2937671579),new o(N[7],3664609560),new o(N[8],2734883394),new o(N[9],1164996542),new o(N[10],1323610764),new o(N[11],3590304994),new o(N[12],4068182383),new o(N[13],991336113),new o(N[14],633803317),new o(N[15],3479774868),new o(N[16],2666613458),new o(N[17],944711139),new o(N[18],2341262773),new o(N[19],2007800933),new o(N[20],1495990901),new o(N[21],1856431235),new o(N[22],3175218132),new o(N[23],2198950837),new o(N[24],3999719339),new o(N[25],766784016),new o(N[26],2566594879),new o(N[27],3203337956),new o(N[28],1034457026),new o(N[29],2466948901),new o(N[30],3758326383),new o(N[31],168717936),new o(N[32],1188179964),new o(N[33],1546045734),new o(N[34],1522805485),new o(N[35],2643833823),new o(N[36],2343527390),new o(N[37],1014477480),new o(N[38],1206759142),new o(N[39],344077627),new o(N[40],1290863460),new o(N[41],3158454273),new o(N[42],3505952657),new o(N[43],106217008),new o(N[44],3606008344),new o(N[45],1432725776),new o(N[46],1467031594),new o(N[47],851169720),new o(N[48],3100823752),new o(N[49],1363258195),new o(N[50],3750685593),new o(N[51],3785050280),new o(N[52],3318307427),new o(N[53],3812723403),new o(N[54],2003034995),new o(N[55],3602036899),new o(N[56],1575990012),new o(N[57],1125592928),new o(N[58],2716904306),new o(N[59],442776044),new o(N[60],593698344),new o(N[61],3733110249),new o(N[62],2999351573),new o(N[63],3815920427),new o(3391569614,3928383900),new o(3515267271,566280711),new o(3940187606,3454069534),new o(4118630271,4000239992),new o(116418474,1914138554),new o(174292421,2731055270),new o(289380356,3203993006),new o(460393269,320620315),new o(685471733,587496836),new o(852142971,1086792851),new o(1017036298,365543100),new o(1126000580,2618297676),new o(1288033470,3409855158),new o(1501505948,4234509866),new o(1607167915,987167468),new o(1816402316,1246189591)],W=[new o(0,1),new o(0,32898),new o(2147483648,32906),new o(2147483648,2147516416),new o(0,32907),new o(0,2147483649),new o(2147483648,2147516545),new o(2147483648,32777),new o(0,138),new o(0,136),new o(0,2147516425),new o(0,2147483658),new o(0,2147516555),new o(2147483648,139),new o(2147483648,32905),new o(2147483648,32771),new o(2147483648,32770),new o(2147483648,128),new o(0,32778),new o(2147483648,2147483658),new o(2147483648,2147516545),new o(2147483648,32896),new o(0,2147483649),new o(2147483648,2147516424)],K=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]],void 0===(i=function(){return r}.call(t,n,t,e))||(e.exports=i)}()},"./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"./src/Cashout.js":
/*!************************!*\
  !*** ./src/Cashout.js ***!
  \************************/
/*! exports provided: CashoutOnlyRequest, CashoutOnlyResponse */function(e,t,n){"use strict";n.r(t),n.d(t,"CashoutOnlyRequest",function(){return h}),n.d(t,"CashoutOnlyResponse",function(){return c});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./SpiModels */"./src/SpiModels.js"),l=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),h=function(){function e(t,n){s()(this,e),this.PosRefId=n,this.CashoutAmount=t,this.SurchargeAmount=null,this.Config=new u.SpiConfig,this.Options=new u.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,cash_amount:this.CashoutAmount,surcharge_amount:this.SurchargeAmount};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new a.Message(l.RequestIdHelper.Id("cshout"),a.Events.CashoutOnlyRequest,e,!0)}}]),e}(),c=function(){function e(t){s()(this,e),this._m=t,this.RequestId=t.Id,this.PosRefId=t.Data.pos_ref_id,this.SchemeName=t.Data.scheme_name,this.Success=t.GetSuccessState()==a.SuccessState.Success}return o()(e,[{key:"GetRRN",value:function(){return this._m.Data.rrn}},{key:"GetCashoutAmount",value:function(){return this._m.Data.cash_amount}},{key:"GetBankNonCashAmount",value:function(){return this._m.Data.bank_noncash_amount}},{key:"GetBankCashAmount",value:function(){return this._m.Data.bank_cash_amount}},{key:"GetCustomerReceipt",value:function(){return this._m.Data.customer_receipt}},{key:"GetMerchantReceipt",value:function(){return this._m.Data.merchant_receipt}},{key:"GetResponseText",value:function(){return this._m.Data.host_response_text}},{key:"GetResponseCode",value:function(){return this._m.Data.host_response_code}},{key:"GetTerminalReferenceId",value:function(){return this._m.Data.terminal_ref_id}},{key:"GetAccountType",value:function(){return this._m.Data.account_type}},{key:"GetAuthCode",value:function(){return this._m.Data.auth_code}},{key:"GetBankDate",value:function(){return this._m.Data.bank_date}},{key:"GetBankTime",value:function(){return this._m.Data.bank_time}},{key:"GetMaskedPan",value:function(){return this._m.Data.masked_pan}},{key:"GetTerminalId",value:function(){return this._m.Data.terminal_id}},{key:"WasMerchantReceiptPrinted",value:function(){return this._m.Data.merchant_receipt_printed}},{key:"WasCustomerReceiptPrinted",value:function(){return this._m.Data.customer_receipt_printed}},{key:"GetSurchargeAmount",value:function(){return this._m.Data.surcharge_amount}},{key:"GetResponseValue",value:function(e){return this._m.Data[e]}}]),e}()},"./src/Connection.js":
/*!***************************!*\
  !*** ./src/Connection.js ***!
  \***************************/
/*! exports provided: ConnectionState, SPI_PROTOCOL, ConnectionStateEventArgs, MessageEventArgs, Connection */function(e,t,n){"use strict";n.r(t),n.d(t,"ConnectionState",function(){return a}),n.d(t,"SPI_PROTOCOL",function(){return u}),n.d(t,"ConnectionStateEventArgs",function(){return l}),n.d(t,"MessageEventArgs",function(){return h}),n.d(t,"Connection",function(){return c});var i=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(r),a={Disconnected:"Disconnected",Connecting:"Connecting",Connected:"Connected"},u="spi.2.5.0",l=function e(t){o()(this,e),this.ConnectionState=t},h=function e(t){o()(this,e),this.Message=t},c=function(){function e(){if(o()(this,e),this.Address=null,this.Connected=!1,this.State=a.Disconnected,this.SpiProtocol=u,this._ws=null,"undefined"==typeof WebSocket)throw new Error("Environment does not support WebSockets")}return s()(e,[{key:"Connect",value:function(e){var t=this;this.State!==a.Connected&&this.State!==a.Connecting&&(this.State=a.Connecting,this._ws=new WebSocket(this.Address,this.SpiProtocol),this._ws.onopen=function(){return t.pollWebSocketConnection()},this._ws.onmessage=function(e){return t.onMessageReceived(e)},this._ws.onclose=function(){return t.onClosed()},this._ws.onerror=function(e){return t.onError(e)},document.dispatchEvent(new CustomEvent("ConnectionStatusChanged",{detail:new l(a.Connecting)})))}},{key:"Disconnect",value:function(){this.State!=a.Disconnected&&(this._ws&&this._ws.readyState!=this._ws.CLOSED&&this._ws.close(),this._ws&&(this._ws.onopen=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.onerror=null),this.onClosed())}},{key:"Send",value:function(e){this._ws.send(e)}},{key:"onOpened",value:function(){this.State=a.Connected,this.Connected=!0,document.dispatchEvent(new CustomEvent("ConnectionStatusChanged",{detail:new l(a.Connected)}))}},{key:"onClosed",value:function(){this.Connected=!1,this.State=a.Disconnected,this._ws=null,document.dispatchEvent(new CustomEvent("ConnectionStatusChanged",{detail:new l(a.Disconnected)}))}},{key:"pollWebSocketConnection",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._ws.readyState===this._ws.OPEN?(this.onOpened(),!0):t<25?(t++,void setTimeout(function(){return e.pollWebSocketConnection(t)},200)):(this.Disconnect(),!1)}},{key:"onMessageReceived",value:function(e){document.dispatchEvent(new CustomEvent("MessageReceived",{detail:new h(e.data)}))}},{key:"onError",value:function(e){document.dispatchEvent(new CustomEvent("ErrorReceived",{detail:new h(e)}))}}]),e}()},"./src/Crypto.js":
/*!***********************!*\
  !*** ./src/Crypto.js ***!
  \***********************/
/*! exports provided: Crypto */function(e,t,n){"use strict";n.r(t),n.d(t,"Crypto",function(){return c});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! jssha */"./node_modules/jssha/src/sha.js"),u=n.n(a),l=n(/*! aes-js */"./node_modules/aes-js/index.js"),h=n.n(l),c=function(){function e(){s()(this,e)}return o()(e,null,[{key:"AesEncrypt",value:function(e,t){var n=h.a.utils.hex.toBytes(e),i=h.a.padding.pkcs7.pad(h.a.utils.utf8.toBytes(t)),s=new h.a.ModeOfOperation.cbc(n,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]).encrypt(i);return h.a.utils.hex.fromBytes(s)}},{key:"AesDecrypt",value:function(e,t){var n=h.a.utils.hex.toBytes(e),i=h.a.utils.hex.toBytes(t),s=new h.a.ModeOfOperation.cbc(n,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]).decrypt(i);return h.a.utils.utf8.fromBytes(h.a.padding.pkcs7.strip(s))}},{key:"HmacSignature",value:function(e,t){var n=new u.a("SHA-256","TEXT");return n.setHMACKey(e,"HEX"),n.update(t),n.getHMAC("HEX")}},{key:"GenerateHash",value:function(e){var t=new u.a("SHA-256","HEX");return t.update(e),t.getHash("HEX")}}]),e}()},"./src/DiffieHellman.js":
/*!******************************!*\
  !*** ./src/DiffieHellman.js ***!
  \******************************/
/*! exports provided: DiffieHellman */function(e,t,n){"use strict";n.r(t),n.d(t,"DiffieHellman",function(){return l});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! bn.js */"./node_modules/bn.js/lib/bn.js"),u=n.n(a),l=function(){function e(){s()(this,e)}return o()(e,[{key:"RandomPrivateKey",value:function(e){var t=new u.a(e),n=Math.floor(1e3*Math.random()+1),i=t.shrn(n),s=new u.a(2);return-1==i.cmp(s)?s:i}},{key:"PublicKey",value:function(e,t,n){var i=new u.a(n,16),s=new u.a(t,16),r=u.a.mont(new u.a(e,16));return s.toRed(r).redPow(i).fromRed().toString(16)}},{key:"Secret",value:function(e,t,n){var i=new u.a(t,16),s=new u.a(n,16),r=u.a.mont(new u.a(e,16));return i.toRed(r).redPow(s).fromRed().toString(16).toUpperCase()}}]),e}()},"./src/KeyRollingHelper.js":
/*!*********************************!*\
  !*** ./src/KeyRollingHelper.js ***!
  \*********************************/
/*! exports provided: KeyRollingHelper, KeyRollingResult */function(e,t,n){"use strict";n.r(t),n.d(t,"KeyRollingHelper",function(){return h}),n.d(t,"KeyRollingResult",function(){return c});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./Crypto */"./src/Crypto.js"),l=n(/*! ./Secrets */"./src/Secrets.js"),h=function(){function e(){s()(this,e)}return o()(e,null,[{key:"PerformKeyRolling",value:function(e,t){var n=new a.Message(e.Id,a.Events.KeyRollResponse,{status:"confirmed"},!0),i=new l.Secrets(u.Crypto.GenerateHash(t.EncKey).toUpperCase(),u.Crypto.GenerateHash(t.HmacKey).toUpperCase());return new c(n,i)}}]),e}(),c=function e(t,n){s()(this,e),this.KeyRollingConfirmation=t,this.NewSecrets=n}},"./src/Logger.js":
/*!***********************!*\
  !*** ./src/Logger.js ***!
  \***********************/
/*! exports provided: Logger */function(e,t,n){"use strict";n.r(t),n.d(t,"Logger",function(){return a});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\n";s()(this,e),this.buffer=[],this.element=t,this.lineSeperator=n}return o()(e,[{key:"Info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.buffer.push(t.join(" ")),this._render()}},{key:"Debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.buffer.push(t.join(" ")),this._render()}},{key:"Warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.buffer.push(t.join(" ")),this._render()}},{key:"Error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.buffer.push(t.join(" ")),this._render()}},{key:"Console",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log(t.join(" "))}},{key:"_render",value:function(){this.element.innerText=this.buffer.join(this.lineSeperator),this.element.scrollTop=this.element.scrollHeight}},{key:"Clear",value:function(){this.buffer=[],this._render()}}]),e}()},"./src/Messages.js":
/*!*************************!*\
  !*** ./src/Messages.js ***!
  \*************************/
/*! exports provided: Events, SuccessState, MessageStamp, MessageEnvelope, Message */function(e,t,n){"use strict";n.r(t),n.d(t,"Events",function(){return u}),n.d(t,"SuccessState",function(){return l}),n.d(t,"MessageStamp",function(){return h}),n.d(t,"MessageEnvelope",function(){return c}),n.d(t,"Message",function(){return d});var i=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(r),a=n(/*! ./Crypto */"./src/Crypto.js"),u={PairRequest:"pair_request",KeyRequest:"key_request",KeyResponse:"key_response",KeyCheck:"key_check",PairResponse:"pair_response",DropKeysAdvice:"drop_keys",LoginRequest:"login_request",LoginResponse:"login_response",Ping:"ping",Pong:"pong",PurchaseRequest:"purchase",PurchaseResponse:"purchase_response",CancelTransactionRequest:"cancel_transaction",CancelTransactionResponse:"cancel_response",GetLastTransactionRequest:"get_last_transaction",GetLastTransactionResponse:"last_transaction",RefundRequest:"refund",RefundResponse:"refund_response",SignatureRequired:"signature_required",SignatureDeclined:"signature_decline",SignatureAccepted:"signature_accept",AuthCodeRequired:"authorisation_code_required",AuthCodeAdvice:"authorisation_code_advice",CashoutOnlyRequest:"cash",CashoutOnlyResponse:"cash_response",MotoPurchaseRequest:"moto_purchase",MotoPurchaseResponse:"moto_purchase_response",SettleRequest:"settle",SettleResponse:"settle_response",SettlementEnquiryRequest:"settlement_enquiry",SettlementEnquiryResponse:"settlement_enquiry_response",SetPosInfoRequest:"set_pos_info",SetPosInfoResponse:"set_pos_info_response",KeyRollRequest:"request_use_next_keys",KeyRollResponse:"response_use_next_keys",Error:"error",InvalidHmacSignature:"_INVALID_SIGNATURE_",PayAtTableGetTableConfig:"get_table_config",PayAtTableSetTableConfig:"set_table_config",PayAtTableGetBillDetails:"get_bill_details",PayAtTableBillDetails:"bill_details",PayAtTableBillPayment:"bill_payment",PrintingRequest:"print",PrintingResponse:"print_response",TerminalStatusRequest:"get_terminal_status",TerminalStatusResponse:"terminal_status",BatteryLevelChanged:"battery_level_changed",PayAtTableGetOpenTables:"get_open_tables",PayAtTableOpenTables:"open_tables",PayAtTableBillPaymentFlowEnded:"bill_payment_flow_ended"},l={Unknown:"Unknown",Success:"Success",Failed:"Failed"},h=function e(t,n,i){o()(this,e),this.PosId=t,this.Secrets=n,this.ServerTimeDelta=i},c=function(){function e(t,n,i,s){o()(this,e),this.Message=t,this.Enc=n,this.Hmac=i,this.PosId=s}return s()(e,[{key:"toJSON",value:function(){return{message:this.Message,enc:this.Enc,hmac:this.Hmac,pos_id:this.PosId}}}]),e}(),d=function(){function e(t,n,i,s){o()(this,e),this.Id=t,this.EventName=n,this.Data=i,this.DateTimeStamp="",this.PosId="",this.IncommingHmac="",this._needsEncryption=s,this.DecryptedJson=""}return s()(e,[{key:"GetSuccessState",value:function(){return this.Data&&void 0!==this.Data.success?this.Data.success?l.Success:l.Failed:l.Unknown}},{key:"GetError",value:function(){return this.Data.error_reason?this.Data.error_reason:""}},{key:"GetErrorDetail",value:function(){return this.Data.error_detail}},{key:"GetServerTimeDelta",value:function(){var e=Date.now(),t=this.DateTimeStamp.split(/[\-\+\. :T]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]).getTime()-e}},{key:"ToJson",value:function(e){var t=Date.now(),n=60*(new Date).getTimezoneOffset()*1e3,i=new Date(t-n+e.ServerTimeDelta);this.DateTimeStamp=i.toISOString().slice(0,-1),this.PosId=e.PosId;var s={message:{id:this.Id,event:this.EventName,data:this.Data,datetime:this.DateTimeStamp}};if(this._needsEncryption||(s.message.pos_id=this.PosId),this.DecryptedJson=JSON.stringify(s),!this._needsEncryption)return this.DecryptedJson;var r=a.Crypto.AesEncrypt(e.Secrets.EncKey,this.DecryptedJson),o={enc:r,hmac:a.Crypto.HmacSignature(e.Secrets.HmacKey,r).toUpperCase(),pos_id:e.PosId};return JSON.stringify(o)}}],[{key:"ParseBankDate",value:function(e){return 8!==e.length?null:new Date("".concat(e.substr(4,4),"-").concat(e.substr(2,2),"-").concat(e.substr(0,2)))}},{key:"ParseBankDateTimeStr",value:function(e,t){return new Date("".concat(e.substr(0,2)," ").concat(e.substr(2,3)," ").concat(e.substr(5,2)," ").concat(t))}},{key:"FromJson",value:function(t,n){var i=JSON.parse(t);if(null!=i.message){var s=new e(i.message.id,i.message.event,i.message.data,!1);return s.DecryptedJson=t,s}if(null==n)return new e("UNKNOWN","NOSECRETS",null,!1);if(a.Crypto.HmacSignature(n.HmacKey,i.enc).toUpperCase()!=i.hmac)return new e("_",u.InvalidHmacSignature,null,!1);var r=a.Crypto.AesDecrypt(n.EncKey,i.enc);try{var o=JSON.parse(r),l=new e(o.message.id,o.message.event,o.message.data,!0);return l.DateTimeStamp=o.message.datetime,l.PosId=o.message.pos_id,l.IncomingHmac=i.hmac,l.DecryptedJson=r,l}catch(t){return new e("UNKNOWN","UNPARSEABLE",{msg:r},!1)}}}]),e}()},"./src/Pairing.js":
/*!************************!*\
  !*** ./src/Pairing.js ***!
  \************************/
/*! exports provided: PairRequest, KeyRequest, KeyResponse, KeyCheck, PairResponse, SecretsAndKeyResponse, DropKeysRequest */function(e,t,n){"use strict";n.r(t),n.d(t,"PairRequest",function(){return l}),n.d(t,"KeyRequest",function(){return h}),n.d(t,"KeyResponse",function(){return c}),n.d(t,"KeyCheck",function(){return d}),n.d(t,"PairResponse",function(){return f}),n.d(t,"SecretsAndKeyResponse",function(){return p}),n.d(t,"DropKeysRequest",function(){return m});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),l=function(){function e(){s()(this,e)}return o()(e,[{key:"ToMessage",value:function(){return new a.Message(u.RequestIdHelper.Id("pr"),a.Events.PairRequest,{padding:!0},!1)}}]),e}(),h=function e(t){s()(this,e),this.RequestId=t.Id,this.Aenc=t.Data.enc.A,this.Ahmac=t.Data.hmac.A},c=function(){function e(t,n,i){s()(this,e),this.RequestId=t,this.Benc=n,this.Bhmac=i}return o()(e,[{key:"ToMessage",value:function(){var e={enc:{B:this.Benc},hmac:{B:this.Bhmac}};return new a.Message(this.RequestId,a.Events.KeyResponse,e,!1)}}]),e}(),d=function e(t){s()(this,e),this.ConfirmationCode=t.IncomingHmac.substring(0,6)},f=function e(t){s()(this,e),this.Success=t.Data.success},p=function e(t,n){s()(this,e),this.Secrets=t,this.KeyResponse=n},m=function(){function e(){s()(this,e)}return o()(e,[{key:"ToMessage",value:function(){return new a.Message(u.RequestIdHelper.Id("drpkys"),a.Events.DropKeysAdvice,null,!0)}}]),e}()},"./src/PairingHelper.js":
/*!******************************!*\
  !*** ./src/PairingHelper.js ***!
  \******************************/
/*! exports provided: GENERATOR, GROUP14_2048_BIT_MODP, PairingHelper, PublicKeyAndSecret */function(e,t,n){"use strict";n.r(t),n.d(t,"GENERATOR",function(){return c}),n.d(t,"GROUP14_2048_BIT_MODP",function(){return d}),n.d(t,"PairingHelper",function(){return f}),n.d(t,"PublicKeyAndSecret",function(){return p});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Pairing */"./src/Pairing.js"),u=n(/*! ./Secrets */"./src/Secrets.js"),l=n(/*! ./Crypto */"./src/Crypto.js"),h=n(/*! ./DiffieHellman */"./src/DiffieHellman.js"),c=2,d="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AACAA68FFFFFFFFFFFFFFFF",f=function(){function e(){s()(this,e)}return o()(e,[{key:"GenerateSecretsAndKeyResponse",value:function(e){var t=this._calculateMyPublicKeyAndSecret(e.Aenc),n=t.MyPublicKey,i=t.SharedSecretKey,s=this._calculateMyPublicKeyAndSecret(e.Ahmac),r=s.MyPublicKey,o=s.SharedSecretKey,l=new u.Secrets(i,o),h=new a.KeyResponse(e.RequestId,n,r);return new a.SecretsAndKeyResponse(l,h)}},{key:"_calculateMyPublicKeyAndSecret",value:function(e){var t=new h.DiffieHellman,n=t.RandomPrivateKey(d),i=t.PublicKey(d,c,n),s=t.Secret(d,e,n),r=this.DHSecretToSPISecret(s);return new p(i,r)}},{key:"DHSecretToSPISecret",value:function(e){return e.length%2==1&&(e="0"+e),e=e.padStart(512,"0"),l.Crypto.GenerateHash(e)}}],[{key:"NewPairRequest",value:function(){return new a.PairRequest}}]),e}(),p=function e(t,n){s()(this,e),this.MyPublicKey=t,this.SharedSecretKey=n}},"./src/PayAtTable.js":
/*!***************************!*\
  !*** ./src/PayAtTable.js ***!
  \***************************/
/*! exports provided: BillStatusResponse, BillRetrievalResult, PaymentType, BillPayment, PaymentHistoryEntry, PayAtTableConfig, GetOpenTablesResponse, OpenTablesEntry, BillPaymentFlowEndedResponse */function(e,t,n){"use strict";n.r(t),n.d(t,"BillStatusResponse",function(){return l}),n.d(t,"BillRetrievalResult",function(){return h}),n.d(t,"PaymentType",function(){return c}),n.d(t,"BillPayment",function(){return d}),n.d(t,"PaymentHistoryEntry",function(){return f}),n.d(t,"PayAtTableConfig",function(){return p}),n.d(t,"GetOpenTablesResponse",function(){return m}),n.d(t,"OpenTablesEntry",function(){return g}),n.d(t,"BillPaymentFlowEndedResponse",function(){return _});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./Purchase */"./src/Purchase.js"),l=function(){function e(){s()(this,e),this.Result=null,this.BillId=null,this.TableId=null,this.OperatorId=null,this.TotalAmount=0,this.OutstandingAmount=0,this.BillData=""}return o()(e,[{key:"getBillPaymentHistory",value:function(){if(!this.BillData)return[];return JSON.parse(this.BillData).map(function(e){return new f(e.payment_type,e.payment_summary)})}},{key:"ToMessage",value:function(e){var t={success:this.Result==h.SUCCESS};return this.BillId&&(t.bill_id=this.BillId),this.TableId&&(t.table_id=this.TableId),this.Result==h.SUCCESS?(t.bill_total_amount=this.TotalAmount,t.bill_outstanding_amount=this.OutstandingAmount,t.bill_payment_history=this.getBillPaymentHistory()):(t.error_reason=this.Result.toString(),t.error_detail=this.Result.toString()),new a.Message(e,a.Events.PayAtTableBillDetails,t,!0)}}],[{key:"ToBillData",value:function(e){return e.length<1?"":JSON.stringify(e)}}]),e}(),h={SUCCESS:"SUCCESS",INVALID_TABLE_ID:"INVALID_TABLE_ID",INVALID_BILL_ID:"INVALID_BILL_ID",INVALID_OPERATOR_ID:"INVALID_OPERATOR_ID"},c={CARD:"CARD",CASH:"CASH"},d=function e(t){s()(this,e),this._incomingAdvice=t,this.BillId=this._incomingAdvice.Data.bill_id,this.TableId=this._incomingAdvice.Data.table_id,this.OperatorId=this._incomingAdvice.Data.operator_id,this.PaymentFlowStarted=null;var n=this._incomingAdvice.Data.payment_type;this.PaymentType=n;var i=new a.Message(t.Id,"payment_details",t.Data.payment_details,!1);this.PurchaseResponse=new u.PurchaseResponse(i),this.PurchaseAmount=this.PurchaseResponse.GetPurchaseAmount(),this.TipAmount=this.PurchaseResponse.GetTipAmount(),this.SurchargeAmount=this.PurchaseResponse.GetSurchargeAmount()},f=function(){function e(t,n){s()(this,e),this.PaymentType=t,this.PaymentSummary=n}return o()(e,[{key:"toJSON",value:function(){return{payment_type:this.PaymentType,payment_summary:this.PaymentSummary}}},{key:"GetTerminalRefId",value:function(){return this.PaymentSummary.terminal_ref_id}}]),e}(),p=function(){function e(){s()(this,e),this.PayAtTabledEnabled=!1,this.OperatorIdEnabled=!1,this.SplitByAmountEnabled=!1,this.EqualSplitEnabled=!1,this.TableRetrievalEnabled=!1,this.TippingEnabled=!1,this.SummaryReportEnabled=!1,this.LabelPayButton="",this.LabelOperatorId="",this.LabelTableId="",this.AllowedOperatorIds=[]}return o()(e,[{key:"ToMessage",value:function(e){var t={pay_at_table_enabled:this.PayAtTabledEnabled,operator_id_enabled:this.OperatorIdEnabled,split_by_amount_enabled:this.SplitByAmountEnabled,equal_split_enabled:this.EqualSplitEnabled,tipping_enabled:this.TippingEnabled,summary_report_enabled:this.SummaryReportEnabled,pay_button_label:this.LabelPayButton,operator_id_label:this.LabelOperatorId,table_id_label:this.LabelTableId,operator_id_list:this.AllowedOperatorIds,table_retrieval_enabled:this.TableRetrievalEnabled};return new a.Message(e,a.Events.PayAtTableSetTableConfig,t,!0)}}],[{key:"FeatureDisableMessage",value:function(e){return new a.Message(e,a.Events.PayAtTableSetTableConfig,{pay_at_table_enabled:!1},!0)}}]),e}(),m=function(){function e(){s()(this,e),this.TableData=null}return o()(e,[{key:"GetOpenTables",value:function(){return this.TableData?JSON.parse(this.TableData):[]}},{key:"ToMessage",value:function(e){var t={tables:this.GetOpenTables()};return new a.Message(e,a.Events.PayAtTableOpenTables,t,!0)}}]),e}(),g=function(){function e(){s()(this,e),this.TableId=null,this.Label=null,this.BillOutstandingAmount=null}return o()(e,[{key:"toJSON",value:function(){return{table_id:this.TableId,label:this.Label,bill_outstanding_amount:this.BillOutstandingAmount}}}]),e}(),_=function e(t){s()(this,e),this.BillId=t.Data.bill_id,this.BillOutstandingAmount=t.Data.bill_outstanding_amount,this.BillTotalAmount=t.Data.bill_total_amount,this.OperatorId=t.Data.operator_id,this.TableId=t.Data.table_id,this.CardTotalCount=t.Data.card_total_count,this.CardTotalAmount=t.Data.card_total_amount,this.CashTotalCount=t.Data.cash_total_count,this.CashTotalAmount=t.Data.cash_total_amount}},"./src/PingHelper.js":
/*!***************************!*\
  !*** ./src/PingHelper.js ***!
  \***************************/
/*! exports provided: PongHelper, PingHelper */function(e,t,n){"use strict";n.r(t),n.d(t,"PongHelper",function(){return l}),n.d(t,"PingHelper",function(){return h});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),u=n(/*! ./Messages */"./src/Messages.js"),l=function(){function e(){s()(this,e)}return o()(e,null,[{key:"GeneratePongRessponse",value:function(e){return new u.Message(e.Id,u.Events.Pong,null,!0)}}]),e}(),h=function(){function e(){s()(this,e)}return o()(e,null,[{key:"GeneratePingRequest",value:function(){return new u.Message(a.RequestIdHelper.Id("ping"),u.Events.Ping,null,!0)}}]),e}()},"./src/PosInfo.js":
/*!************************!*\
  !*** ./src/PosInfo.js ***!
  \************************/
/*! exports provided: SetPosInfoRequest, SetPosInfoResponse, DeviceInfo */function(e,t,n){"use strict";n.r(t),n.d(t,"SetPosInfoRequest",function(){return l}),n.d(t,"SetPosInfoResponse",function(){return h}),n.d(t,"DeviceInfo",function(){return c});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),l=function(){function e(t,n,i,r,o){s()(this,e),this._version=t,this._vendorId=n,this._libraryLanguage=i,this._libraryVersion=r,this._otherInfo=o}return o()(e,[{key:"toMessage",value:function(){var e={pos_version:this._version,pos_vendor_id:this._vendorId,library_language:this._libraryLanguage,library_version:this._libraryVersion,other_info:this._otherInfo};return new a.Message(u.RequestIdHelper.Id("prav"),a.Events.SetPosInfoRequest,e,!0)}}]),e}(),h=function(){function e(t){s()(this,e),this._success=t.GetSuccessState()==a.SuccessState.Success,this._m=t}return o()(e,[{key:"isSuccess",value:function(){return this._success}},{key:"getErrorReason",value:function(){return this._m.Data.error_reason}},{key:"getErrorDetail",value:function(){return this._m.Data.error_detail}},{key:"getResponseValueWithAttribute",value:function(e){return this._m.Data[e]}}]),e}(),c=function(){function e(){s()(this,e)}return o()(e,null,[{key:"GetAppDeviceInfo",value:function(){var e={};return e.device_system=navigator.userAgent,e}}]),e}()},"./src/Preauth.js":
/*!************************!*\
  !*** ./src/Preauth.js ***!
  \************************/
/*! exports provided: PreauthEvents, AccountVerifyRequest, AccountVerifyResponse, PreauthOpenRequest, PreauthTopupRequest, PreauthPartialCancellationRequest, PreauthExtendRequest, PreauthCancelRequest, PreauthCompletionRequest, PreauthResponse */function(e,t,n){"use strict";n.r(t),n.d(t,"PreauthEvents",function(){return c}),n.d(t,"AccountVerifyRequest",function(){return d}),n.d(t,"AccountVerifyResponse",function(){return f}),n.d(t,"PreauthOpenRequest",function(){return p}),n.d(t,"PreauthTopupRequest",function(){return m}),n.d(t,"PreauthPartialCancellationRequest",function(){return g}),n.d(t,"PreauthExtendRequest",function(){return _}),n.d(t,"PreauthCancelRequest",function(){return v}),n.d(t,"PreauthCompletionRequest",function(){return w}),n.d(t,"PreauthResponse",function(){return y});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),u=n(/*! ./Messages */"./src/Messages.js"),l=n(/*! ./Purchase */"./src/Purchase.js"),h=n(/*! ./SpiModels */"./src/SpiModels.js"),c={AccountVerifyRequest:"account_verify",AccountVerifyResponse:"account_verify_response",PreauthOpenRequest:"preauth",PreauthOpenResponse:"preauth_response",PreauthTopupRequest:"preauth_topup",PreauthTopupResponse:"preauth_topup_response",PreauthExtendRequest:"preauth_extend",PreauthExtendResponse:"preauth_extend_response",PreauthPartialCancellationRequest:"preauth_partial_cancellation",PreauthPartialCancellationResponse:"preauth_partial_cancellation_response",PreauthCancellationRequest:"preauth_cancellation",PreauthCancellationResponse:"preauth_cancellation_response",PreauthCompleteRequest:"completion",PreauthCompleteResponse:"completion_response"},d=function(){function e(t){s()(this,e),this.PosRefId=t}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId};return new u.Message(a.RequestIdHelper.Id("prav"),c.AccountVerifyRequest,e,!0)}}]),e}(),f=function e(t){s()(this,e),this.Details=new l.PurchaseResponse(t),this.PosRefId=this.Details.PosRefId,this._m=t},p=function(){function e(t,n){s()(this,e),this.PosRefId=n,this.PreauthAmount=t,this.Config=new h.SpiConfig,this.Options=new h.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,preauth_amount:this.PreauthAmount};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new u.Message(a.RequestIdHelper.Id("prac"),c.PreauthOpenRequest,e,!0)}}]),e}(),m=function(){function e(t,n,i){s()(this,e),this.PreauthId=t,this.TopupAmount=n,this.PosRefId=i,this.Config=new h.SpiConfig,this.Options=new h.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,preauth_id:this.PreauthId,topup_amount:this.TopupAmount};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new u.Message(a.RequestIdHelper.Id("prtu"),c.PreauthTopupRequest,e,!0)}}]),e}(),g=function(){function e(t,n,i){s()(this,e),this.PreauthId=t,this.PartialCancellationAmount=n,this.PosRefId=i,this.Config=new h.SpiConfig,this.Options=new h.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,preauth_id:this.PreauthId,preauth_cancel_amount:this.PartialCancellationAmount};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new u.Message(a.RequestIdHelper.Id("prpc"),c.PreauthPartialCancellationRequest,e,!0)}}]),e}(),_=function(){function e(t,n){s()(this,e),this.PreauthId=t,this.PosRefId=n,this.Config=new h.SpiConfig,this.Options=new h.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,preauth_id:this.PreauthId};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new u.Message(a.RequestIdHelper.Id("prext"),c.PreauthExtendRequest,e,!0)}}]),e}(),v=function(){function e(t,n){s()(this,e),this.PreauthId=t,this.PosRefId=n,this.Config=new h.SpiConfig,this.Options=new h.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,preauth_id:this.PreauthId};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new u.Message(a.RequestIdHelper.Id("prac"),c.PreauthCancellationRequest,e,!0)}}]),e}(),w=function(){function e(t,n,i,r){s()(this,e),this.PreauthId=t,this.CompletionAmount=n,this.PosRefId=i,this.SurchargeAmount=r,this.Config=new h.SpiConfig,this.Options=new h.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,preauth_id:this.PreauthId,completion_amount:this.CompletionAmount,surcharge_amount:this.SurchargeAmount};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new u.Message(a.RequestIdHelper.Id("prac"),c.PreauthCompleteRequest,e,!0)}}]),e}(),y=function(){function e(t){s()(this,e),this.PreauthId=t.Data.preauth_id,this.Details=new l.PurchaseResponse(t),this.PosRefId=this.Details.PosRefId,this._m=t}return o()(e,[{key:"GetBalanceAmount",value:function(){switch(this._m.Data.transaction_type){case"PRE-AUTH":return this._m.Data.preauth_amount;case"TOPUP":case"CANCEL":case"PRE-AUTH EXT":return this._m.Data.balance_amount;case"PCOMP":case"PRE-AUTH CANCEL":default:return 0}}},{key:"GetPreviousBalanceAmount",value:function(){switch(this._m.Data.transaction_type){case"PRE-AUTH":return 0;case"TOPUP":case"CANCEL":case"PRE-AUTH EXT":return this._m.Data.existing_preauth_amount;case"PCOMP":return this._m.Data.completion_amount;case"PRE-AUTH CANCEL":return this._m.Data.preauth_amount;default:return 0}}},{key:"GetCompletionAmount",value:function(){switch(this._m.Data.transaction_type){case"PCOMP":return this._m.Data.completion_amount;default:return 0}}},{key:"GetSurchargeAmount",value:function(){switch(this._m.Data.transaction_type){case"PCOMP":return this._m.Data.surcharge_amount;default:return 0}}},{key:"WasMerchantReceiptPrinted",value:function(){return this._m.Data.merchant_receipt_printed}},{key:"WasCustomerReceiptPrinted",value:function(){return this._m.Data.customer_receipt_printed}}]),e}()},"./src/Printing.js":
/*!*************************!*\
  !*** ./src/Printing.js ***!
  \*************************/
/*! exports provided: PrintingRequest, PrintingResponse, Printer */function(e,t,n){"use strict";n.r(t),n.d(t,"PrintingRequest",function(){return l}),n.d(t,"PrintingResponse",function(){return h}),n.d(t,"Printer",function(){return c});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),l=function(){function e(t,n){s()(this,e),this._key=t,this._payload=n}return o()(e,[{key:"toMessage",value:function(){var e={key:this._key,payload:this._payload};return new a.Message(u.RequestIdHelper.Id("print"),a.Events.PrintingRequest,e,!0)}}]),e}(),h=function(){function e(t){s()(this,e),this._success=t.GetSuccessState()==a.SuccessState.Success,this._m=t}return o()(e,[{key:"isSuccess",value:function(){return this._success}},{key:"getErrorReason",value:function(){return this._m.Data.error_reason}},{key:"getErrorDetail",value:function(){return this._m.Data.error_detail}},{key:"getResponseValueWithAttribute",value:function(e){return this._m.Data[e]}}]),e}(),c=function(){function e(t){s()(this,e),this.buffer=[],this.element=t}return o()(e,[{key:"print",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.buffer.push(t.join(" ")),this._render()}},{key:"_render",value:function(){this.element.innerText=this.buffer.join("\n\n \\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/ \n\n"),this.element.scrollTop=this.element.scrollHeight}},{key:"Clear",value:function(){this.buffer=[],this._render()}}]),e}()},"./src/Purchase.js":
/*!*************************!*\
  !*** ./src/Purchase.js ***!
  \*************************/
/*! exports provided: PurchaseRequest, PurchaseResponse, CancelTransactionRequest, CancelTransactionResponse, GetLastTransactionRequest, GetLastTransactionResponse, RefundRequest, RefundResponse, SignatureRequired, SignatureDecline, SignatureAccept, MotoPurchaseRequest, MotoPurchaseResponse, PhoneForAuthRequired, AuthCodeAdvice */function(e,t,n){"use strict";n.r(t),n.d(t,"PurchaseRequest",function(){return h}),n.d(t,"PurchaseResponse",function(){return c}),n.d(t,"CancelTransactionRequest",function(){return d}),n.d(t,"CancelTransactionResponse",function(){return f}),n.d(t,"GetLastTransactionRequest",function(){return p}),n.d(t,"GetLastTransactionResponse",function(){return m}),n.d(t,"RefundRequest",function(){return g}),n.d(t,"RefundResponse",function(){return _}),n.d(t,"SignatureRequired",function(){return v}),n.d(t,"SignatureDecline",function(){return w}),n.d(t,"SignatureAccept",function(){return y}),n.d(t,"MotoPurchaseRequest",function(){return S}),n.d(t,"MotoPurchaseResponse",function(){return C}),n.d(t,"PhoneForAuthRequired",function(){return b}),n.d(t,"AuthCodeAdvice",function(){return T});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),l=n(/*! ./SpiModels */"./src/SpiModels.js"),h=function(){function e(t,n){s()(this,e),this.PosRefId=n,this.PurchaseAmount=t,this.TipAmount=0,this.CashoutAmount=0,this.PromptForCashout=!1,this.SurchargeAmount=0,this.Config=new l.SpiConfig,this.Options=new l.TransactionOptions,this.Id=n,this.AmountCents=t}return o()(e,[{key:"AmountSummary",value:function(){return"Purchase: ".concat((this.PurchaseAmount/100).toFixed(2),"; \n            Tip: ").concat((this.TipAmount/100).toFixed(2),"; \n            Cashout: ").concat((this.CashoutAmount/100).toFixed(2),";")}},{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,purchase_amount:this.PurchaseAmount,tip_amount:this.TipAmount,cash_amount:this.CashoutAmount,prompt_for_cashout:this.PromptForCashout,surcharge_amount:this.SurchargeAmount};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new a.Message(u.RequestIdHelper.Id("prchs"),a.Events.PurchaseRequest,e,!0)}}]),e}(),c=function(){function e(t){s()(this,e),this._m=t,this.RequestId=t.Id,this.PosRefId=t.Data.pos_ref_id,this.SchemeName=t.Data.scheme_name,this.SchemeAppName=t.Data.scheme_name,this.Success=t.GetSuccessState()==a.SuccessState.Success}return o()(e,[{key:"GetRRN",value:function(){return this._m.Data.rrn}},{key:"GetPurchaseAmount",value:function(){return this._m.Data.purchase_amount}},{key:"GetTipAmount",value:function(){return this._m.Data.tip_amount||0}},{key:"GetSurchargeAmount",value:function(){return this._m.Data.surcharge_amount||0}},{key:"GetCashoutAmount",value:function(){return this._m.Data.cash_amount}},{key:"GetBankNonCashAmount",value:function(){return this._m.Data.bank_noncash_amount}},{key:"GetBankCashAmount",value:function(){return this._m.Data.bank_cash_amount}},{key:"GetCustomerReceipt",value:function(){return this._m.Data.customer_receipt||""}},{key:"GetMerchantReceipt",value:function(){return this._m.Data.merchant_receipt||""}},{key:"GetResponseText",value:function(){return this._m.Data.host_response_text||""}},{key:"GetResponseCode",value:function(){return this._m.Data.host_response_code}},{key:"GetTerminalReferenceId",value:function(){return this._m.Data.terminal_ref_id}},{key:"GetCardEntry",value:function(){return this._m.Data.card_entry}},{key:"GetAccountType",value:function(){return this._m.Data.account_type}},{key:"GetAuthCode",value:function(){return this._m.Data.auth_code}},{key:"GetBankDate",value:function(){return this._m.Data.bank_date}},{key:"GetBankTime",value:function(){return this._m.Data.bank_time}},{key:"GetMaskedPan",value:function(){return this._m.Data.masked_pan}},{key:"GetTerminalId",value:function(){return this._m.Data.terminal_id}},{key:"WasMerchantReceiptPrinted",value:function(){return this._m.Data.merchant_receipt_printed}},{key:"WasCustomerReceiptPrinted",value:function(){return this._m.Data.customer_receipt_printed}},{key:"GetSettlementDate",value:function(){var e=this._m.Data.bank_settlement_date;return e?a.Message.ParseBankDate(e):null}},{key:"GetResponseValue",value:function(e){return this._m.Data[e]}},{key:"ToPaymentSummary",value:function(){return{account_type:this.GetAccountType(),auth_code:this.GetAuthCode(),bank_date:this.GetBankDate(),bank_time:this.GetBankTime(),host_response_code:this.GetResponseCode(),host_response_text:this.GetResponseText(),masked_pan:this.GetMaskedPan(),purchase_amount:this.GetPurchaseAmount(),rrn:this.GetRRN(),scheme_name:this.SchemeName,terminal_id:this.GetTerminalId(),terminal_ref_id:this.GetTerminalReferenceId(),tip_amount:this.GetTipAmount(),surcharge_amount:this.GetSurchargeAmount()}}}]),e}(),d=function(){function e(){s()(this,e)}return o()(e,[{key:"ToMessage",value:function(){return new a.Message(u.RequestIdHelper.Id("ctx"),a.Events.CancelTransactionRequest,null,!0)}}]),e}(),f=function(){function e(t){s()(this,e),this._m=t,this.PosRefId=this._m.Data.pos_ref_id,this.Success=this._m.GetSuccessState()==a.SuccessState.Success}return o()(e,[{key:"GetErrorReason",value:function(){return this._m.Data.error_reason}},{key:"GetErrorDetail",value:function(){return this._m.Data.error_detail}},{key:"GetResponseValueWithAttribute",value:function(e){return this._m.Data[e]}}]),e}(),p=function(){function e(){s()(this,e)}return o()(e,[{key:"ToMessage",value:function(){return new a.Message(u.RequestIdHelper.Id("glt"),a.Events.GetLastTransactionRequest,null,!0)}}]),e}(),m=function(){function e(t){s()(this,e),this._m=t}return o()(e,[{key:"WasRetrievedSuccessfully",value:function(){return!!this.GetResponseCode()}},{key:"WasTimeOutOfSyncError",value:function(){return this._m.GetError().startsWith("TIME_OUT_OF_SYNC")}},{key:"WasOperationInProgressError",value:function(){return this._m.GetError().startsWith("OPERATION_IN_PROGRESS")}},{key:"IsWaitingForSignatureResponse",value:function(){return this._m.GetError().startsWith("OPERATION_IN_PROGRESS_AWAITING_SIGNATURE")}},{key:"IsWaitingForAuthCode",value:function(){return this._m.GetError().startsWith("OPERATION_IN_PROGRESS_AWAITING_PHONE_AUTH_CODE")}},{key:"IsStillInProgress",value:function(e){return this.WasOperationInProgressError()&&(this.GetPosRefId()==e||null==this.GetPosRefId())}},{key:"GetSuccessState",value:function(){return this._m.GetSuccessState()}},{key:"WasSuccessfulTx",value:function(){return this._m.GetSuccessState()==a.SuccessState.Success}},{key:"GetTxType",value:function(){return this._m.Data.transaction_type}},{key:"GetPosRefId",value:function(){return this._m.Data.pos_ref_id}},{key:"GetBankNonCashAmount",value:function(){return this._m.Data.bank_noncash_amount}},{key:"GetSchemeApp",value:function(){return this._m.Data.scheme_name}},{key:"GetSchemeName",value:function(){return this._m.Data.scheme_name}},{key:"GetAmount",value:function(){return this._m.Data.amount_purchase}},{key:"GetTransactionAmount",value:function(){return this._m.Data.amount_transaction_type}},{key:"GetBankDateTimeString",value:function(){return this._m.Data.bank_date+this._m.Data.bank_time}},{key:"GetRRN",value:function(){return this._m.Data.rrn}},{key:"GetResponseText",value:function(){return""|this._m.Data.host_response_text}},{key:"GetResponseCode",value:function(){return this._m.Data.host_response_code}},{key:"CopyMerchantReceiptToCustomerReceipt",value:function(){var e=this._m.Data.customer_receipt,t=this._m.Data.merchant_receipt;""==t||e||(this._m.Data.customer_receipt=t)}}]),e}(),g=function(){function e(t,n,i){s()(this,e),this.AmountCents=t,this.Id=u.RequestIdHelper.Id("refund"),this.PosRefId=n,this.SuppressMerchantPassword=i,this.Config=new l.SpiConfig,this.Options=new l.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={refund_amount:this.AmountCents,pos_ref_id:this.PosRefId,suppress_merchant_password:this.SuppressMerchantPassword};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new a.Message(u.RequestIdHelper.Id("refund"),a.Events.RefundRequest,e,!0)}}]),e}(),_=function(){function e(t){s()(this,e),this._m=t,this.RequestId=t.Id,this.PosRefId=t.Data.pos_ref_id,this.SchemeName=t.Data.scheme_name,this.SchemeAppName=t.Data.scheme_name,this.Success=t.GetSuccessState()==a.SuccessState.Success}return o()(e,[{key:"GetRefundAmount",value:function(){return this._m.Data.refund_amount}},{key:"GetRRN",value:function(){return this._m.Data.rrn}},{key:"GetCustomerReceipt",value:function(){return this._m.Data.customer_receipt||""}},{key:"GetMerchantReceipt",value:function(){return this._m.Data.merchant_receipt}},{key:"GetResponseText",value:function(){return this._m.Data.host_response_text||""}},{key:"GetResponseCode",value:function(){return this._m.Data.host_response_code||""}},{key:"GetTerminalReferenceId",value:function(){return this._m.Data.terminal_ref_id||""}},{key:"GetCardEntry",value:function(){return this._m.Data.card_entry||""}},{key:"GetAccountType",value:function(){return this._m.Data.account_type||""}},{key:"GetAuthCode",value:function(){return this._m.Data.auth_code||""}},{key:"GetBankDate",value:function(){return this._m.Data.bank_date||""}},{key:"GetBankTime",value:function(){return this._m.Data.bank_time||""}},{key:"GetMaskedPan",value:function(){return this._m.Data.masked_pan||""}},{key:"GetTerminalId",value:function(){return this._m.Data.terminal_id||""}},{key:"WasMerchantReceiptPrinted",value:function(){return this._m.Data.merchant_receipt_printed}},{key:"WasCustomerReceiptPrinted",value:function(){return this._m.Data.customer_receipt_printed}},{key:"GetSettlementDate",value:function(){var e=this._m.Data.bank_settlement_date;return e?a.Message.ParseBankDate(e):null}},{key:"GetResponseValue",value:function(e){return this._m.Data[e]}}]),e}(),v=function(){function e(t){s()(this,e),this.RequestId=t.Id,this.PosRefId=t.Data.pos_ref_id,this._receiptToSign=t.Data.merchant_receipt}return o()(e,[{key:"SignatureRequired",value:function(e,t,n){this.RequestId=t,this.PosRefId=e,this._receiptToSign=n}},{key:"GetMerchantReceipt",value:function(){return this._receiptToSign}}]),e}(),w=function(){function e(t){s()(this,e),this.PosRefId=t}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId};return new a.Message(u.RequestIdHelper.Id("sigdec"),a.Events.SignatureDeclined,e,!0)}}]),e}(),y=function(){function e(t){s()(this,e),this.PosRefId=t}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId};return new a.Message(u.RequestIdHelper.Id("sigacc"),a.Events.SignatureAccepted,e,!0)}}]),e}(),S=function(){function e(t,n,i){s()(this,e),this.PosRefId=n,this.PurchaseAmount=t,this.SurchargeAmount=i,this.SuppressMerchantPassword=!1,this.Config=new l.SpiConfig,this.Options=new l.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,purchase_amount:this.PurchaseAmount,surcharge_amount:this.SurchargeAmount,suppress_merchant_password:this.SuppressMerchantPassword};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!0,this.Config.EnabledSignatureFlowOnEftpos=!0,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new a.Message(u.RequestIdHelper.Id("moto"),a.Events.MotoPurchaseRequest,e,!0)}}]),e}(),C=function e(t){s()(this,e),this.PurchaseResponse=new c(t),this.PosRefId=c.PosRefId},b=function(){function e(){s()(this,e);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(4===n.length)this.PosRefId=n[0],this.RequestId=n[1],this._phoneNumber=n[2],this._merchantId=n[3];else{if(1!==n.length)throw new Error("Invalid call sig for Phone auth required class");this.RequestId=n[0].Id,this.PosRefId=n[0].Data.pos_ref_id,this._phoneNumber=n[0].Data.auth_centre_phone_number,this._merchantId=n[0].Data.merchant_id}}return o()(e,[{key:"GetPhoneNumber",value:function(){return this._phoneNumber}},{key:"GetMerchantId",value:function(){return this._merchantId}}]),e}(),T=function(){function e(t,n){s()(this,e),this.PosRefId=t,this.AuthCode=n}return o()(e,[{key:"ToMessage",value:function(){var e={pos_ref_id:this.PosRefId,auth_code:this.AuthCode};return new a.Message(u.RequestIdHelper.Id("authad"),a.Events.AuthCodeAdvice,e,!0)}}]),e}()},"./src/PurchaseHelper.js":
/*!*******************************!*\
  !*** ./src/PurchaseHelper.js ***!
  \*******************************/
/*! exports provided: PurchaseHelper */function(e,t,n){"use strict";n.r(t),n.d(t,"PurchaseHelper",function(){return u});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Purchase */"./src/Purchase.js"),u=function(){function e(){s()(this,e)}return o()(e,null,[{key:"CreatePurchaseRequest",value:function(e,t){return new a.PurchaseRequest(e,t)}},{key:"CreatePurchaseRequestV2",value:function(e,t,n,i,s,r){return Object.assign(new a.PurchaseRequest(t,e),{CashoutAmount:i,TipAmount:n,PromptForCashout:s,SurchargeAmount:r})}},{key:"CreateRefundRequest",value:function(e,t,n){return new a.RefundRequest(e,t,n)}}]),e}()},"./src/RequestIdHelper.js":
/*!********************************!*\
  !*** ./src/RequestIdHelper.js ***!
  \********************************/
/*! exports provided: RequestIdHelper */function(e,t,n){"use strict";n.r(t),n.d(t,"RequestIdHelper",function(){return u});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=1,u=function(){function e(){s()(this,e)}return o()(e,null,[{key:"Id",value:function(e){return e+a++}}]),e}()},"./src/Secrets.js":
/*!************************!*\
  !*** ./src/Secrets.js ***!
  \************************/
/*! exports provided: Secrets */function(e,t,n){"use strict";n.r(t),n.d(t,"Secrets",function(){return a});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=function(){function e(t,n){s()(this,e),this.EncKey=t,this.HmacKey=n}return o()(e,null,[{key:"save",value:function(e,t){localStorage.setItem("EncKey",e),localStorage.setItem("HmacKey",t)}},{key:"restore",value:function(){return new e(localStorage.getItem("EncKey"),localStorage.getItem("HmacKey"))}},{key:"isSaved",value:function(){return localStorage.getItem("EncKey")&&localStorage.getItem("HmacKey")}},{key:"Reset",value:function(){localStorage.removeItem("EncKey"),localStorage.removeItem("HmacKey")}}]),e}()},"./src/Service/DeviceService.js":
/*!**************************************!*\
  !*** ./src/Service/DeviceService.js ***!
  \**************************************/
/*! exports provided: DeviceAddressStatus, DeviceAddressResponseCode, HttpStatusCode, DeviceAddressService */function(e,t,n){"use strict";n.r(t),n.d(t,"DeviceAddressStatus",function(){return c}),n.d(t,"DeviceAddressResponseCode",function(){return d}),n.d(t,"HttpStatusCode",function(){return f}),n.d(t,"DeviceAddressService",function(){return p});var i=n(/*! @babel/runtime/regenerator */"./node_modules/@babel/runtime/regenerator/index.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/asyncToGenerator */"./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),o=n.n(r),a=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),u=n.n(a),l=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),h=n.n(l),c=function(){function e(t){u()(this,e),this.UseSecureWebSockets=t,this.ip=null,this.fqdn=null,this.LastUpdated=null,this.DeviceAddressResponseCode=null,this.ResponseStatusDescription=null,this.ResponseMessage=null}return h()(e,[{key:"Address",get:function(){return this.UseSecureWebSockets?this.fqdn:this.ip},set:function(e){this.UseSecureWebSockets?this.fqdn=addreses:this.ip=e}}]),e}(),d={SUCCESS:"SUCCESS",INVALID_SERIAL_NUMBER:"INVALID_SERIAL_NUMBER",ADDRESS_NOT_CHANGED:"ADDRESS_NOT_CHANGED",SERIAL_NUMBER_NOT_CHANGED:"SERIAL_NUMBER_NOT_CHANGED",DEVICE_SERVICE_ERROR:"DEVICE_SERVICE_ERROR"},f={NotFound:404},p=function(){function e(){u()(this,e)}return h()(e,[{key:"RetrieveService",value:function(){var e=o()(s.a.mark(function e(t){var n,i,r,o,a,u,l,h=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.length>1&&void 0!==h[1]?h[1]:"spi-sample-pos1",i=h.length>2?h[2]:void 0,r=h.length>3?h[3]:void 0,o=h.length>4?h[4]:void 0,a=r?"fqdn":"ip",u=o?"https://device-address-api-sb.".concat(i,".msp.assemblypayments.com/v1/").concat(t,"/").concat(a):"https://device-address-api.".concat(i,".msp.assemblypayments.com/v1/").concat(t,"/").concat(a),e.next=8,fetch(u,{method:"GET",headers:{"ASM-MSP-DEVICE-ADDRESS-API-KEY":n}});case 8:return l=e.sent,e.abrupt("return",l);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}()},"./src/Settlement.js":
/*!***************************!*\
  !*** ./src/Settlement.js ***!
  \***************************/
/*! exports provided: SettleRequest, Settlement, SchemeSettlementEntry, SettlementEnquiryRequest */function(e,t,n){"use strict";n.r(t),n.d(t,"SettleRequest",function(){return l}),n.d(t,"Settlement",function(){return h}),n.d(t,"SchemeSettlementEntry",function(){return c}),n.d(t,"SettlementEnquiryRequest",function(){return d});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./SpiModels */"./src/SpiModels.js"),l=function(){function e(t){s()(this,e),this.Id=t,this.Config=new u.SpiConfig,this.Options=new u.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!1,this.Config.EnabledSignatureFlowOnEftpos=!1,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new a.Message(this.Id,a.Events.SettleRequest,e,!0)}}]),e}(),h=function(){function e(t){s()(this,e),this.RequestId=t.Id,this._m=t,this.Success=t.GetSuccessState()==a.SuccessState.Success}return o()(e,[{key:"GetSettleByAcquirerCount",value:function(){return this._m.Data.accumulated_settle_by_acquirer_count}},{key:"GetSettleByAcquirerValue",value:function(){return this._m.Data.accumulated_settle_by_acquirer_value}},{key:"GetTotalCount",value:function(){return this._m.Data.accumulated_total_count}},{key:"GetTotalValue",value:function(){return this._m.Data.accumulated_total_value}},{key:"GetPeriodStartTime",value:function(){var e=this._m.Data.settlement_period_start_time,t=this._m.Data.settlement_period_start_date;return a.Message.ParseBankDateTimeStr(t,e)}},{key:"GetPeriodEndTime",value:function(){var e=this._m.Data.settlement_period_end_time,t=this._m.Data.settlement_period_end_date;return a.Message.ParseBankDateTimeStr(t,e)}},{key:"GetTriggeredTime",value:function(){var e=this._m.Data.settlement_triggered_time,t=this._m.Data.settlement_triggered_date;return a.Message.ParseBankDateTimeStr(t,e)}},{key:"GetResponseText",value:function(){return this._m.Data.host_response_text}},{key:"GetReceipt",value:function(){return this._m.Data.merchant_receipt}},{key:"GetTransactionRange",value:function(){return this._m.Data.transaction_range}},{key:"GetTerminalId",value:function(){return this._m.Data.terminal_id}},{key:"WasMerchantReceiptPrinted",value:function(){return this._m.Data.merchant_receipt_printed}},{key:"GetSchemeSettlementEntries",value:function(){var e=this._m.Data.schemes;return e?e.map(function(e){return new c(e)}):[]}}]),e}(),c=function(){function e(){s()(this,e);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];1===n.length?(this.SchemeName=n[0].scheme_name,this.SettleByAcquirer="yes"==n[0].settle_by_acquirer.toLowerCase(),this.TotalValue=parseInt(n[0].total_value,10),this.TotalCount=parseInt(n[0].total_count,10)):4===n.length&&(this.SchemeName=n[0],this.SettleByAcquirer=n[1],this.TotalCount=n[2],this.TotalValue=n[3])}return o()(e,[{key:"ToString",value:function(){return"SchemeName: ".concat(this.SchemeName,", SettleByAcquirer: ").concat(this.SettleByAcquirer,", TotalCount: ").concat(this.TotalCount,", TotalValue: ").concat(this.TotalValue)}}]),e}(),d=function(){function e(t){s()(this,e),this.Id=t,this.Config=new u.SpiConfig,this.Options=new u.TransactionOptions}return o()(e,[{key:"ToMessage",value:function(){var e={};return this.Config.EnabledPrintMerchantCopy=!0,this.Config.EnabledPromptForCustomerCopyOnEftpos=!1,this.Config.EnabledSignatureFlowOnEftpos=!1,this.Config.AddReceiptConfig(e),this.Options.AddOptions(e),new a.Message(this.Id,a.Events.SettlementEnquiryRequest,e,!0)}}]),e}()},"./src/Spi.js":
/*!********************!*\
  !*** ./src/Spi.js ***!
  \********************/
/*! exports provided: Spi, SPI_VERSION */function(e,t,n){"use strict";n.r(t),n.d(t,"Spi",function(){return k}),n.d(t,"SPI_VERSION",function(){return M});var i=n(/*! @babel/runtime/regenerator */"./node_modules/@babel/runtime/regenerator/index.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/asyncToGenerator */"./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),o=n.n(r),a=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),u=n.n(a),l=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),h=n.n(l),c=n(/*! ./Messages */"./src/Messages.js"),d=n(/*! ./SpiModels */"./src/SpiModels.js"),f=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),p=n(/*! ./PairingHelper */"./src/PairingHelper.js"),m=n(/*! ./Connection */"./src/Connection.js"),g=n(/*! ./SpiPayAtTable */"./src/SpiPayAtTable.js"),_=n(/*! ./PayAtTable */"./src/PayAtTable.js"),v=n(/*! ./SpiPreauth */"./src/SpiPreauth.js"),w=n(/*! ./Cashout */"./src/Cashout.js"),y=n(/*! ./Settlement */"./src/Settlement.js"),S=n(/*! ./Pairing */"./src/Pairing.js"),C=n(/*! ./PosInfo */"./src/PosInfo.js"),b=n(/*! ./PurchaseHelper */"./src/PurchaseHelper.js"),T=n(/*! ./KeyRollingHelper */"./src/KeyRollingHelper.js"),R=n(/*! ./PingHelper */"./src/PingHelper.js"),P=n(/*! ./Purchase */"./src/Purchase.js"),E=n(/*! ./Service/DeviceService */"./src/Service/DeviceService.js"),I=n(/*! ./Printing */"./src/Printing.js"),A=n(/*! ./TerminalStatus */"./src/TerminalStatus.js"),M="2.6.0",k=function(){function e(t,n,i,s){u()(this,e),this._posId=t,this._serialNumber=n,this._secrets=s,this._forceSecureWebSockets=!1,this._eftposAddress="ws://"+i,this._log=console,this.Config=new d.SpiConfig,this._conn=new m.Connection,this.CurrentDeviceStatus=null,this._deviceApiKey=null,this._acquirerCode=null,this._inTestMode=!1,this._autoAddressResolutionEnabled=!1,this._spiMessageStamp=new c.MessageStamp(this._posId,this._secrets,0),this._posVendorId=null,this._posVersion=null,this._hasSetInfo=null,this._mostRecentPingSent=null,this._mostRecentPongReceived=null,this._missedPongsCount=0,this._retriesSinceLastDeviceAddressResolution=0,this._mostRecentLoginResponse=null,this._pongTimeout=5e3,this._pingFrequency=18e3,this._readyToTransact=null,this._periodicPingThread=null,this._txMonitorCheckFrequency=1e3,this._checkOnTxFrequency=2e4,this._maxWaitForCancelTx=1e4,this._sleepBeforeReconnectMs=3e3,this._missedPongsToDisconnect=2,this._retriesBeforeResolvingDeviceAddress=5,this.CurrentFlow=null,this.CurrentPairingFlowState=null,this.CurrentTxFlowState=null}return h()(e,[{key:"CurrentStatus",get:function(){return this._currentStatus},set:function(e){this._currentStatus!==e&&(this._currentStatus=e,document.dispatchEvent(new CustomEvent("StatusChanged",{detail:e})))}}]),h()(e,[{key:"EnablePayAtTable",value:function(){return this._spiPat=new g.SpiPayAtTable(this),this._spiPat}},{key:"DisablePayAtTable",value:function(){return this._spiPat=new g.SpiPayAtTable(this),this._spiPat.Config.PayAtTabledEnabled=!1,this._spiPat}},{key:"EnablePreauth",value:function(){return this._spiPreauth=new v.SpiPreauth(this),this._spiPreauth}},{key:"Start",value:function(){if(!this._posVendorId||!this._posVersion)throw this._log.warn("Missing POS vendor ID and version. posVendorId and posVersion are required before starting"),new Error("Missing POS vendor ID and version. posVendorId and posVersion are required before starting");this._resetConn(),this._startTransactionMonitoringThread(),this.CurrentFlow=d.SpiFlow.Idle,null!=this._secrets?(this._log.info("Starting in Paired State"),this._currentStatus=d.SpiStatus.PairedConnecting,this._conn.Connect()):(this._log.info("Starting in Unpaired State"),this._currentStatus=d.SpiStatus.Unpaired)}},{key:"SetAcquirerCode",value:function(e){return this._acquirerCode=e,!0}},{key:"SetDeviceApiKey",value:function(e){return this._deviceApiKey=e,!0}},{key:"SetSerialNumber",value:function(e){if(this.CurrentStatus!=d.SpiStatus.Unpaired)return!1;var t=this._serialNumber;return this._serialNumber=e,this.HasSerialNumberChanged(t)?this._autoResolveEftposAddress():(null==this.CurrentDeviceStatus&&(this.CurrentDeviceStatus=new E.DeviceAddressStatus),this.CurrentDeviceStatus.DeviceAddressResponseCode=E.DeviceAddressResponseCode.SERIAL_NUMBER_NOT_CHANGED,document.dispatchEvent(new CustomEvent("DeviceAddressChanged",{detail:this.CurrentDeviceStatus}))),!0}},{key:"SetAutoAddressResolution",value:function(e){if(this.CurrentStatus==d.SpiStatus.PairedConnected)return!1;var t=this._autoAddressResolutionEnabled;return this._autoAddressResolutionEnabled=e,e&&!t&&this._autoResolveEftposAddress(),!0}},{key:"SetTestMode",value:function(e){return(!this.CurrentStatus||this.CurrentStatus==d.SpiStatus.Unpaired)&&(e==this._inTestMode||(this._inTestMode=e,this._autoResolveEftposAddress(),!0))}},{key:"SetSecureWebSockets",value:function(e){this._forceSecureWebSockets=e}},{key:"SetPosId",value:function(e){return this.CurrentStatus==d.SpiStatus.Unpaired&&(this._posId=e,this._spiMessageStamp.PosId=e,!0)}},{key:"SetEftposAddress",value:function(e){return this.CurrentStatus!=d.SpiStatus.PairedConnected&&!this._autoAddressResolutionEnabled&&(this._eftposAddress="ws://"+e,this._conn.Address=this._eftposAddress,!0)}},{key:"SetPosInfo",value:function(e,t){this._posVendorId=e,this._posVersion=t}},{key:"AckFlowEndedAndBackToIdle",value:function(){return this.CurrentFlow==d.SpiFlow.Idle||(this.CurrentFlow==d.SpiFlow.Pairing&&this.CurrentPairingFlowState.Finished?(this.CurrentFlow=d.SpiFlow.Idle,!0):!(this.CurrentFlow!=d.SpiFlow.Transaction||!this.CurrentTxFlowState.Finished)&&(this.CurrentFlow=d.SpiFlow.Idle,!0))}},{key:"Pair",value:function(){return this.CurrentStatus!=d.SpiStatus.Unpaired?(this._log.warn("Tried to Pair but we're already so."),!1):this._posId&&this._eftposAddress?(this.CurrentFlow=d.SpiFlow.Pairing,this.CurrentPairingFlowState=new d.PairingFlowState({Successful:!1,Finished:!1,Message:"Connecting...",AwaitingCheckFromEftpos:!1,AwaitingCheckFromPos:!1,ConfirmationCode:""}),document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState})),this._conn.Connect(),!0):(this._log.warn("Tried to Pair but missing posId or updatedEftposAddress"),!1)}},{key:"PairingConfirmCode",value:function(){this.CurrentPairingFlowState.AwaitingCheckFromPos&&(this.CurrentPairingFlowState.AwaitingCheckFromPos=!1,this.CurrentPairingFlowState.AwaitingCheckFromEftpos?(this._log.info("Pair Code Confirmed from POS side, but am still waiting for confirmation from Eftpos."),this.CurrentPairingFlowState.Message="Click YES on EFTPOS if code is: "+this.CurrentPairingFlowState.ConfirmationCode,document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState}))):(this._log.info("Pair Code Confirmed from POS side, and was already confirmed from Eftpos side. Pairing finalised."),this._onPairingSuccess(),this._onReadyToTransact()))}},{key:"PairingCancel",value:function(){this.CurrentFlow!=d.SpiFlow.Pairing||this.CurrentPairingFlowState.Finished||(this.CurrentPairingFlowState.AwaitingCheckFromPos&&!this.CurrentPairingFlowState.AwaitingCheckFromEftpos&&this._send((new S.DropKeysRequest).ToMessage()),this._onPairingFailed())}},{key:"Unpair",value:function(){return this.CurrentStatus!=d.SpiStatus.Unpaired&&(this.CurrentFlow==d.SpiFlow.Idle&&(this._send((new S.DropKeysRequest).ToMessage()),this._doUnpair(),!0))}},{key:"InitiatePurchaseTx",value:function(e,t){if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");var n=b.PurchaseHelper.CreatePurchaseRequest(t,e);n.Config=this.Config;var i=n.ToMessage();return this.CurrentFlow=d.SpiFlow.Transaction,this.CurrentTxFlowState=new d.TransactionFlowState(e,d.TransactionType.Purchase,t,i,"Waiting for EFTPOS connection to make payment request for ".concat(t/100)),this._send(i)&&this.CurrentTxFlowState.Sent("Asked EFTPOS to accept payment for ".concat(t/100)),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"Purchase Initiated")}},{key:"InitiatePurchaseTxV2",value:function(e,t,n,i,s){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new d.TransactionOptions,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(n>0&&(i>0||s))return new d.InitiateTxResult(!1,"Cannot Accept Tips and Cashout at the same time.");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");this.CurrentFlow=d.SpiFlow.Transaction;var a=b.PurchaseHelper.CreatePurchaseRequestV2(e,t,n,i,s,o);a.Config=this.Config,a.Options=r;var u=a.ToMessage();return this.CurrentTxFlowState=new d.TransactionFlowState(e,d.TransactionType.Purchase,t,u,"Waiting for EFTPOS connection to make payment request. ".concat(a.AmountSummary())),this._send(u)&&this.CurrentTxFlowState.Sent("Asked EFTPOS to accept payment for ".concat(a.AmountSummary())),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"Purchase Initiated")}},{key:"InitiateRefundTx",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.TransactionOptions;if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");var s=b.PurchaseHelper.CreateRefundRequest(t,e,n);s.Config=this.Config,s.Options=i;var r=s.ToMessage();return this.CurrentFlow=d.SpiFlow.Transaction,this.CurrentTxFlowState=new d.TransactionFlowState(e,d.TransactionType.Refund,t,r,"Waiting for EFTPOS connection to make refund request for ".concat((t/100).toFixed(2))),this._send(r)&&this.CurrentTxFlowState.Sent("Asked EFTPOS to refund ".concat((t/100).toFixed(2))),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"Refund Initiated")}},{key:"AcceptSignature",value:function(e){if(this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||!this.CurrentTxFlowState.AwaitingSignatureCheck)return this._log.info("Asked to accept signature but I was not waiting for one."),new d.MidTxResult(!1,"Asked to accept signature but I was not waiting for one.");this.CurrentTxFlowState.SignatureResponded(e?"Accepting Signature...":"Declining Signature...");this.CurrentTxFlowState.SignatureRequiredMessage;return this._send(e?new P.SignatureAccept(this.CurrentTxFlowState.PosRefId).ToMessage():new P.SignatureDecline(this.CurrentTxFlowState.PosRefId).ToMessage()),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.MidTxResult(!0,"")}},{key:"SubmitAuthCode",value:function(e){return 6!=e.length?new d.SubmitAuthCodeResult(!1,"Not a 6-digit code."):this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||!this.CurrentTxFlowState.AwaitingPhoneForAuth?(this._log.info("Asked to send auth code but I was not waiting for one."),new d.SubmitAuthCodeResult(!1,"Was not waiting for one.")):(this.CurrentTxFlowState.AuthCodeSent("Submitting Auth Code ".concat(e)),this._send(new P.AuthCodeAdvice(this.CurrentTxFlowState.PosRefId,e).ToMessage()),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.SubmitAuthCodeResult(!0,"Valid Code."))}},{key:"CancelTransaction",value:function(){if(this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished)return this._log.info("Asked to cancel transaction but I was not in the middle of one."),new d.MidTxResult(!1,"Asked to cancel transaction but I was not in the middle of one.");if(this.CurrentTxFlowState.RequestSent){var e=new P.CancelTransactionRequest;this.CurrentTxFlowState.Cancelling("Attempting to Cancel Transaction..."),this._send(e.ToMessage())}else this.CurrentTxFlowState.Failed(null,"Transaction Cancelled. Request Had not even been sent yet.");return document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.MidTxResult(!0,"")}},{key:"InitiateCashoutOnlyTx",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.TransactionOptions;if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");var s=Object.assign(new w.CashoutOnlyRequest(t,e),{SurchargeAmount:n,Options:i,Config:this.Config}).ToMessage();return this.CurrentFlow=d.SpiFlow.Transaction,this.CurrentTxFlowState=new d.TransactionFlowState(e,d.TransactionType.CashoutOnly,t,s,"Waiting for EFTPOS connection to send cashout request for ".concat((t/100).toFixed(2))),this._send(s)&&this.CurrentTxFlowState.Sent("Asked EFTPOS to do cashout for ".concat((t/100).toFixed(2))),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"Cashout Initiated")}},{key:"InitiateMotoPurchaseTx",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.TransactionOptions;if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");var r=Object.assign(new P.MotoPurchaseRequest(t,e),{SurchargeAmount:n,SuppressMerchantPassword:i,Config:this.Config,Options:s}).ToMessage();return this.CurrentFlow=d.SpiFlow.Transaction,this.CurrentTxFlowState=new d.TransactionFlowState(e,d.TransactionType.MOTO,t,r,"Waiting for EFTPOS connection to send MOTO request for ".concat((t/100).toFixed(2))),this._send(r)&&this.CurrentTxFlowState.Sent("Asked EFTPOS do MOTO for ".concat((t/100).toFixed(2))),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"MOTO Initiated")}},{key:"InitiateSettleTx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.TransactionOptions;if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");var n=Object.assign(new y.SettleRequest(f.RequestIdHelper.Id("settle")),{Config:this.Config,Options:t}).ToMessage();return this.CurrentFlow=d.SpiFlow.Transaction,this.CurrentTxFlowState=new d.TransactionFlowState(e,d.TransactionType.Settle,0,n,"Waiting for EFTPOS connection to make a settle request"),this._send(n)&&this.CurrentTxFlowState.Sent("Asked EFTPOS to settle."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"Settle Initiated")}},{key:"InitiateSettlementEnquiry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.TransactionOptions;if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");var n=Object.assign(new y.SettlementEnquiryRequest(f.RequestIdHelper.Id("stlenq")),{Config:this.Config,Options:t}).ToMessage();return this.CurrentFlow=d.SpiFlow.Transaction,this.CurrentTxFlowState=new d.TransactionFlowState(e,d.TransactionType.SettlementEnquiry,0,n,"Waiting for EFTPOS connection to make a settlement enquiry"),this._send(n)&&this.CurrentTxFlowState.Sent("Asked EFTPOS to make a settlement enquiry."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"Settle Initiated")}},{key:"InitiateGetLastTx",value:function(){if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");var e=(new P.GetLastTransactionRequest).ToMessage();this.CurrentFlow=d.SpiFlow.Transaction;var t=e.Id;return this.CurrentTxFlowState=new d.TransactionFlowState(t,d.TransactionType.GetLastTransaction,0,e,"Waiting for EFTPOS connection to make a Get-Last-Transaction request."),this.CurrentTxFlowState.CallingGlt(e.Id),this._send(e)&&this.CurrentTxFlowState.Sent("Asked EFTPOS for last transaction."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"GLT Initiated")}},{key:"InitiateRecovery",value:function(e,t){if(this.CurrentStatus==d.SpiStatus.Unpaired)return new d.InitiateTxResult(!1,"Not Paired");if(this.CurrentFlow!=d.SpiFlow.Idle)return new d.InitiateTxResult(!1,"Not Idle");this.CurrentFlow=d.SpiFlow.Transaction;var n=(new P.GetLastTransactionRequest).ToMessage();return this.CurrentTxFlowState=new d.TransactionFlowState(e,t,0,n,"Waiting for EFTPOS connection to attempt recovery."),this._send(n)&&this.CurrentTxFlowState.Sent("Asked EFTPOS to recover state."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),new d.InitiateTxResult(!0,"Recovery Initiated")}},{key:"GltMatch",value:function(e,t,n,i){if(!(arguments.length<=4)&&arguments.length-4){if(1==(arguments.length<=4?0:arguments.length-4))return this._log.info("Obsolete method call detected: Use GltMatch(gltResponse, posRefId)"),this.GltMatch(e,arguments.length<=4?void 0:arguments[4]);throw new Error("Obsolete method call with unknown args: Use GltMatch(GetLastTransactionResponse gltResponse, string posRefId)")}this._log.info("GLT CHECK: PosRefId: ".concat(t,"->").concat(e.GetPosRefId()));var s=e.GetBankDateTimeString(),r=new Date("".concat(s.substr(4,4),"-").concat(s.substr(2,2),"-").concat(s.substr(0,2)," ").concat(s.substr(8,2),":").concat(s.substr(10,2),":").concat(s.substr(12,2))),o=i.getTime()-r.getTime();return!t==e.GetPosRefId()?c.SuccessState.Unknown:"PURCHASE"==e.GetTxType().toUpperCase()&&e.GetBankNonCashAmount()!=n&&o>0?c.Message.SuccessState.Unknown:e.GetSuccessState()}},{key:"PrintReceipt",value:function(e,t){this._send(new I.PrintingRequest(e,t).toMessage())}},{key:"GetTerminalStatus",value:function(){this._send((new A.TerminalStatusRequest).ToMessage())}},{key:"_handleKeyRequest",value:function(e){this.CurrentPairingFlowState.Message="Negotiating Pairing...",document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState}));var t=(new p.PairingHelper).GenerateSecretsAndKeyResponse(new S.KeyRequest(e));this._secrets=t.Secrets,this._spiMessageStamp.Secrets=this._secrets,this._send(t.KeyResponse.ToMessage())}},{key:"_handleKeyCheck",value:function(e){var t=new S.KeyCheck(e);this.CurrentPairingFlowState.ConfirmationCode=t.ConfirmationCode,this.CurrentPairingFlowState.AwaitingCheckFromEftpos=!0,this.CurrentPairingFlowState.AwaitingCheckFromPos=!0,this.CurrentPairingFlowState.Message="Confirm that the following Code is showing on the Terminal",document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState}))}},{key:"_handlePairResponse",value:function(e){var t=new S.PairResponse(e);this.CurrentPairingFlowState.AwaitingCheckFromEftpos=!1,t.Success?(this.CurrentPairingFlowState.AwaitingCheckFromPos?(this._log.info("Got Pair Confirm from Eftpos, but still waiting for use to confirm from POS."),this.CurrentPairingFlowState.Message="Confirm that the following Code is what the EFTPOS showed",document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState}))):(this._log.info("Got Pair Confirm from Eftpos, and already had confirm from POS. Now just waiting for first pong."),this._onPairingSuccess()),this._startPeriodicPing()):this._onPairingFailed()}},{key:"_handleDropKeysAdvice",value:function(e){this._log.info("Eftpos was Unpaired. I shall unpair from my end as well."),this._doUnpair()}},{key:"_onPairingSuccess",value:function(){this.CurrentPairingFlowState.Successful=!0,this.CurrentPairingFlowState.Finished=!0,this.CurrentPairingFlowState.Message="Pairing Successful!",this.CurrentStatus=d.SpiStatus.PairedConnected,document.dispatchEvent(new CustomEvent("SecretsChanged",{detail:this._secrets})),document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState}))}},{key:"_onPairingFailed",value:function(){this._secrets=null,this._spiMessageStamp.Secrets=null,this._conn.Disconnect(),this.CurrentStatus=d.SpiStatus.Unpaired,this.CurrentPairingFlowState.Message="Pairing Failed",this.CurrentPairingFlowState.Finished=!0,this.CurrentPairingFlowState.Successful=!1,this.CurrentPairingFlowState.AwaitingCheckFromPos=!1,document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState}))}},{key:"_doUnpair",value:function(){this.CurrentStatus=d.SpiStatus.Unpaired,this._conn.Disconnect(),this._secrets=null,this._spiMessageStamp.Secrets=null,document.dispatchEvent(new CustomEvent("SecretsChanged",{detail:this._secrets}))}},{key:"_handleKeyRollingRequest",value:function(e){var t=T.KeyRollingHelper.PerformKeyRolling(e,this._secrets);this._secrets=t.NewSecrets,this._spiMessageStamp.Secrets=this._secrets,this._send(t.KeyRollingConfirmation),document.dispatchEvent(new CustomEvent("SecretsChanged",{detail:this._secrets}))}},{key:"_handleSignatureRequired",value:function(e){var t=e.Data.pos_ref_id;this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||!this.CurrentTxFlowState.PosRefId==t?this._log.info("Received Signature Required but I was not waiting for one. Incoming Pos Ref ID: ".concat(t)):(this.CurrentTxFlowState.SignatureRequired(new P.SignatureRequired(e),"Ask Customer to Sign the Receipt"),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})))}},{key:"_handleAuthCodeRequired",value:function(e){var t=e.Data.pos_ref_id;if(this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||!this.CurrentTxFlowState.PosRefId==t)_log.info("Received Auth Code Required but I was not waiting for one. Incoming Pos Ref ID: ".concat(t));else{var n=new P.PhoneForAuthRequired(e),i="Auth Code Required. Call ".concat(n.GetPhoneNumber()," and quote merchant id ").concat(n.GetMerchantId());this.CurrentTxFlowState.PhoneForAuthRequired(n,i),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState}))}}},{key:"_handlePurchaseResponse",value:function(e){var t=e.Data.pos_ref_id;this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||!this.CurrentTxFlowState.PosRefId==t?this._log.info("Received Purchase response but I was not waiting for one. Incoming Pos Ref ID: ".concat(t,'"')):(this.CurrentTxFlowState.Completed(e.GetSuccessState(),e,"Purchase Transaction Ended."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})))}},{key:"_handleCashoutOnlyResponse",value:function(e){var t=e.Data.pos_ref_id;this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||!this.CurrentTxFlowState.PosRefId==t?this._log.info("Received Cashout Response but I was not waiting for one. Incoming Pos Ref ID: ".concat(t)):(this.CurrentTxFlowState.Completed(e.GetSuccessState(),e,"Cashout Transaction Ended."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})))}},{key:"_handleMotoPurchaseResponse",value:function(e){var t=e.Data.pos_ref_id;this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||!this.CurrentTxFlowState.PosRefId==t?this._log.info("Received Moto Response but I was not waiting for one. Incoming Pos Ref ID: ".concat(t)):(this.CurrentTxFlowState.Completed(e.GetSuccessState(),e,"Moto Transaction Ended."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})))}},{key:"_handleRefundResponse",value:function(e){var t=e.Data.pos_ref_id;this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished|!this.CurrentTxFlowState.PosRefId==t?this._log.info("Received Refund response but I was not waiting for this one. Incoming Pos Ref ID: ".concat(t)):(this.CurrentTxFlowState.Completed(e.GetSuccessState(),e,"Refund Transaction Ended."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})))}},{key:"HandleSettleResponse",value:function(e){this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished?this._log.info("Received Settle response but I was not waiting for one. ".concat(e.DecryptedJson)):(this.CurrentTxFlowState.Completed(e.GetSuccessState(),e,"Settle Transaction Ended."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})))}},{key:"_handleSettlementEnquiryResponse",value:function(e){this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished?this._log.info("Received Settlement Enquiry response but I was not waiting for one. ".concat(e.DecryptedJson)):(this.CurrentTxFlowState.Completed(e.GetSuccessState(),e,"Settlement Enquiry Ended."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})))}},{key:"_handleErrorEvent",value:function(e){this.CurrentFlow==d.SpiFlow.Transaction&&!this.CurrentTxFlowState.Finished&&this.CurrentTxFlowState.AttemptingToCancel&&"NO_TRANSACTION"==e.GetError()?(this._log.info("Was trying to cancel a transaction but there is nothing to cancel. Calling GLT to see what's up"),this._callGetLastTransaction()):this._log.info("Received Error Event But Don't know what to do with it. ".concat(e.DecryptedJson))}},{key:"_handleGetLastTransactionResponse",value:function(e){var t=this.CurrentTxFlowState;if(this.CurrentFlow!=d.SpiFlow.Transaction||t.Finished)this._log.info("Received glt response but we were not in the middle of a tx. ignoring.");else if(t.AwaitingGltResponse)if(t.LastGltRequestId==e.Id){this._log.info("Got Last Transaction.."),t.GotGltResponse();var n=new P.GetLastTransactionResponse(e);if(t.GLTResponsePosRefId=n.GetPosRefId(),n.WasRetrievedSuccessfully())if(t.Type==d.TransactionType.GetLastTransaction)this._log.info("Retrieved Last Transaction as asked directly by the user."),n.CopyMerchantReceiptToCustomerReceipt(),t.Completed(e.GetSuccessState(),e,"Last Transaction Retrieved");else{var i=this.GltMatch(n,t.PosRefId,t.AmountCents,t.RequestTime);i==c.SuccessState.Unknown?(this._log.info("Did not match transaction."),t.UnknownCompleted("Failed to recover Transaction Status. Check EFTPOS. ")):(n.CopyMerchantReceiptToCustomerReceipt(),t.Completed(i,e,"Transaction Ended."))}else{if(!n.IsStillInProgress(t.PosRefId))return n.WasTimeOutOfSyncError()?void this._log.info("Time-Out-Of-Sync error in Get Last Transaction response. Let's ignore it and we'll try again."):void this._log.info("Unexpected Response in Get Last Transaction during - Received posRefId:".concat(n.GetPosRefId()," Error:").concat(e.GetError(),". Ignoring."));if(n.IsWaitingForSignatureResponse()&&!t.AwaitingSignatureCheck)this._log.info("Eftpos is waiting for us to send it signature accept/decline, but we were not aware of this. The user can only really decline at this stage as there is no receipt to print for signing."),this.CurrentTxFlowState.SignatureRequired(new P.SignatureRequired(t.PosRefId,e.Id,"MISSING RECEIPT\n DECLINE AND TRY AGAIN."),"Recovered in Signature Required but we don't have receipt. You may Decline then Retry.");else{if(!n.IsWaitingForAuthCode()||t.AwaitingPhoneForAuth)return void this._log.info("Operation still in progress... stay waiting.");this._log.info("Eftpos is waiting for us to send it auth code, but we were not aware of this. We can only cancel the transaction at this stage as we don't have enough information to recover from this."),this.CurrentTxFlowState.PhoneForAuthRequired(new P.PhoneForAuthRequired(t.PosRefId,e.Id,"UNKNOWN","UNKNOWN"),"Recovered mid Phone-For-Auth but don't have details. You may Cancel then Retry.")}}document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:t}))}else this._log.info("received a glt response but the message id does not match the glt request that we sent. strange. ignoring.");else this._log.info("received a glt response but we had not asked for one within this transaction. Perhaps leftover from previous one. ignoring.")}},{key:"_handleCancelTransactionResponse",value:function(e){var t=e.Data.pos_ref_id;if(this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||!this.CurrentTxFlowState.PosRefId==t)this._log.info("Received Cancel Required but I was not waiting for one. Incoming Pos Ref ID: ".concat(t));else{var n=this.CurrentTxFlowState,i=new P.CancelTransactionResponse(e);i.Success||(this._log.warn("Failed to cancel transaction: reason="+i.GetErrorReason()+", detail="+i.GetErrorDetail()),n.CancelFailed("Failed to cancel transaction: "+i.GetErrorDetail()+". Check EFTPOS."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:n})))}}},{key:"_handleSetPosInfoResponse",value:function(e){var t=new C.SetPosInfoResponse(e);t.isSuccess()?(this._hasSetInfo=!0,this._log.info("Setting POS info successful")):this._log.warn("Setting POS info failed: reason="+t.getErrorReason()+", detail="+t.getErrorDetail())}},{key:"_startTransactionMonitoringThread",value:function(){var e=this,t=!1,n=this.CurrentTxFlowState;if(this.CurrentFlow==d.SpiFlow.Transaction&&!n.Finished){var i=n;i.AttemptingToCancel&&Date.now()>i.CancelAttemptTime+this._maxWaitForCancelTx?(this._log.info("Been too long waiting for transaction to cancel."),n.UnknownCompleted("Waited long enough for Cancel Transaction result. Check EFTPOS. "),t=!0):i.RequestSent&&Date.now()>i.LastStateRequestTime+this._checkOnTxFrequency&&(this._log.info("Checking on our transaction. Last we asked was at ".concat(i.LastStateRequestTime,"...")),this._callGetLastTransaction())}t&&document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})),setTimeout(function(){return e._startTransactionMonitoringThread()},this._txMonitorCheckFrequency)}},{key:"PrintingResponse",value:function(e){throw new Error("Method not implemented. Please overwrite this method in your POS")}},{key:"TerminalStatusResponse",value:function(e){throw new Error("Method not implemented. Please overwrite this method in your POS")}},{key:"BatteryLevelChanged",value:function(e){throw new Error("Method not implemented. Please overwrite this method in your POS")}},{key:"_handlePrintingResponse",value:function(e){this.PrintingResponse(e)}},{key:"_handleTerminalStatusResponse",value:function(e){this.TerminalStatusResponse(e)}},{key:"_handleBatteryLevelChanged",value:function(e){this.BatteryLevelChanged(e)}},{key:"_resetConn",value:function(){var e=this;this._conn=new m.Connection,(this._isUsingHttps()||this._forceSecureWebSockets)&&(this._log.info("Secure connection detected."),this._eftposAddress=this._eftposAddress.replace("ws://","wss://")),this._conn.Address=this._eftposAddress,document.addEventListener("ConnectionStatusChanged",function(t){return e._onSpiConnectionStatusChanged(t.detail)}),document.addEventListener("MessageReceived",function(t){return e._onSpiMessageReceived(t.detail)}),document.addEventListener("ErrorReceived",function(t){return e._onWsErrorReceived(t.detail)})}},{key:"_onSpiConnectionStatusChanged",value:function(e){var t=this;switch(e.ConnectionState){case m.ConnectionState.Connecting:this._log.info("I'm Connecting to the Eftpos at ".concat(this._eftposAddress,"..."));break;case m.ConnectionState.Connected:if(this._retriesSinceLastDeviceAddressResolution=0,this.CurrentFlow==d.SpiFlow.Pairing&&this.CurrentStatus==d.SpiStatus.Unpaired){this.CurrentPairingFlowState.Message="Requesting to Pair...",document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState}));var n=p.PairingHelper.NewPairRequest();this._send(n.ToMessage())}else this._log.info("I'm Connected to ".concat(this._eftposAddress,"...")),this._spiMessageStamp.Secrets=this._secrets,this._startPeriodicPing();break;case m.ConnectionState.Disconnected:if(this._log.info("I'm disconnected from ".concat(this._eftposAddress,"...")),this._mostRecentPingSent=null,this._mostRecentPongReceived=null,this._missedPongsCount=0,this._stopPeriodicPing(),this.CurrentStatus!=d.SpiStatus.Unpaired){if(this.CurrentStatus=d.SpiStatus.PairedConnecting,this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished||this._log.info("Lost connection in the middle of a transaction..."),null==this._conn)return;this._autoAddressResolutionEnabled&&(this._retriesSinceLastDeviceAddressResolution>=this._retriesBeforeResolvingDeviceAddress?(this._autoResolveEftposAddress(),this._retriesSinceLastDeviceAddressResolution=0):this._retriesSinceLastDeviceAddressResolution+=1),this._log.info("Will try to reconnect in ".concat(this._sleepBeforeReconnectMs,"ms...")),setTimeout(function(){t.CurrentStatus!=d.SpiStatus.Unpaired&&t._conn&&t._conn.Connect()},this._sleepBeforeReconnectMs)}else this.CurrentFlow==d.SpiFlow.Pairing&&(this._log.info("Lost Connection during pairing."),this.CurrentPairingFlowState.Message="Could not Connect to Pair. Check Network and Try Again...",this._onPairingFailed(),document.dispatchEvent(new CustomEvent("PairingFlowStateChanged",{detail:this.CurrentPairingFlowState})));break;default:throw new Error("Unknown state: "+e)}}},{key:"_startPeriodicPing",value:function(){var e=this;this._stopPeriodicPing(),this._periodicPingThread=setInterval(function(){return e._periodicPing()},this._pingFrequency),this._periodicPing()}},{key:"_periodicPing",value:function(){var e=this;this._conn.Connected&&null!=this._secrets?(this._doPing(),setTimeout(function(){if(null!=e._mostRecentPingSent&&(null==e._mostRecentPongReceived||e._mostRecentPongReceived.Id!=e._mostRecentPingSent.Id)){if(e._missedPongsCount+=1,e._log.info("Eftpos didn't reply to my Ping. Missed Count: ".concat(e._missedPongsCount,"/").concat(e._missedPongsToDisconnect,".")),e._missedPongsCount<e._missedPongsToDisconnect)return e._log.info("Trying another ping..."),void e._startPeriodicPing();e._log.info("Disconnecting..."),e._conn.Disconnect(),e._stopPeriodicPing()}e._missedPongsCount=0},this._pongTimeout)):(this._stopPeriodicPing(),this._log.info("Cancelling periodic ping as were disconnected or not paired"))}},{key:"_onReadyToTransact",value:function(){this._log.info("On Ready To Transact!"),this.CurrentStatus=d.SpiStatus.PairedConnected,this.CurrentFlow!=d.SpiFlow.Transaction||this.CurrentTxFlowState.Finished?(this._hasSetInfo||this._callSetPosInfo(),this._spiPat&&this._spiPat.PushPayAtTableConfig()):this.CurrentTxFlowState.RequestSent?this._callGetLastTransaction():(this._send(this.CurrentTxFlowState.Request),this.CurrentTxFlowState.Sent("Sending Request Now..."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this.CurrentTxFlowState})))}},{key:"_callSetPosInfo",value:function(){var e=new C.SetPosInfoRequest(this._posVersion,this._posVendorId,"js",M,C.DeviceInfo.GetAppDeviceInfo());this._send(e.toMessage())}},{key:"_stopPeriodicPing",value:function(){this._periodicPingThread&&(clearInterval(this._periodicPingThread),this._periodicPingThread=null)}},{key:"_doPing",value:function(){var e=R.PingHelper.GeneratePingRequest();this._mostRecentPingSent=e,this._send(e),this._mostRecentPingSentTime=Date.now()}},{key:"_handleIncomingPong",value:function(e){this._spiMessageStamp.ServerTimeDelta=e.GetServerTimeDelta(),null==this._mostRecentPongReceived&&(this.CurrentStatus!=d.SpiStatus.Unpaired?(this._log.info("First pong of connection and in paired state."),this._onReadyToTransact()):this._log.info("First pong of connection but pairing process not finalised yet.")),this._mostRecentPongReceived=e,this._log.debug("PongLatency:".concat(Date.now()-this._mostRecentPingSentTime))}},{key:"_handleIncomingPing",value:function(e){var t=R.PongHelper.GeneratePongRessponse(e);this._send(t)}},{key:"_callGetLastTransaction",value:function(){var e=(new P.GetLastTransactionRequest).ToMessage();this.CurrentTxFlowState.CallingGlt(e.Id),this._send(e)}},{key:"_onSpiMessageReceived",value:function(e){var t=c.Message.FromJson(e.Message,this._secrets);if(this._log.info("Received:"+t.DecryptedJson),v.SpiPreauth.IsPreauthEvent(t.EventName))this._spiPreauth._handlePreauthMessage(t);else switch(t.EventName){case c.Events.KeyRequest:this._handleKeyRequest(t);break;case c.Events.KeyCheck:this._handleKeyCheck(t);break;case c.Events.PairResponse:this._handlePairResponse(t);break;case c.Events.DropKeysAdvice:this._handleDropKeysAdvice(t);break;case c.Events.PurchaseResponse:this._handlePurchaseResponse(t);break;case c.Events.RefundResponse:this._handleRefundResponse(t);break;case c.Events.CashoutOnlyResponse:this._handleCashoutOnlyResponse(t);break;case c.Events.MotoPurchaseResponse:this._handleMotoPurchaseResponse(t);break;case c.Events.SignatureRequired:this._handleSignatureRequired(t);break;case c.Events.AuthCodeRequired:this._handleAuthCodeRequired(t);break;case c.Events.GetLastTransactionResponse:this._handleGetLastTransactionResponse(t);break;case c.Events.SettleResponse:this.HandleSettleResponse(t);break;case c.Events.SettlementEnquiryResponse:this._handleSettlementEnquiryResponse(t);break;case c.Events.Ping:this._handleIncomingPing(t);break;case c.Events.Pong:this._handleIncomingPong(t);break;case c.Events.KeyRollRequest:this._handleKeyRollingRequest(t);break;case c.Events.CancelTransactionResponse:this._handleCancelTransactionResponse(t);break;case c.Events.SetPosInfoResponse:this._handleSetPosInfoResponse(t);break;case c.Events.PayAtTableGetTableConfig:if(null==this._spiPat){this._send(_.PayAtTableConfig.FeatureDisableMessage(f.RequestIdHelper.Id("patconf")));break}this._spiPat._handleGetTableConfig(t);break;case c.Events.PayAtTableGetBillDetails:this._spiPat._handleGetBillDetailsRequest(t);break;case c.Events.PayAtTableBillPayment:this._spiPat._handleBillPaymentAdvice(t);break;case c.Events.PayAtTableGetOpenTables:this._spiPat._handleGetOpenTablesRequest(t);break;case c.Events.PayAtTableBillPaymentFlowEnded:this._spiPat._handleBillPaymentFlowEnded(t);break;case c.Events.PrintingResponse:this._handlePrintingResponse(t);break;case c.Events.TerminalStatusResponse:this._handleTerminalStatusResponse(t);break;case c.Events.BatteryLevelChanged:this._handleBatteryLevelChanged(t);break;case c.Events.Error:this._handleErrorEvent(t);break;case c.Events.InvalidHmacSignature:this._log.info("I could not verify message from Eftpos. You might have to Un-pair Eftpos and then reconnect.");break;default:this._log.info("I don't Understand Event: ".concat(t.EventName,", ").concat(t.Data,". Perhaps I have not implemented it yet."))}}},{key:"_onWsErrorReceived",value:function(e){this._log.warn("Received WS Error",e.Message)}},{key:"_send",value:function(e){var t=e.ToJson(this._spiMessageStamp);return this._conn.Connected?(this._log.info("Sending: "+e.DecryptedJson),this._conn.Send(t),!0):(this._log.info("Asked to send, but not connected: "+e.DecryptedJson),!1)}},{key:"HasSerialNumberChanged",value:function(e){return this._serialNumber!=e}},{key:"HasEftposAddressChanged",value:function(e){return this._eftposAddress!=e}},{key:"_autoResolveEftposAddress",value:function(){var e=o()(s.a.mark(function e(){var t,n,i,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._autoAddressResolutionEnabled){e.next=2;break}return e.abrupt("return");case 2:if(this._serialNumber&&this._deviceApiKey){e.next=5;break}return this._log.warn("Missing serialNumber and/or deviceApiKey. Need to set them before for Auto Address to work."),e.abrupt("return");case 5:return t=this._isSecureConnection(),n=new E.DeviceAddressService,e.prev=7,e.next=10,n.RetrieveService(this._serialNumber,this._deviceApiKey,this._acquirerCode,t,this._inTestMode);case 10:return i=e.sent,e.next=13,i.json();case 13:r=e.sent,this.CurrentDeviceStatus=Object.assign(new E.DeviceAddressStatus(t),{ip:r.ip,fqdn:r.fqdn,DeviceAddressResponseCode:i.status,ResponseStatusDescription:i.statusText,ResponseMessage:i.statusText,LastUpdated:r.last_updated}),e.next=24;break;case 17:return e.prev=17,e.t0=e.catch(7),this.CurrentDeviceStatus.DeviceAddressResponseCode=E.DeviceAddressResponseCode.DEVICE_SERVICE_ERROR,this.CurrentDeviceStatus.ResponseStatusDescription=e.t0,this.CurrentDeviceStatus.ResponseMessage=e.t0,document.dispatchEvent(new CustomEvent("DeviceAddressChanged",{detail:this.CurrentDeviceStatus})),e.abrupt("return");case 24:if(i.status!=E.HttpStatusCode.NotFound){e.next=28;break}return this.CurrentDeviceStatus.DeviceAddressResponseCode=E.DeviceAddressResponseCode.INVALID_SERIAL_NUMBER,document.dispatchEvent(new CustomEvent("DeviceAddressChanged",{detail:this.CurrentDeviceStatus})),e.abrupt("return");case 28:if(i.ok&&r&&this.CurrentDeviceStatus.Address){e.next=32;break}return this.CurrentDeviceStatus.DeviceAddressResponseCode=E.DeviceAddressResponseCode.DEVICE_SERVICE_ERROR,document.dispatchEvent(new CustomEvent("DeviceAddressChanged",{detail:this.CurrentDeviceStatus})),e.abrupt("return");case 32:if(this.HasEftposAddressChanged(this.CurrentDeviceStatus.Address)){e.next=36;break}return this.CurrentDeviceStatus.DeviceAddressResponseCode=E.DeviceAddressResponseCode.ADDRESS_NOT_CHANGED,document.dispatchEvent(new CustomEvent("DeviceAddressChanged",{detail:this.CurrentDeviceStatus})),e.abrupt("return");case 36:o=t?"wss":"ws",this._eftposAddress=o+"://"+this.CurrentDeviceStatus.Address,this._conn.Address=this._eftposAddress,this.CurrentDeviceStatus.DeviceAddressResponseCode=E.DeviceAddressResponseCode.SUCCESS,document.dispatchEvent(new CustomEvent("DeviceAddressChanged",{detail:this.CurrentDeviceStatus}));case 41:case"end":return e.stop()}},e,this,[[7,17]])}));return function(){return e.apply(this,arguments)}}()},{key:"_isUsingHttps",value:function(){return"https:"==document.location.protocol}},{key:"_isSecureConnection",value:function(){return this._isUsingHttps()||this._forceSecureWebSockets}}],[{key:"GetVersion",value:function(){return M}}]),e}()},"./src/SpiModels.js":
/*!**************************!*\
  !*** ./src/SpiModels.js ***!
  \**************************/
/*! exports provided: SpiStatus, SpiFlow, PairingFlowState, TransactionType, InitiateTxResult, MidTxResult, TransactionFlowState, SubmitAuthCodeResult, SpiConfig, TransactionOptions */function(e,t,n){"use strict";n.r(t),n.d(t,"SpiStatus",function(){return u}),n.d(t,"SpiFlow",function(){return l}),n.d(t,"PairingFlowState",function(){return h}),n.d(t,"TransactionType",function(){return c}),n.d(t,"InitiateTxResult",function(){return d}),n.d(t,"MidTxResult",function(){return f}),n.d(t,"TransactionFlowState",function(){return p}),n.d(t,"SubmitAuthCodeResult",function(){return m}),n.d(t,"SpiConfig",function(){return g}),n.d(t,"TransactionOptions",function(){return _});var i=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u={PairedConnected:"PairedConnected",PairedConnecting:"PairedConnecting",Unpaired:"Unpaired"},l={Pairing:"Pairing",Transaction:"Transaction",Idle:"Idle"},h=function e(t){o()(this,e),this.Message=null,this.AwaitingCheckFromEftpos=null,this.AwaitingCheckFromPos=null,this.ConfirmationCode=null,this.Finished=null,this.Successful=null,t&&Object.assign(this,t)},c={Purchase:"Purchase",Refund:"Refund",CashoutOnly:"CashoutOnly",MOTO:"MOTO",Settle:"Settle",SettlementEnquiry:"SettlementEnquiry",GetLastTransaction:"GetLastTransaction",Preauth:"Preauth",AccountVerify:"AccountVerify"},d=function e(t,n){o()(this,e),this.Initiated=t,this.Message=n},f=function e(t,n){o()(this,e),this.Valid=t,this.Message=n},p=function(){function e(t,n,i,s,r){o()(this,e),this.PosRefId=t,this.Id=t,this.Type=n,this.DisplayMessage=r,this.AmountCents=i,this.RequestSent=!1,this.RequestTime=null,this.LastStateRequestTime=null,this.LastGltRequestId=null,this.AttemptingToCancel=null,this.AwaitingSignatureCheck=!1,this.AwaitingPhoneForAuth=null,this.Finished=!1,this.Success=a.SuccessState.Unknown,this.Response=null,this.SignatureRequiredMessage=null,this.PhoneForAuthRequiredMessage=null,this.CancelAttemptTime=null,this.Request=s,this.AwaitingGltResponse=null,this.GLTResponsePosRefId=null}return s()(e,[{key:"Sent",value:function(e){this.RequestSent=!0,this.RequestTime=Date.now(),this.LastStateRequestTime=Date.now(),this.DisplayMessage=e}},{key:"Cancelling",value:function(e){this.AttemptingToCancel=!0,this.CancelAttemptTime=Date.now(),this.DisplayMessage=e}},{key:"CancelFailed",value:function(e){this.AttemptingToCancel=!1,this.DisplayMessage=e}},{key:"CallingGlt",value:function(e){this.AwaitingGltResponse=!0,this.LastStateRequestTime=Date.now(),this.LastGltRequestId=e}},{key:"GotGltResponse",value:function(){this.AwaitingGltResponse=!1}},{key:"Failed",value:function(e,t){this.Success=a.SuccessState.Failed,this.Finished=!0,this.Response=e,this.DisplayMessage=t}},{key:"SignatureRequired",value:function(e,t){this.SignatureRequiredMessage=e,this.AwaitingSignatureCheck=!0,this.DisplayMessage=t}},{key:"SignatureResponded",value:function(e){this.AwaitingSignatureCheck=!1,this.DisplayMessage=e}},{key:"PhoneForAuthRequired",value:function(e,t){this.PhoneForAuthRequiredMessage=e,this.AwaitingPhoneForAuth=!0,this.DisplayMessage=t}},{key:"AuthCodeSent",value:function(e){this.AwaitingPhoneForAuth=!1,this.DisplayMessage=e}},{key:"Completed",value:function(e,t,n){this.Success=e,this.Response=t,this.Finished=!0,this.AttemptingToCancel=!1,this.AwaitingGltResponse=!1,this.AwaitingSignatureCheck=!1,this.AwaitingPhoneForAuth=!1,this.DisplayMessage=n}},{key:"UnknownCompleted",value:function(e){this.Success=a.SuccessState.Unknown,this.Response=null,this.Finished=!0,this.AttemptingToCancel=!1,this.AwaitingGltResponse=!1,this.AwaitingSignatureCheck=!1,this.AwaitingPhoneForAuth=!1,this.DisplayMessage=e}}]),e}(),m=function e(t,n){o()(this,e),this.ValidFormat=t,this.Message=n},g=function(){function e(){o()(this,e),this.PrintMerchantCopy=!1,this.PromptForCustomerCopyOnEftpos=!1,this.SignatureFlowOnEftpos=!1,this.EnabledPrintMerchantCopy=!1,this.EnabledPromptForCustomerCopyOnEftpos=!1,this.EnabledSignatureFlowOnEftpos=!1}return s()(e,[{key:"AddReceiptConfig",value:function(e){return this.PromptForCustomerCopyOnEftpos&&this.EnabledPromptForCustomerCopyOnEftpos&&(e.prompt_for_customer_copy=this.PromptForCustomerCopyOnEftpos),this.SignatureFlowOnEftpos&&this.EnabledSignatureFlowOnEftpos&&(e.print_for_signature_required_transactions=this.SignatureFlowOnEftpos),this.PrintMerchantCopy&&this.EnabledPrintMerchantCopy&&(e.print_merchant_copy=this.PrintMerchantCopy),e}},{key:"ToString",value:function(){return"PromptForCustomerCopyOnEftpos:".concat(this.PromptForCustomerCopyOnEftpos," SignatureFlowOnEftpos:").concat(this.SignatureFlowOnEftpos," PrintMerchantCopy: ").concat(this.PrintMerchantCopy)}}]),e}(),_=function(){function e(){o()(this,e),this._customerReceiptHeader="",this._customerReceiptFooter="",this._merchantReceiptHeader="",this._merchantReceiptFooter=""}return s()(e,[{key:"SetCustomerReceiptHeader",value:function(e){this._customerReceiptHeader=e}},{key:"SetCustomerReceiptFooter",value:function(e){this._customerReceiptFooter=e}},{key:"SetMerchantReceiptHeader",value:function(e){this._merchantReceiptHeader=e}},{key:"SetMerchantReceiptFooter",value:function(e){this._merchantReceiptFooter=e}},{key:"AddOptions",value:function(e){return e.customer_receipt_header=this._customerReceiptHeader,e.customer_receipt_footer=this._customerReceiptFooter,e.merchant_receipt_header=this._merchantReceiptHeader,e.merchant_receipt_footer=this._merchantReceiptFooter,e}}]),e}()},"./src/SpiPayAtTable.js":
/*!******************************!*\
  !*** ./src/SpiPayAtTable.js ***!
  \******************************/
/*! exports provided: SpiPayAtTable */function(e,t,n){"use strict";n.r(t),n.d(t,"SpiPayAtTable",function(){return l});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),u=n(/*! ./PayAtTable */"./src/PayAtTable.js"),l=function(){function e(t){s()(this,e),this._spi=t,this._log=console,this.Config=Object.assign(new u.PayAtTableConfig,{PayAtTabledEnabled:!0,OperatorIdEnabled:!0,AllowedOperatorIds:[],EqualSplitEnabled:!0,SplitByAmountEnabled:!0,SummaryReportEnabled:!0,TippingEnabled:!0,LabelOperatorId:"Operator ID",LabelPayButton:"Pay at Table",LabelTableId:"Table Number",TableRetrievalEnabled:!0})}return o()(e,[{key:"GetBillStatus",value:function(e,t,n,i){throw new Error("Method not implemented. Please overwrite this method in your POS")}},{key:"BillPaymentReceived",value:function(e,t){throw new Error("Method not implemented. Please overwrite this method in your POS")}},{key:"GetOpenTables",value:function(e){throw new Error("Method not implemented. Please overwrite this method in your POS")}},{key:"BillPaymentFlowEnded",value:function(e){throw new Error("Method not implemented. Please overwrite this method in your POS")}},{key:"PushPayAtTableConfig",value:function(){this._spi._send(this.Config.ToMessage(a.RequestIdHelper.Id("patconf")))}},{key:"_handleGetBillDetailsRequest",value:function(e){var t=this,n=e.Data.operator_id,i=e.Data.table_id,s=e.Data.payment_flow_started;return Promise.resolve(this.GetBillStatus("",i,n,s)).then(function(n){n.TableId=i,n.TotalAmount<=0&&(t._log.info("Table has 0 total amount. not sending it to eftpos."),n.Result=u.BillRetrievalResult.INVALID_TABLE_ID),t._spi._send(n.ToMessage(e.Id))})}},{key:"_handleBillPaymentAdvice",value:function(e){var t=this,n=new u.BillPayment(e);return Promise.resolve(this.GetBillStatus(n.BillId,n.TableId,n.OperatorId,n.PaymentFlowStarted)).then(function(i){i.Result!=u.BillRetrievalResult.SUCCESS&&(t._log.warn("Could not retrieve Bill Status for Payment Advice. Sending Error to Eftpos."),t._spi._send(i.ToMessage(e.Id)));var s=i.getBillPaymentHistory();if(s.find(function(e){return e.GetTerminalRefId()==n.PurchaseResponse.GetTerminalReferenceId()}))return t._log.warn("Had already received this bill_paymemnt advice from eftpos. Ignoring."),void t._spi._send(i.ToMessage(e.Id));var r=s;r.push(new u.PaymentHistoryEntry(n.PaymentType.toLowerCase(),n.PurchaseResponse.ToPaymentSummary()));var o=u.BillStatusResponse.ToBillData(r);Promise.resolve(t.BillPaymentReceived(n,o)).then(function(s){s.BillId=n.BillId,s.TableId=n.TableId,s.Result!=u.BillRetrievalResult.SUCCESS?(t._log.warn("POS Errored when being Advised of Payment. Letting EFTPOS know, and sending existing bill data."),s.BillData=i.BillData):s.BillData=o,t._spi._send(s.ToMessage(e.Id))})})}},{key:"_handleGetTableConfig",value:function(e){this._spi._send(this.Config.ToMessage(e.Id))}},{key:"_handleGetOpenTablesRequest",value:function(e){var t=e.Data.operator_id,n=this.GetOpenTables(t);n.TableData.length<=0&&this._log.info("There is no open table."),this._spi._send(n.ToMessage(e.Id))}},{key:"_handleBillPaymentFlowEnded",value:function(e){this.BillPaymentFlowEnded(e)}}]),e}()},"./src/SpiPreauth.js":
/*!***************************!*\
  !*** ./src/SpiPreauth.js ***!
  \***************************/
/*! exports provided: SpiPreauth */function(e,t,n){"use strict";n.r(t),n.d(t,"SpiPreauth",function(){return l});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Preauth */"./src/Preauth.js"),u=n(/*! ./SpiModels */"./src/SpiModels.js"),l=function(){function e(t){s()(this,e),this._spi=t,this._log=console,this.Config=new u.SpiConfig}return o()(e,[{key:"InitiateAccountVerifyTx",value:function(e){var t=new a.AccountVerifyRequest(e).ToMessage(),n=new u.TransactionFlowState(e,u.TransactionType.AccountVerify,0,t,"Waiting for EFTPOS connection to make account verify request");return this._initiatePreauthTx(n,"Asked EFTPOS to verify account")}},{key:"InitiateOpenTx",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.TransactionOptions,i=Object.assign(new a.PreauthOpenRequest(t,e),{Config:this.Config,Options:n}).ToMessage(),s=new u.TransactionFlowState(e,u.TransactionType.Preauth,t,i,"Waiting for EFTPOS connection to make preauth request for ".concat((t/100).toFixed(2))),r="Asked EFTPOS to create preauth for ".concat((t/100).toFixed(2));return this._initiatePreauthTx(s,r)}},{key:"InitiateTopupTx",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.TransactionOptions,s=Object.assign(new a.PreauthTopupRequest(t,n,e),{Config:this.Config,Options:i}).ToMessage(),r=new u.TransactionFlowState(e,u.TransactionType.Preauth,n,s,"Waiting for EFTPOS connection to make preauth topup request for ".concat((n/100).toFixed(2))),o="Asked EFTPOS to make preauth topup for ".concat((n/100).toFixed(2));return this._initiatePreauthTx(r,o)}},{key:"InitiatePartialCancellationTx",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.TransactionOptions,s=Object.assign(new a.PreauthPartialCancellationRequest(t,n,e),{Config:this.Config,Options:i}).ToMessage(),r=new u.TransactionFlowState(e,u.TransactionType.Preauth,n,s,"Waiting for EFTPOS connection to make preauth partial cancellation request for ".concat((n/100).toFixed(2))),o="Asked EFTPOS to make preauth partial cancellation for ".concat((n/100).toFixed(2));return this._initiatePreauthTx(r,o)}},{key:"InitiateExtendTx",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.TransactionOptions,i=Object.assign(new a.PreauthExtendRequest(t,e),{Config:this.Config,Options:n}).ToMessage(),s=new u.TransactionFlowState(e,u.TransactionType.Preauth,0,i,"Waiting for EFTPOS connection to make preauth Extend request");return this._initiatePreauthTx(s,"Asked EFTPOS to make preauth Extend request")}},{key:"InitiateCompletionTx",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.TransactionOptions,r=Object.assign(new a.PreauthCompletionRequest(t,n,e),{Config:this.Config,SurchargeAmount:i,Options:s}).ToMessage(),o=new u.TransactionFlowState(e,u.TransactionType.Preauth,n,r,"Waiting for EFTPOS connection to make preauth completion request for ".concat((n/100).toFixed(2))),l="Asked EFTPOS to make preauth completion for ".concat((n/100).toFixed(2));return this._initiatePreauthTx(o,l)}},{key:"InitiateCancelTx",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.TransactionOptions,i=Object.assign(new a.PreauthCancelRequest(t,e),{Config:this.Config,Options:n}).ToMessage(),s=new u.TransactionFlowState(e,u.TransactionType.Preauth,0,i,"Waiting for EFTPOS connection to make preauth cancellation request");return this._initiatePreauthTx(s,"Asked EFTPOS to make preauth cancellation request")}},{key:"_initiatePreauthTx",value:function(e,t){return this._spi.CurrentStatus==u.SpiStatus.Unpaired?new u.InitiateTxResult(!1,"Not Paired"):this._spi.CurrentFlow!=u.SpiFlow.Idle?new u.InitiateTxResult(!1,"Not Idle"):(this._spi.CurrentFlow=u.SpiFlow.Transaction,this._spi.CurrentTxFlowState=e,this._spi._send(e.Request)&&this._spi.CurrentTxFlowState.Sent(t),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this._spi.CurrentTxFlowState})),new u.InitiateTxResult(!0,"Preauth Initiated"))}},{key:"_handlePreauthMessage",value:function(e){switch(e.EventName){case a.PreauthEvents.AccountVerifyResponse:this._handleAccountVerifyResponse(e);break;case a.PreauthEvents.PreauthOpenResponse:case a.PreauthEvents.PreauthTopupResponse:case a.PreauthEvents.PreauthPartialCancellationResponse:case a.PreauthEvents.PreauthExtendResponse:case a.PreauthEvents.PreauthCompleteResponse:case a.PreauthEvents.PreauthCancellationResponse:this._handlePreauthResponse(e);break;default:this._log.info("I don't Understand Preauth Event: ".concat(e.EventName,", ").concat(e.Data,". Perhaps I have not implemented it yet."))}}},{key:"_handleAccountVerifyResponse",value:function(e){var t=e.Data.pos_ref_id,n=this._spi.CurrentTxFlowState;this._spi.CurrentFlow!=u.SpiFlow.Transaction||n.Finished||!n.PosRefId===t?this._log.info("Received Account Verify response but I was not waiting for one. Incoming Pos Ref ID: ".concat(t)):(n.Completed(e.GetSuccessState(),e,"Account Verify Transaction Ended."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this._spi.CurrentTxFlowState})))}},{key:"_handlePreauthResponse",value:function(e){var t=e.Data.pos_ref_id,n=this._spi.CurrentTxFlowState;this._spi.CurrentFlow!=u.SpiFlow.Transaction||n.Finished||!n.PosRefId===t?this._log.info("Received Preauth response but I was not waiting for one. Incoming Pos Ref ID: ".concat(t)):(n.Completed(e.GetSuccessState(),e,"Preauth Transaction Ended."),document.dispatchEvent(new CustomEvent("TxFlowStateChanged",{detail:this._spi.CurrentTxFlowState})))}}],[{key:"IsPreauthEvent",value:function(e){return 0===e.lastIndexOf("preauth",0)||e==a.PreauthEvents.PreauthCompleteResponse||e==a.PreauthEvents.PreauthCompleteRequest||e==a.PreauthEvents.AccountVerifyRequest||e==a.PreauthEvents.AccountVerifyResponse}}]),e}()},"./src/TerminalStatus.js":
/*!*******************************!*\
  !*** ./src/TerminalStatus.js ***!
  \*******************************/
/*! exports provided: TerminalStatusRequest, TerminalStatusResponse, TerminalBattery */function(e,t,n){"use strict";n.r(t),n.d(t,"TerminalStatusRequest",function(){return l}),n.d(t,"TerminalStatusResponse",function(){return h}),n.d(t,"TerminalBattery",function(){return c});var i=n(/*! @babel/runtime/helpers/classCallCheck */"./node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(i),r=n(/*! @babel/runtime/helpers/createClass */"./node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(r),a=n(/*! ./Messages */"./src/Messages.js"),u=n(/*! ./RequestIdHelper */"./src/RequestIdHelper.js"),l=function(){function e(){s()(this,e)}return o()(e,[{key:"ToMessage",value:function(){return new a.Message(u.RequestIdHelper.Id("trmnl"),a.Events.TerminalStatusRequest,{},!0)}}]),e}(),h=function(){function e(t){s()(this,e),this._m=t}return o()(e,[{key:"GetStatus",value:function(){return this._m.Data.status}},{key:"GetBatteryLevel",value:function(){return parseInt(this._m.Data.battery_level,10)}},{key:"IsCharging",value:function(){return!!this._m.Data.charging}}]),e}(),c=function e(t){s()(this,e),this.BatteryLevel=parseInt(t.Data.battery_level,10)}},0:
/*!************************!*\
  !*** buffer (ignored) ***!
  \************************/
/*! no static exports found */function(e,t){}})},"object"===o(t)&&"object"===o(e)?e.exports=r():(i=[],void 0===(s="function"==typeof(n=r)?n.apply(t,i):n)||(e.exports=s))}).call(this,n(2)(e))},,function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},,,,function(e,t,n){"use strict";n.r(t);var i=n(0);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(t,n,i){s(this,e),this._spi=null,this._posId="TABLEPOS1",this._eftposAddress="192.168.1.1",this._spiSecrets=null,this._version="2.6.0",this._serialNumber="",this._rcpt_from_eftpos=!1,this._sig_flow_from_eftpos=!1,this._print_merchant_copy=!1,this.allowedOperatorIdList=[],this.billsStore={},this.tableToBillMapping={},this.assemblyBillDataStore={},this._pat=null,this._log=t,this._receipt=n,this._flow_msg=i,this._isActionFlow=!1}var t,n,o;return t=e,(n=[{key:"Start",value:function(){var e=this;this._log.info("Starting TablePos..."),this.LoadPersistedState(),this._spi=new i.Spi(this._posId,this._serialNumber,this._eftposAddress,this._spiSecrets),this._spi.Config.PromptForCustomerCopyOnEftpos=this._rcpt_from_eftpos,this._spi.Config.SignatureFlowOnEftpos=this._sig_flow_from_eftpos,this._spi.Config.PrintMerchantCopy=this._print_merchant_copy,this._spi.SetPosInfo("assembly",this._version),document.addEventListener("StatusChanged",function(t){return e.OnSpiStatusChanged(t.detail)}),document.addEventListener("PairingFlowStateChanged",function(t){return e.OnPairingFlowStateChanged(t.detail)}),document.addEventListener("SecretsChanged",function(t){return e.OnSecretsChanged(t.detail)}),document.addEventListener("TxFlowStateChanged",function(t){return e.OnTxFlowStateChanged(t.detail)}),this._spi.PrintingResponse=this.HandlePrintingResponse.bind(this),this._spi.TerminalStatusResponse=this.HandleTerminalStatusResponse.bind(this),this._spi.BatteryLevelChanged=this.HandleBatteryLevelChanged.bind(this),this._pat=this._spi.EnablePayAtTable(),this.EnablePayAtTableConfigs(),this._pat.GetBillStatus=this.PayAtTableGetBillDetails.bind(this),this._pat.BillPaymentReceived=this.PayAtTableBillPaymentReceived.bind(this),this._pat.BillPaymentFlowEnded=this.PayAtTableBillPaymentFlowEnded.bind(this),this._pat.GetOpenTables=this.PayAtTableGetOpenTables.bind(this),this._spi.Start(),this._flow_msg.Clear(),this._flow_msg.Info("# Welcome to TablePos !"),this.PrintStatusAndActions()}},{key:"EnablePayAtTableConfigs",value:function(){if(localStorage.getItem("pat_config")){var e=JSON.parse(localStorage.getItem("pat_config"));this._pat.Config.PayAtTableEnabled=e.PayAtTableEnabled,this._pat.Config.OperatorIdEnabled=e.OperatorIdEnabled,this._pat.Config.EqualSplitEnabled=e.EqualSplitEnabled,this._pat.Config.SplitByAmountEnabled=e.SplitByAmountEnabled,this._pat.Config.TippingEnabled=e.TippingEnabled,this._pat.Config.SummaryReportEnabled=e.SummaryReportEnabled,this._pat.Config.AllowedOperatorIds=e.AllowedOperatorIds,this._pat.Config.LabelOperatorId=e.LabelOperatorId,this._pat.Config.LabelTableId=e.LabelTableId,this._pat.Config.LabelPayButton=e.LabelPayButton,this._pat.Config.TableRetrievalEnabled=e.TableRetrievalEnabled}else this._pat.Config.PayAtTableEnabled=!0,this._pat.Config.OperatorIdEnabled=!0,this._pat.Config.AllowedOperatorIds=[],this._pat.Config.EqualSplitEnabled=!0,this._pat.Config.SplitByAmountEnabled=!0,this._pat.Config.SummaryReportEnabled=!0,this._pat.Config.TippingEnabled=!0,this._pat.Config.LabelOperatorId="Operator ID",this._pat.Config.LabelPayButton="Pay at Table",this._pat.Config.LabelTableId="Table Number",this._pat.Config.TableRetrievalEnabled=!0;document.getElementById("pat_enabled").checked=this._pat.Config.PayAtTableEnabled,document.getElementById("operatorid_enabled").checked=this._pat.Config.OperatorIdEnabled,document.getElementById("equal_split").checked=this._pat.Config.EqualSplitEnabled,document.getElementById("split_by_amount").checked=this._pat.Config.SplitByAmountEnabled,document.getElementById("tipping").checked=this._pat.Config.TippingEnabled,document.getElementById("summary_report").checked=this._pat.Config.SummaryReportEnabled,document.getElementById("set_allowed_operatorid").value=this._pat.Config.AllowedOperatorIds.join(","),document.getElementById("set_label_operatorid").value=this._pat.Config.LabelOperatorId,document.getElementById("set_label_tableid").value=this._pat.Config.LabelTableId,document.getElementById("set_label_paybutton").value=this._pat.Config.LabelPayButton,document.getElementById("table_retrieval_enabled").checked=this._pat.Config.TableRetrievalEnabled}},{key:"OnTxFlowStateChanged",value:function(e){this._flow_msg.Clear(),this.PrintStatusAndActions(),this._flow_msg.Info("> ")}},{key:"OnPairingFlowStateChanged",value:function(e){this._flow_msg.Clear(),this.PrintStatusAndActions(),this._flow_msg.Info("> ")}},{key:"OnSecretsChanged",value:function(e){this._spiSecrets=e,null!=e?(this._log.info("# I Have Secrets: ".concat(e.EncKey).concat(e.HmacKey,". Persist them Securely.")),localStorage.setItem("EncKey",e.EncKey),localStorage.setItem("HmacKey",e.HmacKey)):(this._log.info("# I Have Lost the Secrets, i.e. Unpaired. Destroy the persisted secrets."),localStorage.removeItem("EncKey"),localStorage.removeItem("HmacKey"))}},{key:"OnSpiStatusChanged",value:function(e){this._log.clear(),this._log.info("# --\x3e SPI Status Changed: ".concat(e)),this.PrintStatusAndActions()}},{key:"HandlePrintingResponse",value:function(e){this._flow_msg.Clear();var t=new i.PrintingResponse(e);t.isSuccess()?this._flow_msg.Info("# --\x3e Printing Response: Printing Receipt successful"):this._flow_msg.Info("# --\x3e Printing Response:  Printing Receipt failed: reason = "+t.getErrorReason()+", detail = "+t.getErrorDetail()),this._spi.AckFlowEndedAndBackToIdle(),this.PrintStatusAndActions()}},{key:"HandleTerminalStatusResponse",value:function(e){this._flow_msg.Clear();var t=new i.TerminalStatusResponse(e);this._flow_msg.Info("# Terminal Status Response #"),this._flow_msg.Info("# Status: "+t.GetStatus()),this._flow_msg.Info("# Battery Level: "+t.GetBatteryLevel()+"%"),this._flow_msg.Info("# Charging: "+t.IsCharging()),this._spi.AckFlowEndedAndBackToIdle(),this.PrintStatusAndActions()}},{key:"HandleBatteryLevelChanged",value:function(e){this._log.clear();var t=new i.TerminalBattery(e);this._flow_msg.Info("# Battery Level Changed #"),this._flow_msg.Info("# Battery Level: "+t.BatteryLevel+"%"),this._spi.AckFlowEndedAndBackToIdle(),this.PrintStatusAndActions()}},{key:"PayAtTableGetBillDetails",value:function(e,t,n,s){if(!e){if(!this.tableToBillMapping[t])return Object.assign(new i.BillStatusResponse,{Result:i.BillRetrievalResult.INVALID_TABLE_ID});e=this.tableToBillMapping[t]}if(!this.billsStore[e])return Object.assign(new i.BillStatusResponse,{Result:i.BillRetrievalResult.INVALID_BILL_ID});var r=this.billsStore[e];if(this.billsStore[e].Locked&&s)return this._log.info("Table is Locked."),Object.assign(new i.BillStatusResponse,{Result:i.BillRetrievalResult.INVALID_TABLE_ID});this.billsStore[e].Locked=s;var o=Object.assign(new i.BillStatusResponse,{Result:i.BillRetrievalResult.SUCCESS,BillId:e,TableId:t,OperatorId:n,TotalAmount:r.TotalAmount,OutstandingAmount:r.OutstandingAmount}),a=this.assemblyBillDataStore[e];return o.BillData=a,o}},{key:"PayAtTableBillPaymentReceived",value:function(e,t){if(!this.billsStore[e.BillId])return Object.assign(new i.BillStatusResponse,{Result:i.BillRetrievalResult.INVALID_BILL_ID});this._flow_msg.Info("# Got a ".concat(e.PaymentType," Payment against bill ").concat(e.BillId," for table ").concat(e.TableId));var n=this.billsStore[e.BillId];return n.OutstandingAmount-=e.PurchaseAmount,n.tippedAmount+=e.TipAmount,n.SurchargeAmount+=e.SurchargeAmount,n.Locked=0!=n.OutstandingAmount,this._flow_msg.Info("Updated Bill: ".concat(JSON.stringify(n))),this.assemblyBillDataStore[e.BillId]=t,this.SaveBillState(),Object.assign(new i.BillStatusResponse,{Result:i.BillRetrievalResult.SUCCESS,OutstandingAmount:n.OutstandingAmount,TotalAmount:n.TotalAmount})}},{key:"PayAtTableBillPaymentFlowEnded",value:function(e){var t=new i.BillPaymentFlowEndedResponse(e);if(this.billsStore[t.BillId]){var n=this.billsStore[t.BillId];n.Locked=!1,this._flow_msg.Info("\n            Bill Id                : ".concat(t.BillId,"\n            Table                  : ").concat(t.TableId,"\n            Operator Id            : ").concat(t.OperatorId,"\n            Bill OutStanding Amount: ").concat((t.BillOutstandingAmount/100).toFixed(2),"\n            Bill Total Amount      : ").concat((t.BillTotalAmount/100).toFixed(2),"\n            Card Total Count       : ").concat(t.CardTotalCount,"\n            Card Total Amount      : ").concat(t.CardTotalAmount,"\n            Cash Total Count       : ").concat(t.CashTotalCount,"\n            Cash Total Amount      : ").concat(t.CashTotalAmount,"\n            Locked                 : ").concat(n.Locked))}else this._flow_msg.Info("Incorrect Bill Id!")}},{key:"PayAtTableGetOpenTables",value:function(e){var t=[],n=!1;if(Object.keys(this.tableToBillMapping).length>0)for(var s in this.tableToBillMapping){var r=this.tableToBillMapping[s];if(this.billsStore[r].OperatorId==e&&this.billsStore[r].OutstandingAmount>0){n||(this._flow_msg.Info("#    Open Tables: "),n=!0);var o=Object.assign(new i.OpenTablesEntry,{TableId:s,Label:this.billsStore[r].Label,BillOutstandingAmount:this.billsStore[r].OutstandingAmount});this._flow_msg.Info("Table Id : ".concat(s,", Bill Id: ").concat(this.billsStore[r].BillId,", Outstanding Amount: $").concat((this.billsStore[r].OutstandingAmount/100).toFixed(2))),t.push(o)}}n||this._flow_msg.Info("# No Open Tables.");var a=JSON.stringify(t);return Object.assign(new i.GetOpenTablesResponse,{TableData:a})}},{key:"PrintStatusAndActions",value:function(){this.PrintFlowInfo(),this.PrintActions(),this.PrintPairingStatus()}},{key:"PrintFlowInfo",value:function(){switch(this._spi.CurrentFlow){case i.SpiFlow.Pairing:var e=this._spi.CurrentPairingFlowState;this._flow_msg.Info("### PAIRING PROCESS UPDATE ###"),this._flow_msg.Info("# ".concat(e.Message)),this._flow_msg.Info("# Finished? ".concat(e.Finished)),this._flow_msg.Info("# Successful? ".concat(e.Successful)),this._flow_msg.Info("# Confirmation Code: ".concat(e.ConfirmationCode)),this._flow_msg.Info("# Waiting Confirm from Eftpos? ".concat(e.AwaitingCheckFromEftpos)),this._flow_msg.Info("# Waiting Confirm from POS? ".concat(e.AwaitingCheckFromPos));break;case i.SpiFlow.Transaction:var t=this._spi.CurrentTxFlowState;if(this._flow_msg.Info("### TX PROCESS UPDATE ###"),this._flow_msg.Info("# ".concat(t.DisplayMessage)),this._flow_msg.Info("# PosRefId: ".concat(t.PosRefId)),this._flow_msg.Info("# Type: ".concat(t.Type)),this._flow_msg.Info("# Request Amount: $".concat((t.AmountCents/100).toFixed(2))),this._flow_msg.Info("# Waiting For Signature: ".concat(t.AwaitingSignatureCheck)),this._flow_msg.Info("# Attempting to Cancel : ".concat(t.AttemptingToCancel)),this._flow_msg.Info("# Finished: ".concat(t.Finished)),this._flow_msg.Info("# Success: ".concat(t.Success)),t.Finished)switch(t.Success){case i.SuccessState.Success:switch(t.Type){case i.TransactionType.Purchase:this._flow_msg.Info("# WOOHOO - WE GOT PAID!");var n=new i.PurchaseResponse(t.Response);this._flow_msg.Info("# Response: ".concat(n.GetResponseText())),this._flow_msg.Info("# RRN: ".concat(n.GetRRN())),this._flow_msg.Info("# Scheme: ".concat(n.SchemeName)),this._flow_msg.Info("# Customer Receipt:"),this._receipt.Info(n.WasCustomerReceiptPrinted()?"# PRINTED FROM EFTPOS":n.GetCustomerReceipt().trim()),this._flow_msg.Info("# PURCHASE: ".concat(n.GetPurchaseAmount())),this._flow_msg.Info("# TIP: ".concat(n.GetTipAmount())),this._flow_msg.Info("# CASHOUT: ".concat(n.GetCashoutAmount())),this._flow_msg.Info("# BANKED NON-CASH AMOUNT: ".concat(n.GetBankNonCashAmount())),this._flow_msg.Info("# BANKED CASH AMOUNT: ".concat(n.GetBankCashAmount()));break;case i.TransactionType.Refund:this._flow_msg.Info("# REFUND GIVEN- OH WELL!");var s=new i.RefundResponse(t.Response);this._flow_msg.Info("# Response: ".concat(s.GetResponseText())),this._flow_msg.Info("# RRN: ".concat(s.GetRRN())),this._flow_msg.Info("# Scheme: ".concat(s.SchemeName)),this._flow_msg.Info("# Customer Receipt:"),this._receipt.Info(s.WasCustomerReceiptPrinted()?"# PRINTED FROM EFTPOS":s.GetCustomerReceipt().trim()),this._flow_msg.Info("# REFUNDED AMOUNT: ".concat(s.GetRefundAmount()));break;case i.TransactionType.Settle:if(this._flow_msg.Info("# SETTLEMENT SUCCESSFUL!"),null!=t.Response){var r=new i.Settlement(t.Response);this._flow_msg.Info("# Response: ".concat(r.GetResponseText())),this._flow_msg.Info("# Merchant Receipt:"),this._receipt.Info(r.GetReceipt().trim())}}break;case i.SuccessState.Failed:switch(t.Type){case i.TransactionType.Purchase:if(this._flow_msg.Info("# WE DID NOT GET PAID :("),null!=t.Response){var o=new i.PurchaseResponse(t.Response);this._flow_msg.Info("# Error: ".concat(t.Response.GetError())),this._flow_msg.Info("# Response: ".concat(o.GetResponseText())),this._flow_msg.Info("# RRN: ".concat(o.GetRRN())),this._flow_msg.Info("# Scheme: ".concat(o.SchemeName)),this._flow_msg.Info("# Customer Receipt:"),this._receipt.Info(o.WasCustomerReceiptPrinted()?"# PRINTED FROM EFTPOS":o.GetCustomerReceipt().trim())}break;case i.TransactionType.Refund:if(this._flow_msg.Info("# REFUND FAILED!"),null!=t.Response){var a=new i.RefundResponse(t.Response);this._flow_msg.Info("# Response: ".concat(a.GetResponseText())),this._flow_msg.Info("# RRN: ".concat(a.GetRRN())),this._flow_msg.Info("# Scheme: ".concat(a.SchemeName)),this._flow_msg.Info("# Customer Receipt:"),this._receipt.Info(a.WasCustomerReceiptPrinted()?"# PRINTED FROM EFTPOS":a.GetCustomerReceipt().trim())}break;case i.TransactionType.Settle:if(this._flow_msg.Info("# SETTLEMENT FAILED!"),null!=t.Response){var u=new i.Settlement(t.Response);this._flow_msg.Info("# Response: ".concat(u.GetResponseText())),this._flow_msg.Info("# Error: ".concat(t.Response.GetError())),this._flow_msg.Info("# Merchant Receipt:"),this._receipt.Info(u.GetReceipt())}break;default:this._flow_msg.Info("# MOTEL POS DOESN'T KNOW WHAT TO DO WITH THIS TX TYPE WHEN IT FAILS")}break;case i.SuccessState.Unknown:switch(t.Type){case i.TransactionType.Purchase:this._flow_msg.Info("# WE'RE NOT QUITE SURE WHETHER WE GOT PAID OR NOT :/"),this._flow_msg.Info("# CHECK THE LAST TRANSACTION ON THE EFTPOS ITSELF FROM THE APPROPRIATE MENU ITEM."),this._flow_msg.Info("# IF YOU CONFIRM THAT THE CUSTOMER PAID, CLOSE THE ORDER."),this._flow_msg.Info("# OTHERWISE, RETRY THE PAYMENT FROM SCRATCH.");break;case i.TransactionType.Refund:this._flow_msg.Info("# WE'RE NOT QUITE SURE WHETHER THE REFUND WENT THROUGH OR NOT :/"),this._flow_msg.Info("# CHECK THE LAST TRANSACTION ON THE EFTPOS ITSELF FROM THE APPROPRIATE MENU ITEM."),this._flow_msg.Info("# YOU CAN THE TAKE THE APPROPRIATE ACTION.")}}}}},{key:"PrintActions",value:function(){var e=this,t=document.getElementById("status_indicator"),n=document.getElementById("primary_status"),s=document.getElementById("flow_status"),r=document.getElementById("flow_status_heading"),o=(document.getElementById("action-form"),document.getElementById("pairing-form"),document.getElementById("submit_action")),a=document.getElementById("cancel_action"),u=document.querySelectorAll("#action-inputs .input-field-group"),l=document.getElementById("current-action-heading");t.dataset.status=this._spi.CurrentStatus,t.dataset.flow=this._spi.CurrentFlow,n.innerText=this._spi.CurrentStatus,s.innerText=this._spi.CurrentFlow,r.innerText=this._spi.CurrentFlow;var h=this._spi.CurrentStatus===i.SpiStatus.Unpaired,c=this._spi.CurrentStatus===i.SpiStatus.PairedConnecting,d=this._spi.CurrentStatus===i.SpiStatus.PairedConnected,f=this._spi.CurrentFlow===i.SpiFlow.Idle,p=this._spi.CurrentFlow===i.SpiFlow.Transaction,m=this._spi.CurrentFlow===i.SpiFlow.Pairing,g=[{id:"save_settings",enabled:h&&f||c||d&&f,onClick:function(){h&&f&&(e._posId=document.getElementById("pos_id").value,e._eftposAddress=document.getElementById("eftpos_address").value,e._spi.SetPosId(e._posId),e._spi.SetEftposAddress(e._eftposAddress),localStorage.setItem("pos_id",e._posId),localStorage.setItem("eftpos_address",e._eftposAddress)),f&&(e._spi.Config.PrintMerchantCopy=document.getElementById("print_merchant_copy").checked,e._spi.Config.PromptForCustomerCopyOnEftpos=document.getElementById("rcpt_from_eftpos").checked,e._spi.Config.SignatureFlowOnEftpos=document.getElementById("sig_flow_from_eftpos").checked,localStorage.setItem("print_merchant_copy",e._spi.Config.PrintMerchantCopy),localStorage.setItem("rcpt_from_eftpos",e._spi.Config.PromptForCustomerCopyOnEftpos),localStorage.setItem("sig_flow_from_eftpos",e._spi.Config.SignatureFlowOnEftpos),e._pat.Config.PayAtTableEnabled=document.getElementById("pat_enabled").checked,e._pat.Config.OperatorIdEnabled=document.getElementById("operatorid_enabled").checked,e._pat.Config.EqualSplitEnabled=document.getElementById("equal_split").checked,e._pat.Config.SplitByAmountEnabled=document.getElementById("split_by_amount").checked,e._pat.Config.TippingEnabled=document.getElementById("tipping").checked,e._pat.Config.SummaryReportEnabled=document.getElementById("summary_report").checked,e._pat.Config.AllowedOperatorIds=document.getElementById("set_allowed_operatorid").value.split(","),e._pat.Config.LabelOperatorId=document.getElementById("set_label_operatorid").value,e._pat.Config.LabelTableId=document.getElementById("set_label_tableid").value,e._pat.Config.LabelPayButton=document.getElementById("set_label_paybutton").value,e._pat.Config.TableRetrievalEnabled=document.getElementById("table_retrieval_enabled").checked,d&&e._pat.PushPayAtTableConfig(),localStorage.setItem("pat_config",JSON.stringify(e._pat.Config))),e._log.info("Saved settings ".concat(e._posId,":").concat(e._eftposAddress)),e.PrintPairingStatus()},inputs:[]},{id:"pat_all_enable",enabled:f,onClick:function(){var t=document.querySelectorAll("input[type=checkbox].table-config");console.log("optino inputs",t),t.forEach(function(e){e.checked=!0}),e.EnablePayAtTableConfigs(),e._pat.PushPayAtTableConfig()},inputs:[]},{id:"pair",enabled:h&&f,onClick:function(){e._spi.Pair()},inputs:[]},{id:"unpair",enabled:!h&&f,onClick:function(){e._spi.Unpair()},inputs:[]},{id:"pair_cancel",enabled:m,onClick:function(){e._spi.PairingCancel()},inputs:[]},{id:"pair_confirm",enabled:m&&this._spi.CurrentPairingFlowState.AwaitingCheckFromEftpos,onClick:function(){e._spi.PairingConfirmCode()},inputs:[]},{id:"ok",enabled:m&&this._spi.CurrentPairingFlowState.Finished||p&&this._spi.CurrentTxFlowState.Finished,onClick:function(){e._spi.AckFlowEndedAndBackToIdle(),e._flow_msg.Clear(),e._flow_msg.innerHTML="Select from the options below",e.PrintStatusAndActions()},inputs:[]},{id:"open",enabled:d&&f,onSubmit:function(){var t=document.getElementById("table_number").value,n=document.getElementById("operator_id").value,i=document.getElementById("label").value,s=document.getElementById("locked").checked;e.OpenTable(t,n,i,s)},inputs:["table_number","operator_id","label","locked"]},{id:"add",enabled:d&&f,onSubmit:function(){var t=document.getElementById("table_number").value,n=parseInt(document.getElementById("amount").value,10);e.AddToTable(t,n)},inputs:["table_number","amount"]},{id:"close",enabled:d&&f,onSubmit:function(){var t=document.getElementById("table_number").value;e.CloseTable(t)},inputs:["table_number"]},{id:"lock",enabled:d&&f,onSubmit:function(){var t=document.getElementById("table_number").value,n=document.getElementById("locked").checked;e.LockTable(t,n)},inputs:["table_number","locked"]},{id:"tables",enabled:d&&f,onClick:function(){e.PrintTables()},inputs:[]},{id:"table",enabled:d&&f,onSubmit:function(){var t=document.getElementById("table_number").value;e.PrintTable(t)},inputs:["table_number"]},{id:"bill",enabled:d&&f,onSubmit:function(){var t=document.getElementById("bill_id").value;e.PrintBill(t)},inputs:["bill_id"]},{id:"purchase",enabled:d&&f,onSubmit:function(){var t="purchase-".concat((new Date).toISOString()),n=parseInt(document.getElementById("amount").value,10),i=e._spi.InitiatePurchaseTxV2(t,n,0,0,!1);i.Initiated||e._flow_msg.Info("# Could not initiate purchase: ".concat(i.Message,". Please Retry."))},inputs:["amount"]},{id:"refund",enabled:d&&f,onSubmit:function(){var t=parseInt(document.getElementById("amount").value,10),n="refund-".concat((new Date).toISOString()),i=e._spi.InitiateRefundTx(n,t);e._flow_msg.Info(i.Initiated?"# Refund Initiated. Will be updated with Progress.":"# Could not initiate refund: ".concat(i.Message,". Please Retry."))},inputs:["amount"]},{id:"settle",enabled:d&&f,onClick:function(){var t=e._spi.InitiateSettleTx(i.RequestIdHelper.Id("settle"));e._flow_msg.Info(t.Initiated?"# Settle Initiated. Will be updated with Progress.":"# Could not initiate settle: ".concat(t.Message,". Please Retry."))},inputs:[]},{id:"tx_sign_accept",enabled:p&&this._spi.CurrentTxFlowState.AwaitingSignatureCheck,onClick:function(){e._spi.AcceptSignature(!0)},inputs:[]},{id:"tx_sign_decline",enabled:p&&this._spi.CurrentTxFlowState.AwaitingSignatureCheck,onClick:function(){e._spi.AcceptSignature(!1)},inputs:[]},{id:"tx_cancel",enabled:p&&this._spi.CurrentTxFlowState.Finished&&this._spi.CurrentTxFlowState.AttemptingToCancel,onClick:function(){e._spi.CancelTransaction()},inputs:[]}],_=!0,v=!1,w=void 0;try{for(var y,S=u[Symbol.iterator]();!(_=(y=S.next()).done);_=!0){y.value.classList.add("hidden")}}catch(e){v=!0,w=e}finally{try{_||null==S.return||S.return()}finally{if(v)throw w}}g.forEach(function(t){var n=document.getElementById(t.id);n.disabled=!t.enabled,t.inputs&&t.inputs.length?n.onclick=function(){t.inputs.forEach(function(e){var t=document.getElementById(e);document.querySelector('#action-inputs [data-id="'.concat(e,'"]')).classList.remove("hidden"),t.required=!0}),e._isActionFlow=!0,o.onclick=function(){t.onSubmit(),e._isActionFlow=!1;var n=!0,i=!1,s=void 0;try{for(var r,h=u[Symbol.iterator]();!(n=(r=h.next()).done);n=!0){r.value.classList.add("hidden")}}catch(e){i=!0,s=e}finally{try{n||null==h.return||h.return()}finally{if(i)throw s}}o.classList.add("hidden"),a.classList.add("hidden"),l.innerText=""},o.classList.remove("hidden"),a.classList.remove("hidden"),l.innerText=n.innerText}:(n.onclick=t.onClick,o.classList.add("hidden"))}),a.onclick=function(){e._isActionFlow=!1;var t=!0,n=!1,i=void 0;try{for(var s,r=u[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){s.value.classList.add("hidden")}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}o.classList.add("hidden"),a.classList.add("hidden"),l.innerText=""},this._flow_msg.Info()}},{key:"PrintPairingStatus",value:function(){this._flow_msg.Info("# --------------- STATUS ------------------"),this._flow_msg.Info("# ".concat(this._posId," <-> Eftpos: ").concat(this._eftposAddress," #")),this._flow_msg.Info("# SPI STATUS: ".concat(this._spi.CurrentStatus,"     FLOW: ").concat(this._spi.CurrentFlow," #")),this._flow_msg.Info("# SPI CONFIG: ".concat(JSON.stringify(this._spi.Config))),this._flow_msg.Info("# ----------------TABLES-------------------"),this._flow_msg.Info("#    Open Tables: ".concat(Object.keys(this.tableToBillMapping).length)),this._flow_msg.Info("# Bills in Store: ".concat(Object.keys(this.billsStore).length)),this._flow_msg.Info("# Assembly Bills: ".concat(Object.keys(this.assemblyBillDataStore).length)),this._flow_msg.Info("# -----------------------------------------"),this._flow_msg.Info("# POS: v".concat(this._version," Spi: v").concat(i.Spi.GetVersion()))}},{key:"OpenTable",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.tableToBillMapping[e])this._flow_msg.Info("Table Already Open: ".concat(JSON.stringify(this.billsStore[this.tableToBillMapping[e]])));else{var s=Object.assign(new a,{BillId:this.NewBillId(),TableId:e,OperatorId:t,Label:n,Locked:i});this.billsStore[s.BillId]=s,this.tableToBillMapping[s.TableId]=s.BillId,this.SaveBillState(),this._flow_msg.Info("Opened: ".concat(JSON.stringify(s)))}}},{key:"AddToTable",value:function(e,t){if(this.tableToBillMapping[e]){var n=this.billsStore[this.tableToBillMapping[e]];n.Locked?this._flow_msg.Info("Table is Locked."):(n.TotalAmount+=t,n.OutstandingAmount+=t,this.SaveBillState(),this._flow_msg.Info("Updated: ".concat(JSON.stringify(n))))}else this._flow_msg.Info("Table not Open.")}},{key:"CloseTable",value:function(e){if(this.tableToBillMapping[e]){var t=this.billsStore[this.tableToBillMapping[e]];t.Locked?this._flow_msg.Info("Table is Locked."):t.OutstandingAmount>0?this._flow_msg.Info("Bill not Paid Yet: ".concat(JSON.stringify(t))):(delete this.billsStore[this.tableToBillMapping[e]],delete this.tableToBillMapping[e],delete this.assemblyBillDataStore[t.BillId],this.SaveBillState(),this._flow_msg.Info("Closed: ".concat(JSON.stringify(t))))}else this._flow_msg.Info("Table not Open.")}},{key:"LockTable",value:function(e,t){if(this.tableToBillMapping[e]){var n=this.billsStore[this.tableToBillMapping[e]];n.Locked=t,this.SaveBillState(),t?this._flow_msg.Info("Locked: ".concat(JSON.stringify(n))):this._flow_msg.Info("UnLocked: ".concat(JSON.stringify(n)))}else this._flow_msg.Info("Table not Open.")}},{key:"PrintTable",value:function(e){this.tableToBillMapping[e]?this.PrintBill(this.tableToBillMapping[e]):this._flow_msg.Info("Table not Open.")}},{key:"PrintTables",value:function(){if(Object.keys(this.tableToBillMapping).length>0)for(var e in this._flow_msg.Info("# Open Tables: "),this.tableToBillMapping)this._flow_msg.Info("# Table #".concat(e,", Bill #").concat(this.tableToBillMapping[e]));else this._flow_msg.Info("# No Open Tables.");if(Object.keys(this.billsStore).length>0)for(var t in this._flow_msg.Info("# My Bills Store: "),this.billsStore)this._flow_msg.Info("# "+this.billsStore[t].toString());Object.keys(this.assemblyBillDataStore).length>0&&this._flow_msg.Info("# Assembly Bills Data: "+JSON.stringify(this.assemblyBillDataStore))}},{key:"PrintBill",value:function(e){this.billsStore[e]?this._flow_msg.Info("Bill: ".concat(this.billsStore[e].toString())):this._flow_msg.Info("Bill Not Found.")}},{key:"NewBillId",value:function(){return(1e3*Date.now()+(new Date).getMilliseconds()).toString()}},{key:"SaveBillState",value:function(){localStorage.setItem("tableToBillMapping",JSON.stringify(this.tableToBillMapping)),localStorage.setItem("billsStore",JSON.stringify(this.billsStore)),localStorage.setItem("assemblyBillDataStore",JSON.stringify(this.assemblyBillDataStore))}},{key:"LoadPersistedState",value:function(){localStorage.getItem("pos_id")?(this._posId=localStorage.getItem("pos_id"),document.getElementById("pos_id").value=this._posId):this._posId=document.getElementById("pos_id").value,localStorage.getItem("eftpos_address")?(this._eftposAddress=localStorage.getItem("eftpos_address"),document.getElementById("eftpos_address").value=this._eftposAddress):this._eftposAddress=document.getElementById("eftpos_address").value,this._print_merchant_copy=document.getElementById("print_merchant_copy").checked="true"===localStorage.getItem("print_merchant_copy")||!1,this._rcpt_from_eftpos=document.getElementById("rcpt_from_eftpos").checked="true"===localStorage.getItem("rcpt_from_eftpos")||!1,this._sig_flow_from_eftpos=document.getElementById("sig_flow_from_eftpos").checked="true"===localStorage.getItem("sig_flow_from_eftpos")||!1,localStorage.getItem("EncKey")&&localStorage.getItem("HmacKey")&&(this._spiSecrets=new i.Secrets(localStorage.getItem("EncKey"),localStorage.getItem("HmacKey"))),this.tableToBillMapping=JSON.parse(localStorage.getItem("tableToBillMapping")||"{}"),this.assemblyBillDataStore=JSON.parse(localStorage.getItem("assemblyBillDataStore")||"{}");var e=JSON.parse(localStorage.getItem("billsStore")||"{}");for(var t in e)this.billsStore[t]=Object.assign(new a,e[t])}}])&&r(t.prototype,n),o&&r(t,o),e}(),a=function e(){s(this,e),this.BillId=null,this.TableId=null,this.OperatorId=null,this.Label=null,this.TotalAmount=0,this.OutstandingAmount=0,this.tippedAmount=0,this.SurchargeAmount=0,this.Locked=!1};a.prototype.toString=function(){return"".concat(this.BillId," - /\n        Table:").concat(this.TableId," \n        Operator Id:").concat(this.OperatorId," \n        Label:").concat(this.Label," \n        Total:$").concat((this.TotalAmount/100).toFixed(2)," \n        Outstanding:$").concat((this.OutstandingAmount/100).toFixed(2)," \n        Tips:$").concat((this.tippedAmount/100).toFixed(2),"\n        Surcharge:$").concat((this.SurchargeAmount/100).toFixed(2),"  \n        Locked:").concat(this.Locked)},document.addEventListener("DOMContentLoaded",function(){try{var e=console,t=new i.Logger(document.getElementById("receipt_output"),"\n\n \\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/ \n\n"),n=new i.Logger(document.getElementById("flow_msg"));new o(e,t,n).Start()}catch(e){console.error(e)}})}])});
//# sourceMappingURL=TablePos.min.js.map